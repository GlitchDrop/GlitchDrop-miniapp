<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>GLITCH DROP ‚Äî Mini App</title>

  <style>
    :root{
      --bg-top:#0c1822; --bg-bot:#0e2230; --grid:rgba(255,255,255,.035); --grid-gap:34px;
      --panel:#0a0f1e; --panel2:#0a0d19; --card:#0e1330; --card2:#0b0f26;
      --neon-cyan:#16f1ff; --neon-pink:#ff3ed0; --neon-yellow:#ffe47a;
      --text:#e8efff; --muted:#9fb2d9; --border:rgba(120,180,255,.25);
      --shadow-strong:0 20px 60px rgba(10,20,60,.55), 0 0 60px rgba(22,241,255,.08);
      --shadow-soft:0 10px 30px rgba(10,20,60,.35);
      --radius:18px;
--tabbar-h: 84px;  /* –¥–µ—Ñ–æ–ª—Ç, –¥–∞–ª—å—à–µ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º JS-–æ–º */
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',system-ui,Segoe UI,Roboto,Arial,sans-serif}
    html{scroll-behavior:smooth; scrollbar-gutter: stable;}
    body{ color:var(--text); overflow-x:hidden; background:#0e1b25; overflow-y:scroll; }
    .cyber-bg{
      position:fixed; inset:0; z-index:0; pointer-events:none;
      background:
        linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bot) 100%),
        repeating-linear-gradient(0deg,  var(--grid) 0 1px,  transparent 1px var(--grid-gap)),
        repeating-linear-gradient(90deg, var(--grid) 0 1px,  transparent 1px var(--grid-gap));
      background-blend-mode: normal, overlay, overlay;
    }

    .app{min-height:100%;display:flex;flex-direction:column;position:relative;z-index:1}

    .topbar{
      position:sticky; top:0; z-index:30;
      display:flex; align-items:center; gap:12px;
      padding:12px 14px;
      background:linear-gradient(180deg,rgba(8,14,36,.72),rgba(6,10,26,.62));
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(10px);
      box-shadow:var(--shadow-soft);
    }
    .avatar{ width:42px; height:42px; border-radius:50%; border:2px solid rgba(22,241,255,.55); box-shadow:0 0 18px rgba(22,241,255,.28), 0 0 28px rgba(255,62,208,.18); object-fit:cover; background:linear-gradient(135deg, rgba(22,241,255,.15), rgba(255,62,208,.15)); }
    .avatar.hidden{ display:none; }
    .avatar-fallback{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center; background:linear-gradient(135deg, rgba(22,241,255,.18), rgba(255,62,208,.18)); border:1px solid var(--border); font-weight:900; letter-spacing:.5px; color:#081121; text-shadow:0 0 12px rgba(22,241,255,.7); }
    .brand{position:relative; font-weight:900; line-height:1; letter-spacing:1px}
    .brand .glitch{ font-size:22px; color:#cfe6ff; position:relative; display:inline-block; text-shadow:0 0 24px rgba(22,241,255,.55), 0 0 24px rgba(255,62,208,.35); }
    .brand .glitch::before,.brand .glitch::after{ content:attr(data-text); position:absolute; left:0; top:0; width:100%; overflow:hidden; }
    .brand .glitch::before{ transform:translateX(1px); color:var(--neon-cyan); opacity:.9; text-shadow:0 0 10px rgba(22,241,255,.8); animation:glitch 3s infinite ease-in-out;}
    .brand .glitch::after { transform:translateX(-1px); color:var(--neon-pink); opacity:.8; text-shadow:0 0 10px rgba(255,62,208,.8); animation:glitch 2.6s infinite ease-in-out reverse;}
    @keyframes glitch{ 0%,100%{clip-path:inset(0 0 0 0)} 10%{clip-path:inset(0 0 65% 0)} 20%{clip-path:inset(0 0 0 0)} 30%{clip-path:inset(40% 0 0 0)} 45%{clip-path:inset(0 0 0 0)} 60%{clip-path:inset(0 0 75% 0)} 80%{clip-path:inset(20% 0 10% 0)} }
    .grow{flex:1}

    .pill{
      display:flex; align-items:center; gap:10px; padding:8px 12px;
      border-radius:999px; border:1px solid var(--border);
      background:linear-gradient(135deg, rgba(22,241,255,.1), rgba(138,92,255,.12));
      box-shadow:0 0 18px rgba(22,241,255,.12) inset;
      font-weight:900; color:#cfe6ff;
    }
    /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∏–∫–æ–Ω–æ–∫ */
    .pill img{width:18px; height:18px; display:block; object-fit:cover; border-radius:4px}
    /* –µ–¥–∏–Ω—ã–π —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –æ–±–µ–∏—Ö –ø–∏–ª—é–ª—å */
    .pill--lg{ padding:10px 14px; }
    .pill--lg img{ width:24px; height:24px; }

    .chipbar{
  position:sticky;
  top: var(--topbar-h, 64px);   /* –±—ã–ª–æ 64px */
  z-index:25;
      display:flex; gap:10px; padding:10px 14px; overflow-x:auto;
      background:linear-gradient(180deg,rgba(8,14,36,.72),rgba(6,10,26,.62));
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(10px);
    }
    .chipbar::-webkit-scrollbar{display:none}
    .chip{
      padding:10px 14px; border-radius:999px; white-space:nowrap; cursor:pointer;
      border:1px solid var(--border); color:#9fb2d9; font-weight:800; user-select:none;
      background:linear-gradient(135deg, rgba(15,20,48,.7), rgba(12,16,38,.7));
      transition:transform .15s, box-shadow .15s, color .15s, background .2s, border-color .2s;
    }
    .chip:hover{ transform:translateY(-1px); box-shadow:0 8px 22px rgba(22,241,255,.12)}
    .chip.active{ color:#081121 !important; background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink)) !important; border-color:transparent !important; box-shadow:0 6px 28px rgba(22,241,255,.35), 0 0 44px rgba(255,62,208,.25) !important; }

    .content{
  flex:1;
  padding:16px;
  max-width:1100px;
  margin:0 auto;
  width:100%;
  padding-bottom: max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px);
}

    /* ====== CARD –∫–µ–π—Å–∞ (–±–µ–∑ —Ñ–ª–∏–ø–∞) ====== */
    .card{ position:relative; background:linear-gradient(180deg, rgba(20,26,62,.55), rgba(14,18,40,.6)); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow-strong); padding:12px; display:flex; flex-direction:column; gap:10px; overflow:hidden; cursor:pointer; }
    .card::before{ content:""; position:absolute; inset:-2px; background:conic-gradient(from 200deg, transparent, rgba(22,241,255,.18), transparent 30%, rgba(255,62,208,.18), transparent 55%); filter:blur(14px); opacity:.35; z-index:0; }
    .inner{position:relative; z-index:1}
    .thumb{
      height:160px; border-radius:14px; border:1px dashed rgba(180,210,255,.35);
      background: radial-gradient(120px 80px at 20% 20%, rgba(22,241,255,.12), transparent 60%), radial-gradient(120px 80px at 80% 80%, rgba(255,62,208,.10), transparent 60%), linear-gradient(180deg,#0c1230,#0a1028);
      display:grid; place-items:center; color:#a9c2ff; font-size:12px; text-transform:uppercase; letter-spacing:1px;
      overflow:hidden;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .name{font-weight:900; letter-spacing:.3px}
    .desc{font-size:12px; color:#9fb2d9}
    .price{font-weight:900; color:var(--neon-yellow); text-shadow:0 0 12px rgba(255,228,122,.25)}

    .tabbar{
  position: fixed;          /* –±—ã–ª–æ: sticky */
  left: 0; right: 0; bottom: 0;
  z-index: 80;              /* –≤—ã—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ detail, –Ω–æ –Ω–∏–∂–µ –º–æ–¥–∞–ª–æ–∫ */
  background: linear-gradient(180deg,rgba(8,14,36,.72),rgba(6,10,26,.62));
  border-top: 1px solid var(--border);
  backdrop-filter: blur(10px);
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  padding: 8px 6px;
  padding-bottom: calc(env(safe-area-inset-bottom) + 6px); /* –î–û–ë–ê–í–¨ –≠–¢–û */
}
    .tab{display:flex; flex-direction:column; align-items:center; gap:4px; padding:6px 2px; color:#9fb2d9; font-size:12px; font-weight:800}
    .tab.active{color:#e8efff}
    .ico{font-size:18px; text-shadow:0 0 10px rgba(22,241,255,.3)} .ico img{
  width:18px; height:18px; display:block; object-fit:cover; border-radius:4px;
}


    .backtop{ bottom: calc(var(--tabbar-h,84px) + 6px); position:fixed; right:14px; z-index:50; padding:9px 12px; border-radius:12px; font-weight:900; font-size:12px; letter-spacing:.3px; border:1px solid rgba(22,241,255,.45); color:#081121; background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink)); box-shadow:0 10px 28px rgba(22,241,255,.35), 0 0 36px rgba(255,62,208,.25); opacity:0; pointer-events:none; transform:translateY(8px); transition:opacity .2s, transform .2s; }
    .backtop.show{opacity:1; pointer-events:auto; transform:translateY(0)}

    /* ===== DETAIL VIEW ===== */
    .detail{
      position:fixed; inset:0; z-index:60; display:none; flex-direction:column;
      background:
        linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bot) 100%),
        repeating-linear-gradient(0deg,  var(--grid) 0 1px,  transparent 1px var(--grid-gap)),
        repeating-linear-gradient(90deg, var(--grid) 0 1px,  transparent 1px var(--grid-gap));
      background-blend-mode: normal, overlay, overlay;
      overflow:auto;
    }
    .detail.show{ display:flex; }
    .d-topbar{ position:sticky; top:0; z-index:61; display:flex; align-items:center; gap:10px; padding:10px 14px; background:linear-gradient(180deg,rgba(8,14,36,.82),rgba(6,10,26,.7)); border-bottom:1px solid var(--border); backdrop-filter:blur(10px); }
    .btn-back{ appearance:none; border:1px solid var(--border); background:transparent; color:var(--text); padding:8px 12px; border-radius:12px; font-weight:900; cursor:pointer; }
    .d-title{font-weight:900}
    .d-body{padding:16px; padding-bottom: max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px); max-width:1100px; margin:0 auto; width:100%}
    .d-hero{display:grid; grid-template-columns:1fr; gap:14px; margin-bottom:10px;}
    .d-thumb{ min-height:200px; height:auto; border-radius:16px; border:1px dashed rgba(180,210,255,.35);
      background: radial-gradient(160px 110px at 20% 20%, rgba(22,241,255,.12), transparent 60%), radial-gradient(160px 110px at 80% 80%, rgba(255,62,208,.10), transparent 60%), linear-gradient(180deg,#0c1230,#0a1028);
      display:grid; place-items:center; color:#a9c2ff; text-transform:uppercase; letter-spacing:1px; }
    .d-actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn-spin{ appearance:none; border:none; cursor:pointer; padding:12px 18px; border-radius:14px; font-weight:900; color:#081121; background:linear-gradient(135deg,#ffe28a,#ffc13a); box-shadow:0 10px 28px rgba(255,209,102,.35), 0 0 30px rgba(255,209,102,.25); }

    .panel{ margin-top:14px; padding:12px; border:1px solid var(--border); border-radius:16px; background:linear-gradient(180deg, rgba(20,26,62,.55), rgba(14,18,40,.6)); }
    .panel h3{margin:0 0 10px; text-align:center}
    .switch{display:flex; align-items:center; gap:10px; font-weight:800}
    .toggle{ width:46px; height:26px; border-radius:999px; position:relative; background:#2a314a; border:1px solid var(--border); cursor:pointer; }
    .toggle::after{ content:""; position:absolute; top:2px; left:2px; width:22px; height:22px; border-radius:50%; background:#fff; transition:transform .18s; }
    .toggle.active{ background:#19e6ff; } .toggle.active::after{ transform:translateX(20px); }
    .qty{display:flex; gap:10px; justify-content:center}
    .qty .q{ min-width:44px; height:40px; border-radius:12px; display:grid; place-items:center; cursor:pointer; border:1px solid var(--border); background:rgba(15,20,48,.6); font-weight:900; }
    .qty .q.active{ outline:2px solid var(--neon-cyan); color:#081121; background:linear-gradient(135deg,var(--neon-cyan),var(--neon-pink)); border-color:transparent }

    .subhead{margin:18px 0 10px; text-align:center; font-weight:900; letter-spacing:1.2px}

    /* ====== LOOT GRID —Å —Ñ–ª–∏–ø–æ–º ====== */
    .loot-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}

    .loot{
      position:relative; width:100%; aspect-ratio:1/1;
      perspective:900px;
      border-radius:14px;
    }
    .loot-inner{
      position:relative; width:100%; height:100%;
      transform-style:preserve-3d;
      transition:transform .45s cubic-bezier(.2,.7,.2,1);
      border-radius:14px;
    }
    .loot.flipped .loot-inner{ transform:rotateY(180deg); }

    .loot-face{
      position:absolute; inset:0;
      border-radius:14px;
      border:1px dashed rgba(180,210,255,.35);
      overflow:hidden;
      backface-visibility:hidden; -webkit-backface-visibility:hidden;
      display:grid; place-items:center;
      background: linear-gradient(180deg,#0c1230,#0a1028);
      color:#a9c2ff; font-size:12px; letter-spacing:1px; text-transform:uppercase;
    }
    .loot-front img{ width:100%; height:100%; object-fit:cover; display:block; }
    .loot-back{
      transform:rotateY(180deg);
      background:
        linear-gradient(180deg, rgba(12,18,48,.88), rgba(8,14,36,.9)),
        radial-gradient(600px 200px at 50% 110%, rgba(22,241,255,.12), transparent 60%),
        radial-gradient(600px 200px at 50% -10%, rgba(255,62,208,.10), transparent 60%);
      padding:12px;
      gap:8px;
    }

    /* ¬´–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ¬ª */
    .lb-stats{ width:100%; }
    .lb-stars, .lb-ton{
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      line-height:1.05;
      letter-spacing:.2px;
    }
    .lb-stars{
      font-size:20px;
      color:var(--neon-yellow);
      margin-bottom:4px;
      text-shadow:0 0 12px rgba(255,228,122,.25);
    }
    .lb-ton{
      font-size:18px;
      color:#79c6ff;
      text-shadow:0 0 12px rgba(22,241,255,.22);
    }

/* –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞ –±–µ–∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π */
.slice.win{
  outline:2px solid var(--neon-cyan);
  box-shadow:0 0 30px rgba(22,241,255,.28), inset 0 0 14px rgba(22,241,255,.12);
  animation:win-glow 900ms ease-out 1;
}

/* –º—è–≥–∫–∏–π –∏–º–ø—É–ª—å—Å —Å–≤–µ—á–µ–Ω–∏—è */
@keyframes win-glow{
  0%   { box-shadow:0 0 0 rgba(22,241,255,0), inset 0 0 0 rgba(22,241,255,0); }
  25%  { box-shadow:0 0 34px rgba(22,241,255,.35), inset 0 0 16px rgba(22,241,255,.14); }
  60%  { box-shadow:0 0 26px rgba(22,241,255,.28), inset 0 0 14px rgba(22,241,255,.12); }
  100% { box-shadow:0 0 30px rgba(22,241,255,.28), inset 0 0 14px rgba(22,241,255,.12); }
}

/* === –§–ò–ö–° –î–õ–Ø –î–õ–ò–ù–ù–û–ì–û –ù–ò–ö–ê === */
.brand{
  flex: 0 1 38vw;           /* –∫–æ—Ä–∏–¥–æ—Ä –¥–ª—è –Ω–∏–∫–∞ */
  min-width: 120px;
  max-width: 420px;
  overflow: hidden;
  display: flex;
  align-items: center;
}

.brand .glitch{
  display: inline-block;
  white-space: nowrap;
  transform-origin: left center;
  will-change: transform;
}

.topbar .pill{ flex: 0 0 auto; }

/* –ß—É—Ç—å –ª—É—á—à–µ —Ä–µ–Ω–¥–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –ø—Ä–∏ —Å–∫–µ–π–ª–µ */
.brand .glitch{
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* === –ù–∏–∫ + ID (–¥–≤–µ —Å—Ç—Ä–æ–∫–∏) === */
.brand-lines{
  display:inline-flex;
  flex-direction:column;
  line-height:1.05;
}

.brand .glitch{
  margin-bottom:2px; /* –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –Ω–∏–∫–æ–º –∏ ID */
}

.brand .uid{
  font-size:12px;
  font-weight:800;
  color:rgba(255,255,255,.6); /* –±–µ–ª—ã–π —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é */
  letter-spacing:.4px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}


.inventory-page{
  max-width:1100px;
  margin:0 auto;
  padding: 0 12px max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px);
}


.inventory-grid{
  display:grid;
  grid-template-columns:repeat(2, 1fr); /* –í–°–ï–ì–î–ê 2 –∫–æ–ª–æ–Ω–∫–∏ */
  gap:14px;
  padding:12px 4px 0;
}

/* –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ */
.inventory-card{
  position:relative;
  aspect-ratio:1 / 1;
  border-radius:14px;
  border:1px dashed rgba(180,210,255,.35);
  background:
    radial-gradient(120px 80px at 20% 20%, rgba(22,241,255,.10), transparent 60%),
    radial-gradient(120px 80px at 80% 80%, rgba(255,62,208,.08), transparent 60%),
    linear-gradient(180deg,#0b1030,#0a1028);
  box-shadow:0 8px 26px rgba(10,20,60,.32);
  overflow:hidden;
  display:grid; place-items:center;
  user-select:none;
}

.inventory-card img{
  width:88%;
  height:88%;
  object-fit:contain;
  border-radius:12px;
  display:block;
}

/* –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.inventory-empty{
  min-height:40vh;
  display:grid; place-items:center;
  color:#ffffff; opacity:.9;
  font-weight:900; letter-spacing:.6px;
  text-align:center;
}

/* =========================================================
   –ò–ù–í–ï–ù–¢–ê–†–¨ ‚Äî –§–û–ù–û–í–ê–Ø –ü–û–í–ï–†–•–ù–û–°–¢–¨
   ========================================================= */
.inventory-surface{
  position:relative;
  min-height:100svh; /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞ */
  background:
    radial-gradient(60% 40% at 50% -10%, rgba(22,241,255,.06), transparent 60%),
    radial-gradient(60% 40% at 50% 110%, rgba(255,62,208,.05), transparent 60%),
    linear-gradient(180deg, #0b1030 0%, #0a1028 100%);
  border-top:1px solid var(--border);
  box-shadow: inset 0 30px 60px rgba(10,20,60,.35);
}

/* === INVENTORY HEADER ‚Äî full-bleed –¥–æ –∫—Ä–∞—ë–≤ —ç–∫—Ä–∞–Ω–∞ === */
.inventory-header{
  width: 100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  position: sticky;
  top: var(--topbar-h, 64px);
  z-index: 22;

  /* –≤–æ—Ç —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º */
  overflow-x: hidden; /* —Ñ–æ–ª–±—ç–∫ */
  overflow-x: clip;   /* –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç */

  /* –æ—Å—Ç–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–≤—å –∫–∞–∫ –±—ã–ª–æ */
  padding: 10px max(12px, env(safe-area-inset-left)) 12px max(12px, env(safe-area-inset-right));
  text-align:center;
  font-weight:900;
  letter-spacing:1.4px;
  font-size:clamp(24px, 8vw, 52px);
  color:#e8efff;
  text-shadow:0 0 16px rgba(22,241,255,.18);
  background: linear-gradient(180deg, rgba(12,16,38,.88), rgba(10,14,34,.82));
  border-bottom:1px solid var(--border);
  backdrop-filter: blur(8px);
}

/* ===== FRIENDS v2 (–Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω) ===== */
.friends-wrap{
  max-width: 980px; margin: 12px auto 0; padding: 0 12px;
  padding-bottom: max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px);
}

.friends-header{
  width:100%;
  position: sticky;
  top: 0;
  z-index: 22;
  padding: 10px max(12px, env(safe-area-inset-left)) 12px max(12px, env(safe-area-inset-right));
  text-align:center;
  font-weight:900;
  letter-spacing:1.4px;
  font-size:clamp(24px, 8vw, 52px);
  color:#e8efff;
  text-shadow:0 0 16px rgba(22,241,255,.18);
  background: linear-gradient(180deg, rgba(12,16,38,.88), rgba(10,14,34,.82));
  border-bottom:1px solid var(--border);
  backdrop-filter: blur(8px);
}
.fr-title{
  text-align:center; font-weight:900; letter-spacing:.6px;
  font-size: clamp(18px, 4.6vw, 26px);
  color:#e8efff; text-shadow:0 0 16px rgba(22,241,255,.2);
  margin: 2px 0 6px;
}
.fr-sub{ text-align:center; color:#9fb2d9; font-weight:800; font-size:13px; margin-bottom:12px; }
.fr-sub .bil{ filter: saturate(1.2); }

.fr-cta-row{
  display:grid; grid-template-columns:1fr 44px; gap:10px;
  align-items:stretch; margin-bottom: 10px;
}
.btn{ appearance:none; border:none; cursor:pointer; border-radius:14px; padding:14px 16px; font-weight:900; letter-spacing:.3px; box-shadow: var(--shadow-soft); }
.btn-primary{ color:#081121; background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink)); border:1px solid transparent; }
.btn-icon{ display:grid; place-items:center; background:linear-gradient(135deg, rgba(15,20,48,.92), rgba(12,16,38,.92)); border:1px solid var(--border); color:#e8efff; width:44px; padding:0; }
.btn-ghost{ color:#e8efff; background:linear-gradient(135deg, rgba(15,20,48,.9), rgba(12,16,38,.9)); border:1px solid var(--border); }

.fr-block-title{ font-weight:900; letter-spacing:.4px; color:#d7e6ff; margin: 4px 0 10px; text-shadow:0 0 12px rgba(22,241,255,.15); }
.fr-promo{ display:grid; grid-template-columns:1fr; gap:10px; }
.fr-input{ width:100%; border-radius:12px; border:1px solid var(--border); background:rgba(15,20,48,.9); color:#e8efff; padding:12px 12px; font-weight:800; outline:none; }
.fr-actions{ display:grid; grid-template-columns:1fr; gap:10px; }

.fr-list-wrap{ margin-top:14px; border:1px solid var(--border); border-radius:16px; background:linear-gradient(180deg, rgba(15,20,48,.72), rgba(12,16,38,.72)); }
.fr-list-head{ display:flex; justify-content:space-between; align-items:center; padding:12px 14px; font-weight:900; color:#e8efff; border-bottom:1px solid var(--border); }
.fr-list{ display:flex; flex-direction:column; gap:8px; padding:10px; }
.fr-item{ display:grid; grid-template-columns: 28px 1fr auto; align-items:center; gap:10px; padding:12px; border-radius:12px; border:1px solid var(--border); background:linear-gradient(135deg, rgba(18,24,56,.7), rgba(12,16,38,.7)); }
.fr-item .n{ font-weight:900; color:#e8efff; }
.fr-item .nm{ font-weight:900; color:#e8efff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.fr-item .gain{ display:flex; align-items:center; gap:8px; font-weight:900; color:#e8efff; }
.fr-item .gain img{ width:18px; height:18px; border-radius:4px; object-fit:cover; }

@media (min-width: 680px){
  .fr-cta-row{ grid-template-columns:1fr 48px 1fr; }
  .fr-actions{ grid-template-columns:1fr 1fr; }
}

/* –≥–¥–µ —É–≥–æ–¥–Ω–æ –≤ CSS */
.friends-page{
  padding-bottom: max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px);
}

/* –õ–æ—á–∏–º —Å–∫—Ä–æ–ª–ª –±–µ–∑ position:fixed —É body */
html.scroll-locked, html.scroll-locked body{
  overflow: hidden;
  overscroll-behavior: none; /* –±–µ–∑ —Ä–µ–∑–∫–∏—Ö –ø—Ä—É–∂–∏–Ω –Ω–∞ iOS/Android */
}

/* ===== –°–ï–¢–ö–ê –ö–ê–†–¢–û–ß–ï–ö –ö–ï–ô–°–û–í ===== */
.grid{
  display: grid;
  gap: 14px;
  grid-template-columns: repeat(2, minmax(0, 1fr)); /* 2 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –º–æ–±–∏–ª–µ */
  align-items: start;
}
@media (min-width: 560px){
  .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } /* –ø–ª–∞–Ω—à–µ—Ç */
}
@media (min-width: 960px){
  .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); } /* –¥–µ—Å–∫—Ç–æ–ø */
}

/* ===== –ü–†–ï–í–¨–Æ –í –ö–ê–†–¢–û–ß–ö–ï ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞/–ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ ===== */
.card .thumb{
  /* –≤–∞—Ä–∏–∞–Ω—Ç 1: —Ñ–∏–∫—Å –ø–æ –≤—ã—Å–æ—Ç–µ (–∫–∞–∫ –±—ã–ª–æ) */
  height: 160px !important;

  /* –≤–∞—Ä–∏–∞–Ω—Ç 2: –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å. –≤—ã—Å–æ—Ç—ã ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π: */
  /* aspect-ratio: 16 / 9; height: auto !important; */
}
.card .thumb img{
  width: 100%;
  height: 100%;
  object-fit: cover;   /* –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–º–∫—É, –Ω–µ —Ç—è–Ω–µ—Ç—Å—è –ø–æ –≤—ã—Å–æ—Ç–µ */
  display: block;
}

/* —á—É—Ç—å –æ–≥—Ä–∞–Ω–∏—á–∏–º —Ç–µ–∫—Å—Ç—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ —Ä–∞–∑–¥—É–≤–∞–ª–∏ –∫–∞—Ä—Ç–æ—á–∫—É */
.card .name{
  display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical;
  overflow: hidden;
}
.card .desc{
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  overflow: hidden;
}

/* –ö–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ –¥–æ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –≤–≤–æ–¥–∞ */
.btn:disabled{
  opacity:.55;
  filter: saturate(.7) brightness(.9);
  cursor:not-allowed;
}

/* –ë–µ–π–¥–∂ —Å –≥–æ—Ç–æ–≤—ã–º –ø—Ä–æ–º–æ–∫–æ–¥–æ–º */
.promo-result{
  display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
}
.promo-badge{
  padding:12px 14px;
  border-radius:12px;
  font-weight:900;
  letter-spacing:.3px;
  color:#081121;
  background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink));
  border:1px solid rgba(22,241,255,.35);
  text-align:center;
}

/* –ü—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥ –∫–æ–Ω–∫—É—Ä—Å—ã ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–æ–Ω –∏ ‚Äú–≤–æ–∑–¥—É—Ö‚Äù —Å–Ω–∏–∑—É –ø–æ–¥ —Ç–∞–±–±–∞—Ä */
.contests-page{
  padding-bottom: max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px);
}

/* –¢–∞ –∂–µ —Ñ–æ–Ω–æ–≤–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å, —á—Ç–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ, —á—Ç–æ–±—ã —Ñ–æ–Ω –±—ã–ª –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π */
.contests-surface{
  position:relative;
  min-height:100svh;
  background:
    radial-gradient(60% 40% at 50% -10%, rgba(22,241,255,.06), transparent 60%),
    radial-gradient(60% 40% at 50% 110%, rgba(255,62,208,.05), transparent 60%),
    linear-gradient(180deg, #0b1030 0%, #0a1028 100%);
  border-top:1px solid var(--border);
  box-shadow: inset 0 30px 60px rgba(10,20,60,.35);
}

/* ===== CONTESTS ===== */
.contests-wrap{
  position:relative;
  min-height:100svh;
  background:
    radial-gradient(60% 40% at 50% -10%, rgba(22,241,255,.06), transparent 60%),
    radial-gradient(60% 40% at 50% 110%, rgba(255,62,208,.05), transparent 60%),
    linear-gradient(180deg, #0b1030 0%, #0a1028 100%);
  border-top:1px solid var(--border);
  box-shadow: inset 0 30px 60px rgba(10,20,60,.35);
  padding-bottom: max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px);
}

.contests-header{
  width:100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  position: sticky;
  top: var(--topbar-h, 64px);
  z-index: 22;
  padding: 12px max(12px, env(safe-area-inset-left)) 14px max(12px, env(safe-area-inset-right));
  text-align:center;
  font-weight: 900;
  letter-spacing: 1.2px;
  font-size: clamp(28px, 8vw, 56px);
  color:#e8efff;
  text-shadow:0 0 16px rgba(22,241,255,.2);
  background: linear-gradient(180deg, rgba(12,16,38,.88), rgba(10,14,34,.82));
  border-bottom:1px solid var(--border);
  backdrop-filter: blur(8px);
}

.contests-list{
  max-width: 980px;
  margin: 10px auto 0;
  padding: 0 12px 20px;
  display:flex;
  flex-direction:column;
  gap: 0; /* —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å–∞–º–∏ –¥–∞–¥—É—Ç —Ä–∏—Ç–º */
}

/* –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ */
.cont-card{
  display:grid;
  grid-template-columns: 88px 1fr;
  align-items:center;
  gap: 14px;
  padding: 12px;
  border-radius: 14px;
  background: linear-gradient(135deg, rgba(15,20,48,.82), rgba(12,16,38,.82));
  border: 1px solid var(--border);
  box-shadow: var(--shadow-soft);
}

/* 1:1 –æ–∫–Ω–æ –ø–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
.cont-img{
  width: 88px;
  aspect-ratio: 1 / 1;
  border-radius: 12px;
  border: 1px dashed rgba(180,210,255,.35);
  background:
    radial-gradient(80px 60px at 50% 50%, rgba(22,241,255,.10), transparent 60%),
    linear-gradient(180deg,#0b1030,#0a1028);
  overflow:hidden;
  display:grid; place-items:center;
}
.cont-img img{
  width: 100%;
  height: 100%;
  object-fit: cover;    /* —Å—Ç—Ä–æ–≥–æ 1:1 –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π */
  display:block;
}

/* –±–ª–æ–∫ —Å–ø—Ä–∞–≤–∞ */
.cont-right{
  display:flex;
  align-items:center;
  gap: 12px;
  min-width: 0;
}

/* —Å–∏–Ω–∏–π @username –≤ —Å—Ç–∏–ª–µ Telegram */
.cont-username{
  font-weight: 900;
  font-size: clamp(18px, 5.4vw, 32px);
  color: #2AABEE;         /* Telegram-–≥–æ–ª—É–±–æ–π */
  text-decoration: none;
  text-shadow: 0 0 10px rgba(42,171,238,.25);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
}

/* –º–∞–ª–µ–Ω—å–∫–∞—è –∑–∞–≥–ª—É—à–∫–∞-–∫–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª) */
.cont-btn{
  appearance:none; border:1px solid var(--border);
  background:linear-gradient(135deg, rgba(15,20,48,.9), rgba(12,16,38,.9));
  color:#e8efff; font-weight:900; letter-spacing:.3px;
  border-radius:12px; padding:10px 12px; cursor:pointer;
}
.cont-btn:active{ transform: translateY(1px); }

.contests-list { gap: 10px; } /* –≤–º–µ—Å—Ç–æ 0 */

/* === CONTESTS (fixed, no-scroll) === */
.contests-fixed{
  position: fixed;
  left: 0; right: 0;
  top: var(--topbar-h, 64px);
  bottom: var(--tabbar-h, 84px);
  z-index: 22;
  overflow: hidden; /* –≤–æ–æ–±—â–µ –±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞ */
  background:
    radial-gradient(60% 40% at 50% -10%, rgba(22,241,255,.06), transparent 60%),
    radial-gradient(60% 40% at 50% 110%, rgba(255,62,208,.05), transparent 60%),
    linear-gradient(180deg, #0b1030 0%, #0a1028 100%);
  border-top:1px solid var(--border);
  box-shadow: inset 0 30px 60px rgba(10,20,60,.35);
  display: grid;
  grid-template-rows: auto 1fr; /* —à–∞–ø–∫–∞ + –∫–æ–Ω—Ç–µ–Ω—Ç */
}

/* —à–∞–ø–∫–∞ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞ */
.contests-fixed .contests-header{
  padding: 12px max(12px, env(safe-area-inset-left)) 14px max(12px, env(safe-area-inset-right));
  text-align:center;
  font-weight: 900; letter-spacing: 1.2px;
  font-size: clamp(28px, 8vw, 56px);
  color:#e8efff;
  text-shadow:0 0 16px rgba(22,241,255,.2);
  background: linear-gradient(180deg, rgba(12,16,38,.88), rgba(10,14,34,.82));
  border-bottom:1px solid var(--border);
  position: static;  /* –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π sticky */
  width: auto;       /* —É–±–∏—Ä–∞–µ–º 100vw –∏–∑ –æ–±—â–µ–≥–æ —Å—Ç–∏–ª—è */
  margin: 0;         /* —Å–Ω–∏–º–∞–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä–≥–∏–Ω—ã */

}

/* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ */
.contests-center{
  display:grid;
  place-items:center; /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏, –∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
}

/* —Å–ø–∏—Å–æ–∫ –≤–Ω—É—Ç—Ä–∏ —Ñ–∏–∫—Å-—Å—Ü–µ–Ω—ã; –±–µ–∑ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
.contests-fixed .contests-list{
  padding: 12px;
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow: hidden; /* –¥–∞–∂–µ –µ—Å–ª–∏ –º–Ω–æ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫ ‚Äî —Å—Ü–µ–Ω–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–æ–π */
}

/* ===== UPGRADES (—Å—á—ë—Ç—á–∏–∫ —Å –∫—É–±–∏–∫–æ–º) ===== */
:root{
  --upg-bar-h: 56px;
  --upg-thumb: 24px;
}

.upg-surface{
  position:relative;
  min-height:100svh;
  background:
    radial-gradient(60% 40% at 50% -10%, rgba(22,241,255,.06), transparent 60%),
    radial-gradient(60% 40% at 50% 110%, rgba(255,62,208,.05), transparent 60%),
    linear-gradient(180deg, #0b1030 0%, #0a1028 100%);
  border-top:1px solid var(--border);
  box-shadow: inset 0 30px 60px rgba(10,20,60,.35);
  padding: 18px 12px max(var(--tabbar-h,84px), env(safe-area-inset-bottom) + 16px);
}

.upg-wrap{
  max-width: 980px;
  margin: 0 auto;
  display: grid;
  gap: 18px;
}

/* –í–µ—Ä—Ö–Ω–∏–π —Å—á—ë—Ç –∫—Ä—É–ø–Ω–æ–π —Ü–∏—Ñ—Ä–æ–π */
.upg-score{
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-weight: 900;
  letter-spacing: .8px;
  font-size: clamp(56px, 20vw, 120px);
  color: #ffffff;
  text-shadow: 0 0 16px rgba(22,241,255,.18);
}

/* –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å–ø—Ä–∞–≤–∞ –æ—Ç –±–æ–ª—å—à–æ–≥–æ —Å—á—ë—Ç–∞ */
.upg-art{
  width: 1em;           /* —Ä–æ–≤–Ω–æ —Ä–∞–∑–º–µ—Ä —Ü–∏—Ñ—Ä—ã ¬´1¬ª */
  height: 1em;
  object-fit: contain;
  opacity: .7;          /* –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ */
  mix-blend-mode: soft-light; /* ¬´—Å–ª–∏—Ç—å¬ª —Å —Ñ–æ–Ω–æ–º */
  filter: saturate(1.1) contrast(1.02);
}

/* –ü–æ–ª–æ—Å–∞ */
.upg-bar{
  border: 1px solid var(--border);
  border-radius: 12px;
  background: #0b0c12;
  box-shadow: inset 0 0 20px rgba(0,0,0,.35);
  padding: 6px;
}

.upg-track{
  position: relative;
  height: var(--upg-bar-h);
  border-radius: 10px;
  background:
    linear-gradient(180deg, rgba(20,26,62,.55), rgba(14,18,40,.6));
  overflow: hidden;
}

/* –ª–µ–≤–∞—è ¬´—Å—Ç–∞—Ä—Ç–æ–≤–∞—è¬ª –ø–æ–¥–ª–æ–∂–∫–∞ –∫–∞–∫ –Ω–∞ –º–∞–∫–µ—Ç–µ (–±–∏—Ä—é–∑–∞) */
.upg-start-bg{
  position:absolute; left:0; top:0; bottom:0;
  width: min(160px, 40%);
  background: #29c9d2;
  opacity: .85;
}

/* –ö—É–±–∏–∫ */
.upg-thumb{
  position:absolute; top: 50%; left: 0;
  width: var(--upg-thumb); height: var(--upg-bar-h);
  transform: translateY(-50%);
  border-radius: 6px;
  background: linear-gradient(180deg, #24d0d8, #21b8bf);
  box-shadow: 0 0 22px rgba(33, 220, 230, .35);
  cursor: grab;
  touch-action: none;
}

/* –°—Ç—Ä–æ–∫–∏ ¬´500 = 1 (—Ç–æ–∫–µ–Ω) / 5000 = 10 (–∑–≤–µ–∑–¥–∞)¬ª */
.upg-rows{
  display: grid; gap: 12px;
  margin-top: 8px;
}
.upg-row{
  display:flex; align-items:center; gap: 12px;
  font-weight: 900;
  letter-spacing: .4px;
  color: #e8efff;
  font-size: clamp(18px, 6vw, 28px);
}
.upg-row .ico{
  width: 1em; height: 1em;
  opacity: .75;
  mix-blend-mode: soft-light;
  object-fit: contain;
  filter: saturate(1.05);
}
.upg-row .xart{
  width: 1.4em; height: 1.4em;
  opacity: .7; mix-blend-mode: soft-light;
  margin-right: 2px;
}

/* –º–∞–ª–µ–Ω—å–∫–∞—è –ø–æ–¥–ø–∏—Å—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */
.upg-note{
  text-align:center;
  font-size: 12px;
  color:#9fb2d9;
  opacity:.9;
}

  </style>

<style>

.hide { display: none !important; }

/* CTA-–∫–Ω–æ–ø–∫–∏: –Ω–µ –ª–æ–º–∞–µ–º layout, —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ visibility */
.spin-cta{
  visibility: hidden;         /* –Ω–µ–≤–∏–¥–∏–º—ã, –Ω–æ –º–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–æ */
  display: inline-flex;       /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
  align-items: center;
  gap: 8px;
}
.spin-cta.show{
  visibility: visible;        /* –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —Ä–æ–¥–∏—Ç–µ–ª—è */
}


/* === 3D –±–∞—Ä–∞–±–∞–Ω (—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ, –æ–¥–Ω–∞ —è—á–µ–π–∫–∞) === */
:root{
  /* —Ä–∞–∑–º–µ—Ä—ã –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∏–∑ JS */
  --reel-slice-w: 210px;
  --reel-slice-h: 128px;
  --reel-min-h:   360px;
}

.drum-wrap{
  position:relative;
  width:100%;
  height:100%;
  min-height: var(--reel-min-h);
  display:grid; place-items:center;
  perspective: 1200px;
}

.drum-stage{
  position:relative;
  width:min(560px, 92%);
  height:100%;
  border-radius:16px;
  border:1px solid var(--border);
  background:linear-gradient(180deg,#0c1230,#0a1028);
  box-shadow:inset 0 0 24px rgba(22,241,255,.12);
  overflow:hidden;
}

/* —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ, –±–µ–∑ –Ω–∞–∫–ª–æ–Ω–∞ */
.drum-tilt{
  position:absolute; inset:18px;
  transform-style:preserve-3d;
}

.drum{
  position:absolute; left:50%; top:50%;
  transform-style:preserve-3d;
  will-change:transform;
}

/* ¬´–≤–∫–ª–∞–¥–∫–∏¬ª –±–∞—Ä–∞–±–∞–Ω–∞ */
.slice{
  position:absolute; left:50%; top:50%;
  width: var(--reel-slice-w);
  height: var(--reel-slice-h);
  margin: calc(-1 * var(--reel-slice-h) / 2) calc(-1 * var(--reel-slice-w) / 2);
  border-radius:14px;
  border:1px dashed rgba(180,210,255,.35);
  background:
    radial-gradient(120px 80px at 20% 20%, rgba(22,241,255,.10), transparent 60%),
    radial-gradient(120px 80px at 80% 80%, rgba(255,62,208,.08), transparent 60%),
    linear-gradient(180deg,#0b1030,#0a1028);
  box-shadow:0 8px 26px rgba(10,20,60,.35);
  display:grid; grid-template-rows:1fr auto; align-items:center; justify-items:center;
  overflow:hidden;
  backface-visibility:hidden; -webkit-backface-visibility:hidden;
}

.slice .meta{
  width:100%; padding:8px 10px;
  font-weight:900; letter-spacing:.3px; font-size:12px; color:#a9c2ff;
  display:flex; align-items:center; justify-content:space-between;
}
.slice .value{
  color:var(--neon-yellow); text-shadow:0 0 12px rgba(255,228,122,.25);
  font-weight:900; font-size:14px;
}

/* —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –≤—ã–∏–≥—Ä—ã—à–∞ */
.drum-pointer{
  position:absolute; left:0; right:0; top:50%;
  transform:translateY(-50%); height:2px;
  background:linear-gradient(90deg, transparent, var(--neon-cyan), var(--neon-pink), transparent);
  box-shadow:0 0 14px rgba(22,241,255,.45), 0 0 20px rgba(255,62,208,.25);
  pointer-events:none;
}

/* –ª—ë–≥–∫–∞—è –≤–∏–Ω—å–µ—Ç–∫–∞ –¥–ª—è –≥–ª—É–±–∏–Ω—ã */
.drum-stage:before, .drum-stage:after{
  content:""; position:absolute; left:0; right:0; height:22%;
  pointer-events:none; z-index:5;
  background:linear-gradient(180deg, rgba(8,14,36,.8), transparent);
}
.drum-stage:after{ bottom:0; top:auto; transform:rotate(180deg); }

/* üîß –ö–í–ê–î–†–ê–¢–ù–ê–Ø –†–ê–ú–ê –î–õ–Ø –ö–ê–†–¢–ò–ù–ö–ò –í –ë–ê–†–ê–ë–ê–ù–ï */
.slice .img{
  position: relative;
  aspect-ratio: 1 / 1;
  width: 100%;
  height: auto;
  padding: 0;
  border-bottom: 1px solid var(--border);
  background: radial-gradient(80px 60px at 50% 50%, rgba(22,241,255,.10), transparent 60%);
  overflow: hidden;
  box-sizing: border-box;
}

/* üîß –ö–ê–†–¢–ò–ù–ö–ê –í–°–ï–ì–î–ê –¶–ï–õ–ò–ö–û–ú –í–ù–£–¢–†–ò 1:1 –†–ê–ú–´ */
.slice .img img{
  position: absolute;
  inset: 8px;
  width: calc(100% - 16px);
  height: calc(100% - 16px);
  object-fit: contain;
  display: block;
  max-width: none;
  max-height: none;
  border-radius: 12px;
} /* ‚Üê –≤–æ—Ç —ç—Ç–æ–π —Å–∫–æ–±–∫–∏ –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ */

/* === –û–≤–µ—Ä—Ä–∞–π–¥—ã –¢–û–õ–¨–ö–û –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞ === */
.drum .slice {
  grid-template-rows: 1fr;
}

/* —Ä–∞–º–∫–∞ 1:1 + —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
.drum .slice .img{
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  padding: 0;
  aspect-ratio: 1 / 1;
  overflow: hidden;
  border-bottom: none;
  background: radial-gradient(80px 60px at 50% 50%, rgba(22,241,255,.10), transparent 60%);
}

/* –∫–∞—Ä—Ç–∏–Ω–∫–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É, –±–µ–∑ –æ–±—Ä–µ–∑–∞–Ω–∏—è –∫—Ä–∞—ë–≤ */
.drum .slice .img img{
  position: static !important;
  inset: auto !important;
  width: 88%;
  height: 88%;
  object-fit: contain;
  border-radius: 12px;
  display: block;
}

/* ===== DROP MODAL ===== */
.modal{
  position:fixed; inset:0; z-index:90;   /* –≤—ã—à–µ detail */
  display:none; align-items:center; justify-content:center;
}
.modal.show{ display:flex; }
.modal::before{
  content:""; position:absolute; inset:0;
  background:linear-gradient(180deg, rgba(8,14,36,.75), rgba(6,10,26,.85));
  backdrop-filter: blur(8px);
  /* –±–ª–æ–∫–∏—Ä—É–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ñ–æ–Ω–æ–º */
}

/* ‚Äî‚Äî –∂—ë—Å—Ç–∫–æ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ –∏ –±–µ–∑ —à–∞–Ω—Å–∞ –±—ã—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–æ–π ‚Äî‚Äî */
.modal{
  z-index: 99999 !important;
  pointer-events: auto !important;
}
.modal.show{
  display: flex !important;
}
.modal .modal-card{
  z-index: 2;          /* –ø–æ–≤–µ—Ä—Ö ::before */
}

.modal-card{
  position:relative; z-index:1;
  width:min(520px, 92%); padding:16px;
  border-radius:20px; border:1px solid var(--border);
  background:linear-gradient(180deg, rgba(20,26,62,.75), rgba(14,18,40,.88));
  box-shadow: var(--shadow-strong);
  animation: modal-pop .22s cubic-bezier(.2,.7,.2,1) both;
}
@keyframes modal-pop{
  from{ transform:translateY(12px) scale(.98); opacity:0 }
  to  { transform:translateY(0)    scale(1);    opacity:1 }
}

.modal-title{
  text-align:center; font-weight:900; letter-spacing:.8px;
  margin-bottom:12px; color:#d7e6ff; text-shadow:0 0 16px rgba(22,241,255,.25);
}

.modal-image{
  width:100%; aspect-ratio:1/1; border-radius:16px;
  border:1px dashed rgba(180,210,255,.35);
  background:
    radial-gradient(120px 80px at 50% 50%, rgba(22,241,255,.10), transparent 60%),
    linear-gradient(180deg,#0b1030,#0a1028);
  display:grid; place-items:center; overflow:hidden; margin-bottom:12px;
}
.modal-image img{
  width:88%; height:88%; object-fit:contain; border-radius:12px; display:block;
}

/* === –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–æ–¥–∞–ª–∫–∞—Ö (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –¥—Ä–æ–ø) === */
.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

.modal-actions .btn {
  appearance: none;
  cursor: pointer;
  border: none;
  padding: 12px 18px;
  border-radius: 14px;
  font-weight: 900;
  box-shadow: var(--shadow-soft);

  /* üíé –ù–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —à–∏—Ä–∏–Ω—ã */
  flex: 1 1 0;           /* –æ–±–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–ª—è—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ—Ä–æ–≤–Ω—É */
  text-align: center;
  min-width: 120px;       /* –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∂–∞—Ç–∏—è */
  max-width: 160px;       /* –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–ª–∏—Å—å —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ */
}

.modal-actions .btn.keep{
  color:#081121; background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink));
  border:1px solid transparent;
}
.modal-actions .btn.sell{
  color:#e8efff; background:linear-gradient(135deg, rgba(15,20,48,.9), rgba(12,16,38,.9));
  border:1px solid var(--border);

}

/* —Ç–µ–∫—Å—Ç –≤ –º–æ–¥–∞–ª–∫–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
.modal-text{
  margin: 6px 0 12px;
  text-align:center;
  font-weight:800;
  letter-spacing:.3px;
  color:#d7e6ff;
}

/* –∑–µ–ª—ë–Ω–∞—è "–î–ê" –∏ –∫—Ä–∞—Å–Ω–∞—è "–ù–ï–¢" –≤ –≥–ª–∏—Ç—á-—Å—Ç–∏–ª–µ */
.modal-actions .btn.btn-yes{
  color:#081121;
  background:linear-gradient(135deg, #54ffa8, #19e6ff);
  border:1px solid transparent;
  box-shadow:0 10px 28px rgba(25,230,255,.35), 0 0 30px rgba(84,255,168,.25);
}
.modal-actions .btn.btn-no{
  color:#fff;
  background:linear-gradient(135deg, #ff4d6d, #b3123e);
  border:1px solid rgba(255,90,120,.45);
  box-shadow:0 10px 22px rgba(255,77,109,.25);
}

.inv-sell{
  position:absolute;
  left:50%;
  bottom:10px;
  transform:translateX(-50%);
  appearance:none;
  border:none;
  padding:10px 18px;
  border-radius:999px;
  font-weight:900;
  letter-spacing:.3px;
  cursor:pointer;
  color:#081121;
  background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink));
  border:1px solid rgba(22,241,255,.35);
  box-shadow:0 8px 22px rgba(22,241,255,.28), 0 0 24px rgba(255,62,208,.22);
}
.inv-sell:active{ transform:translateX(-50%) translateY(1px); }

</style>

</head>
<body>
  <div class="cyber-bg"></div>

  <div class="app" id="top">
    <div class="topbar">
      <img id="userAvatar" class="avatar hidden" alt="avatar">
      <div id="avatarFallback" class="avatar-fallback">GD</div>
      <div class="brand">
  <div class="brand-lines">
    <span id="userName" class="glitch" data-text="GLITCH&nbsp;DROP">GLITCH&nbsp;DROP</span>
    <span id="userId" class="uid" aria-label="User ID">ID 00000000</span>
  </div>
</div>

      <div class="grow"></div>

      <!-- –ü–∏–ª—é–ª—è –ì–õ–ò–¢–ß-–¢–û–ö–ï–ù —Å–ª–µ–≤–∞ -->
      <div class="pill pill--lg" title="–ì–ª–∏—Ç—á-—Ç–æ–∫–µ–Ω">
        <img src="assets/images/20251005_0825_–Ø—Ä–∫–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ_remix_01k6sd902pf03ah1w3cpkr66jz.png" alt="–≥–ª–∏—Ç—á-—Ç–æ–∫–µ–Ω">
        <span class="num" id="bonus">50</span>
      </div>

      <!-- –ü–∏–ª—é–ª—è —Å–æ –ó–í–ï–ó–î–û–ô —Å–ø—Ä–∞–≤–∞ (—Ç–∞–∫–æ–π –∂–µ —Ä–∞–∑–º–µ—Ä) -->
      <div class="pill pill--lg">
        <img src="assets/images/–∑–≤–µ–∑–¥–∞.png" alt="–∑–≤–µ–∑–¥–∞">
        <span class="num" id="stars">120</span>
      </div>
    </div>

    <div class="chipbar" id="chipbar"><div class="chip active" data-target="#top">–í—Å–µ</div></div>
    <div class="content" id="content"></div>

<!-- –ü–£–°–¢–û–ô –≠–ö–†–ê–ù –ü–†–û–§–ò–õ–Ø -->
<div class="hide" id="profileScreen" aria-hidden="true"></div>
<!-- –ü–£–°–¢–û–ô –≠–ö–†–ê–ù –î–†–£–ó–ï–ô -->
<div class="hide" id="friendsScreen" aria-hidden="true"></div>

<!-- –ü–£–°–¢–û–ô –≠–ö–†–ê–ù –ö–û–ù–ö–£–†–°–û–í -->
<div class="hide" id="contestsScreen" aria-hidden="true"></div>

<!-- –ü–£–°–¢–û–ô –≠–ö–†–ê–ù –ê–ü–ì–†–ï–ô–î–û–í -->
<div class="hide" id="upgradesScreen" aria-hidden="true"></div>


    <nav class="tabbar">
  <div class="tab"><div class="ico">üèÜ</div>–ö–æ–Ω–∫—É—Ä—Å—ã</div>
  <div class="tab"><div class="ico">‚ö°</div>–ê–ø–≥—Ä–µ–π–¥</div>
  <div class="tab active"><div class="ico">üéÅ</div>–ö–µ–π—Å—ã</div>
  <div class="tab"><div class="ico">üë•</div>–î—Ä—É–∑—å—è</div>

  <!-- –±—ã–ª–æ: üë§ –ü—Ä–æ—Ñ–∏–ª—å -->
  <div class="tab" data-tab="inventory">
    <div class="ico"><img src="assets/images/ChatGPT Image 12 –æ–∫—Ç. 2025 –≥., 11_12_45.png" alt="–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å"></div>
    –ò–ù–í–ï–ù–¢–ê–†–¨
  </div>
</nav>

  <!-- DETAIL VIEW -->
  <div id="detail" class="detail" aria-hidden="true">
    <div class="d-topbar">
      <button id="backBtn" class="btn-back">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="d-title" id="detailTitle">–ö–µ–π—Å</div>
      <div class="grow"></div>
    </div>
    <div class="d-body">
      <div class="d-hero">
        <div id="detailThumb" class="d-thumb">–ó–∞–≥–ª—É—à–∫–∞</div>
        <div class="d-actions">
  <button class="btn-spin" id="spinStartBtn">–ö–†–£–¢–ò–¢–¨</button>
  <div class="pill"><span>–¶–µ–Ω–∞:</span><span class="num" id="detailPrice">‚Äî</span></div>
</div>

</div> <!-- –∑–∞–∫—Ä—ã–≤–∞–µ—Ç .d-hero -->
<div class="subhead">–°–û–î–ï–†–ñ–ò–ú–û–ï –ö–ï–ô–°–ê</div>
<div id="lootGrid" class="loot-grid"></div>
<div style="height:40px"></div>
    </div> <!-- ‚Üê‚Üê –∑–∞–∫—Ä—ã–ª .d-body -->
  </div>   <!-- ‚Üê‚Üê –∑–∞–∫—Ä—ã–ª #detail -->

<!-- DROP MODAL -->
<div id="dropModal" class="modal" aria-hidden="true" aria-modal="true" role="dialog">
  <div class="modal-card" role="document">
    <div class="modal-title">–ü–†–ï–î–ú–ï–¢ –ü–û–õ–£–ß–ï–ù</div>
    <div class="modal-image">
      <img id="dropImg" alt="–í—ã–ø–∞–≤—à–∏–π –ø—Ä–µ–¥–º–µ—Ç">
    </div>
    <div class="modal-actions">
      <button id="keepBtn" class="btn keep">–û–°–¢–ê–í–ò–¢–¨</button>
      <button id="sellBtn" class="btn sell">–ü–†–û–î–ê–¢–¨</button>
    </div>
  </div>
</div>

<!-- CONFIRM SELL MODAL -->
<div id="confirmModal" class="modal" aria-hidden="true" aria-modal="true" role="dialog">
  <div class="modal-card" role="document">
    <div class="modal-title">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ü–†–û–î–ê–ñ–£</div>
    <div id="confirmText" class="modal-text">
      –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?
    </div>
    <div class="modal-actions">
      <button id="confirmNo"  class="btn btn-no">–ù–ï–¢</button>
      <button id="confirmYes" class="btn btn-yes">–î–ê</button>
    </div>
  </div>
</div>

<button id="backTop" class="backtop" aria-label="–í–≤–µ—Ä—Ö">–í–í–ï–†–• ‚Üë</button>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
  window.GD = window.GD || {};
  window.API_BASE = 'https://sneerful-anamaria-doucely.ngrok-free.dev';
  GD.API_BASE = window.API_BASE;
</script>


<script>
// === App namespace (–æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –≤–æ –≤—Å—ë–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏) ===

// —Ç–æ—á–Ω—ã–π –Ω–∏–∫ –±–æ—Ç–∞ –ë–ï–ó @
GD.BOT_USERNAME = 'Glitchdrop_bot';

// —Ö–µ—à + —Ñ–æ—Ä–º–∞—Ç –ø–æ–¥ 8 —Ü–∏—Ñ—Ä (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–æ–ª–±—ç–∫–∞—Ö)
GD._fnv1a = function(str){
  let h = 0x811c9dc5;
  for (let i = 0; i < str.length; i++){ h ^= str.charCodeAt(i); h = (h >>> 0) * 0x01000193; }
  return h >>> 0;
};
GD._to8 = n => String(n % 100000000).padStart(8,'0');

// —á–∏—Ç–∞–µ–º uid8 –∏–∑ localStorage (–µ–≥–æ –∫–ª–∞–¥—ë—Ç getOrFetchUid8 –Ω–∏–∂–µ)
GD.getUid8 = function(){
  try{
    const v = localStorage.getItem('gd_uid8');
    return (v && /^\d{8}$/.test(v)) ? v : '00000000';
  }catch(_){ return '00000000'; }
};

// —Å—Ç—Ä–æ–∏–º —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
GD.buildInviteLink = function(){
  const uid = GD.getUid8();
  return `https://t.me/${GD.BOT_USERNAME}?startapp=ref_${uid}`;
};

GD._uid8Promise = null;

GD.ensureUid8 = function(tgUserId){
  // –µ—Å–ª–∏ —É–∂–µ –∏–¥—ë—Ç –∑–∞–ø—Ä–æ—Å ‚Äî –æ—Ç–¥–∞—Ç—å —Ç–æ—Ç –∂–µ –ø—Ä–æ–º–∏—Å
  if (GD._uid8Promise) return GD._uid8Promise;

  // –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π –∫–µ—à ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
  const cached = GD.getUid8();
  if (cached && cached !== '00000000') return Promise.resolve(cached);

  // –µ–¥–∏–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Å–µ—Ö ¬´–∂–¥—É—â–∏—Ö¬ª
  GD._uid8Promise = (async () => {
    try{
      if (typeof window.getOrFetchUid8 === 'function'){
        return await window.getOrFetchUid8(tgUserId);
      }
    }catch(_){}
    // –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–æ–ª–±—ç–∫ ‚Äî —á—Ç–æ –µ—Å—Ç—å –≤ localStorage (–∏–ª–∏ 00000000)
    return GD.getUid8();
  })();

  return GD._uid8Promise;
};

// ...—Ç–≤–æ–∏ GD.* —É—Ç–∏–ª–∏—Ç—ã –≤—ã—à–µ...

// –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –≠–ö–†–ê–ù–ò–ó–ê–¶–ò–Ø –¢–ï–ö–°–¢–ê –î–õ–Ø –í–°–¢–ê–í–ö–ò –í innerHTML
window.esc = function(s){
  return String(s)
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#39;')
    .replaceAll('/','&#47;');
};

async function fetchInvited(){
  const uid8 = await GD.ensureUid8();     // —Ç—ã —É–∂–µ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å
  try{
    const r = await fetch(`${window.API_BASE}/api/referrals?uid8=${uid8}`, { method:'GET' });
    if(!r.ok) return [];
    const data = await r.json();
    return Array.isArray(data.items) ? data.items : [];
  }catch(_){ return []; }
}

window.safeOpen = function(url){
  const tg = window.Telegram?.WebApp;

  // –í–Ω—É—Ç—Ä–∏ Telegram Mini App
  if (tg?.openTelegramLink){ tg.openTelegramLink(url); return; }
  if (tg?.openLink){ tg.openLink(url, { tryBrowser:true }); return; }

  // –í–Ω–µ Telegram
  const w = window.open(url, '_blank', 'noopener,noreferrer');
  if (!w || w.closed) window.location.href = url;
};

</script>


<script>
// ====== –î–ê–ù–ù–´–ï ======
const LOOT_SETS = { /* <-- —Ç–≤–æ–∏ –º–∞—Å—Å–∏–≤—ã, –æ—Å—Ç–∞–≤–ª—è—é –∫–∞–∫ –µ—Å—Ç—å */ 
  cheap_1:[ "assets/images/20251003_1635_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n4frmwe74ry17r7gszk6ef.png",
    "assets/images/20251003_1629_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n43z74eq3ve8a9rcx44f02.png",
    "assets/images/20251003_1627_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n416bkeassbn7rx8a17bdt.png",
    "assets/images/20251012_1000_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k7bkfcsqe3mts7q04f9z6xgq.png",
    "assets/images/20251003_1624_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3v1nbffkrc39mm720d2gm.png",
    "assets/images/20251008_1905_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k72913cgfyy90e2abb8t2dft.png",
    "assets/images/20251003_1632_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n49ebnfssrvwq0605g9bkx.png",
    "assets/images/20251003_1621_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3p2hwf4fbk1r0rqbvdc5d.png",
    "assets/images/20251003_1620_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3k7yrey7864fgc944j33p.png",
    "assets/images/20251003_1618_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3fv8bej7813hnthjyags5.png",
    "assets/images/20251003_1616_–°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º_remix_01k6n3czjze6paj61x9g5r7ab3.png"
  ],
  cheap_2:["assets/images/—Å–Ω—É–ø–ø –¥–æ–≥.png","assets/images/20251003_1635_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n4frmwe74ry17r7gszk6ef.png","assets/images/20251003_1627_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n416bkeassbn7rx8a17bdt.png","assets/images/20251003_1629_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n43z74eq3ve8a9rcx44f02.png","assets/images/20251012_1000_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k7bkfcsqe3mts7q04f9z6xgq.png","assets/images/20251003_1632_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n49ebnfssrvwq0605g9bkx.png","assets/images/20251003_1624_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3v1nbffkrc39mm720d2gm.png","assets/images/20251008_1905_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k72913cgfyy90e2abb8t2dft.png","assets/images/20251003_1620_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3k7yrey7864fgc944j33p.png","assets/images/20251003_1616_–°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º_remix_01k6n3czjze6paj61x9g5r7ab3.png","assets/images/20251003_1618_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3fv8bej7813hnthjyags5.png"],
  cheap_3:["assets/images/kniga.png","assets/images/klever.png","assets/images/20251003_1635_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n4frmwe74ry17r7gszk6ef.png","assets/images/20251003_1627_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n416bkeassbn7rx8a17bdt.png","assets/images/20251003_1629_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n43z74eq3ve8a9rcx44f02.png","assets/images/20251003_1624_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3v1nbffkrc39mm720d2gm.png","assets/images/20251008_1905_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k72913cgfyy90e2abb8t2dft.png","assets/images/20251003_1621_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3p2hwf4fbk1r0rqbvdc5d.png","assets/images/20251003_1620_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3k7yrey7864fgc944j33p.png","assets/images/20251003_1618_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3fv8bej7813hnthjyags5.png","assets/images/20251003_1616_–°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º_remix_01k6n3czjze6paj61x9g5r7ab3.png"],
  cheap_4:["","","","","","","","","","",""],
  nft_1:["","","","","","","","","","",""],
  nft_2:["","","","","","","","","","",""],
  nft_3:["","","","","","","","","","",""],
  nft_4:["","","","","","","","","","",""],
  exclusive_1:["","","","","","","","","","",""],
  exclusive_2:["","","","","","","","","","",""],
  exclusive_3:["","","","","","","","","","",""],
  exclusive_4:["","","","","","","","","","",""],
  standard_1:["","","","","","","","","","",""],
  standard_2:["","","","","","","","","","",""],
  standard_3:["","","","","","","","","","",""],
  standard_4:["","","","","","","","","","",""],
  gold_1:["","","","","","","","","","",""],
  gold_2:["","","","","","","","","","",""],
  gold_3:["","","","","","","","","","",""],
  gold_4:["","","","","","","","","","",""],
  allornothing_1:["","","","","","","","","","",""],
  allornothing_2:["","","","","","","","","","",""],
  allornothing_3:["","","","","","","","","","",""],
  allornothing_4:["","","","","","","","","","",""],
  expensive_1:["","","","","","","","","","",""],
  expensive_2:["","","","","","","","","","",""],
  expensive_3:["","","","","","","","","","",""],
  expensive_4:["","","","","","","","","","",""],
};

const CHEAP_BACK_TEXT = {
  cheap_1: Array(11).fill({stars:"174000/", ton:"870"}),
  cheap_2: Array(11).fill({stars:"174000/", ton:"870"}),
  cheap_3: Array(11).fill({stars:"174000/", ton:"870"}),
  cheap_4: Array(11).fill({stars:"174000/", ton:"870"}),
};

const CASE_THUMBS = {
  free:["assets/images/20251006_1323_–ò–∑—É–º—Ä—É–¥–Ω—ã–π –∫–µ–π—Å_remix_01k6wgnp9kfc7t5tsc54yag55g.png","assets/images/20251006_1250_–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π –ì–ª–∏—Ç—á –ö–µ–π—Å_remix_01k6wes6ykf1rtbax6cajjgpae.png","assets/images/20251006_1340_–ñ—ë–ª—Ç—ã–π –ì–ª–∏—Ç—á –î—Ä–æ–ø_remix_01k6whmtz7e3d8ejjj7vz9dt6z.png","assets/images/case 10 000.png"],
  cheap:["assets/images/20251010_1652_–ó–æ–ª–æ—Ç–æ–π –ö—É–±–æ–∫_remix_01k7767y0he76bx0bzxsakmpd4.png","","",""],
  nft:["assets/images/ChatGPT Image 5 –æ–∫—Ç. 2025 –≥., 10_33_06.png","assets/images/ChatGPT Image 5 –æ–∫—Ç. 2025 –≥., 11_26_19.png","assets/images/NFT 3.png","assets/images/20251005_1527_–ó–µ–ª—ë–Ω–∞—è –ø—Ä–∏–∑—Ä–∞—á–Ω–∞—è —Ç—ã–∫–≤–∞_remix_01k6t5bwrrfxet6r4vzrkgra3k.png"],
  exclusive:["assets/images/20251005_1639_–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∑–º–µ—è_remix_01k6t9fz7mevwt1beaq5bxehc4.png","assets/images/20251005_1703_–§–µ–Ω —Å —Ä–æ–∑–æ–≤–æ–π –ª–µ–Ω—Ç–æ–π_remix_01k6tavjk3fq8brq0e5fr8hycw.png","assets/images/20251005_1718_–°—Ç–∏–ª—å–Ω—ã–π —à–∫–æ–ª—å–Ω—ã–π —Ä—é–∫–∑–∞–∫_simple_compose_01k6tbpyfyedkb0r4qcr8r6p8m.png","assets/images/20251005_1752_–†–∞–¥—É–∂–Ω—ã–µ –ì—É–±—ã –∏ –ü—É–∑—ã—Ä–∏_remix_01k6tdn1ebem893yskvv82bpgz.png"],
  standard:["","","",""],
  gold:["","","",""],
  allornothing:["","","",""],
  expensive:["","","",""],
};

const sections = [
  { id:'free',        title:'–ë–ï–°–ü–õ–ê–¢–ù–´–ï –ö–ï–ô–°–´',  items:4, price:'–ë–ï–°–ü–õ–ê–¢–ù–û',
    descs:['–ë–æ–Ω—É—Å –∑–∞ –ø—Ä–æ–º–æ–∫–æ–¥','–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å','–ó–∞ –ø–æ–¥–ø–∏—Å–∫—É','–ó–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ'] },
  { id:'cheap',       title:'–î–ï–®–Å–í–´–ï –ö–ï–ô–°–´',     items:4, price:['50 ‚≠ê','250 ‚≠ê','500 ‚≠ê','1500 ‚≠ê'] },
  { id:'nft',         title:'–¢–û–õ–¨–ö–û NFT-–ö–ï–ô–°–´',  items:4, price:['25 ‚≠ê','30 ‚≠ê','35 ‚≠ê','40 ‚≠ê'] },
  { id:'exclusive',   title:'–≠–ö–°–ö–õ–Æ–ó–ò–í–ù–´–ï –ö–ï–ô–°–´',items:4, price:['2000 ‚≠ê','3500 ‚≠ê','5800 ‚≠ê','8500 ‚≠ê'] },
  { id:'standard',    title:'–°–¢–ê–ù–î–ê–†–¢–ù–´–ï –ö–ï–ô–°–´', items:4, price:['20 ‚≠ê','25 ‚≠ê','28 ‚≠ê','35 ‚≠ê'] },
  { id:'gold',        title:'–ö–ï–ô–°–´ –ó–ê –ó–û–õ–û–¢–û',   items:4, price:['–ó–û–õ–û–¢–û','–ó–û–õ–û–¢–û','–ó–û–õ–û–¢–û','–ó–û–õ–û–¢–û'] },
  { id:'allornothing',title:'–í–°–Å –ò–õ–ò –ù–ò–ß–ï–ì–û –ö–ï–ô–°–´',items:4,price:['50 ‚≠ê','75 ‚≠ê','100 ‚≠ê','150 ‚≠ê'] },
  { id:'expensive',   title:'–î–û–†–û–ì–ò–ï –ö–ï–ô–°–´',     items:4, price:['200 ‚≠ê','250 ‚≠ê','300 ‚≠ê','400 ‚≠ê'] },
];

const FALLBACK_IMG = "https://via.placeholder.com/512?text=%F0%9F%8E%81";

/* ===== –ö–û–ù–ö–£–†–°–´ ‚Äî –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—à—å =====
   img: URL 1:1 –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–ª—é–±–∞—è –ø—Ä–æ–ø–æ—Ä—Ü–∏—è, –≤–ø–∏—à–µ—Ç—Å—è –≤ –∫–≤–∞–¥—Ä–∞—Ç)
   username: —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ "@ChannelName"
   link: (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞; –µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Å–¥–µ–ª–∞—é https://t.me/<username –±–µ–∑ @>
*/
const CONTESTS_DATA = [
  { img: "assets/images/contest1.png", username: "@podarkisliv", link: "" },
  { img: "assets/images/contest2.png", username: "@Username2", link: "" },
  { img: "assets/images/contest3.png", username: "@Username3", link: "" },
  { img: "assets/images/contest4.png", username: "@Username4", link: "" },
];


// ====== DOM-—Å—Å—ã–ª–∫–∏ ======
const chipbar  = document.getElementById('chipbar');
const content  = document.getElementById('content');
const detail   = document.getElementById('detail');
const backBtn  = document.getElementById('backBtn');
const dTitle   = document.getElementById('detailTitle');
const dPrice   = document.getElementById('detailPrice');
const dThumb   = document.getElementById('detailThumb');
const lootGrid = document.getElementById('lootGrid');
// ====== –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ ======
sections.forEach(sec=>{
  // —á–∏–ø
  const chip = document.createElement('div');
  chip.className = 'chip';
  chip.dataset.target = `#sec-${sec.id}`;
  chip.textContent = sec.title.replace(' –ö–ï–ô–°–´','');
  chipbar.appendChild(chip);

  // –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
  const h2 = document.createElement('h2');
  h2.className = 'section';
  h2.id = `sec-${sec.id}`;
  h2.textContent = sec.title;
  content.appendChild(h2);

  // –≥—Ä–∏–¥
  const grid = document.createElement('div');
  grid.className = 'grid';

  for(let i=0;i<sec.items;i++){
    const thumbUrl  = (CASE_THUMBS[sec.id] && CASE_THUMBS[sec.id][i]) || "";
    const thumbHTML = thumbUrl ? `<img src="${thumbUrl}" alt="–û–±–ª–æ–∂–∫–∞ –∫–µ–π—Å–∞ #${i+1}" onerror="this.src='${FALLBACK_IMG}'">` : `–ó–∞–≥–ª—É—à–∫–∞`;

    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <div class="inner">
        <div class="thumb">${thumbHTML}</div>
        <div class="name">${sec.title.split(' ')[0]} –ö–µ–π—Å #${i+1}</div>
        <div class="desc">${(sec.descs && sec.descs[i]) || '–ù–µ–æ–Ω–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è'}</div>
        <div class="price">${Array.isArray(sec.price)? sec.price[i] : sec.price}</div>
      </div>`;

    if (sec.id !== 'free') {
      const setId = `${sec.id}_${i+1}`;
      card.addEventListener('click', ()=> openDetail({
        title: `${sec.title} ‚Äî –ö–µ–π—Å #${i+1}`,
        price: Array.isArray(sec.price)? sec.price[i] : sec.price,
        setId
      }));
    }
    grid.appendChild(card);
  }

  content.appendChild(grid);
});

// ====== –ß–∏–ø—ã (—Å–∫—Ä–æ–ª–ª –ø–æ —Å–µ–∫—Ü–∏—è–º) ======
const chips = Array.from(chipbar.querySelectorAll('.chip'));
chipbar.addEventListener('click', e=>{
  const chip = e.target.closest('.chip'); if(!chip) return;
  setActiveChip(chip);
  const sel = chip.dataset.target;
  if(!sel || sel==="#top"){ window.scrollTo({top:0,behavior:'smooth'}); return; }
  document.querySelector(sel)?.scrollIntoView({behavior:'smooth', block:'start'});
});
function setActiveChip(ch){ chips.forEach(c=>c.classList.remove('active')); ch.classList.add('active'); }
const mapTargetToChip = new Map([['#top', chipbar.querySelector('.chip.active')], ...chips.map(c=>[c.dataset.target,c])]);
const sectionEls = sections.map(s=>document.getElementById(`sec-${s.id}`));
const io = new IntersectionObserver((entries)=>{
  let best=null,ratio=0;
  for(const e of entries){ if(e.isIntersecting && e.intersectionRatio>ratio){best=e.target;ratio=e.intersectionRatio;} }
  if(best){ const ch = mapTargetToChip.get('#'+best.id); ch && setActiveChip(ch); }
  if(window.scrollY<10){ setActiveChip(mapTargetToChip.get('#top')); }
}, {root:null, rootMargin:'-130px 0px -60% 0px', threshold:[0.2,0.4,0.6,0.8]});
sectionEls.forEach(s=>io.observe(s));

// ====== –ö–Ω–æ–ø–∫–∞ ¬´–≤–≤–µ—Ä—Ö¬ª ======
const backTop = document.getElementById('backTop');
const toggleBackTop = ()=> backTop.classList.toggle('show', window.scrollY>2);
window.addEventListener('scroll', toggleBackTop, {passive:true});
backTop.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));
toggleBackTop();

// ====== –†–µ–Ω–¥–µ—Ä –ª—É—Ç–∞ (—Ñ–ª–∏–ø-–∫–∞—Ä—Ç–æ—á–∫–∏) ======
function renderLoot(images, setId){
  lootGrid.innerHTML = "";
  const list = (images && images.length) ? images.slice(0,11) : Array.from({length:11}, ()=>null);
  const isCheap = typeof setId === 'string' && setId.startsWith('cheap');
  const table = isCheap ? (CHEAP_BACK_TEXT[setId] || []) : [];

  const DEF_STARS = "174000/";
  const DEF_TON   = "870";

  list.forEach((src, idx)=>{
    const wrap = document.createElement('div');
    wrap.className = 'loot';
    wrap.setAttribute('aria-label', `–ü—Ä–µ–¥–º–µ—Ç ${idx+1}`);
    wrap.setAttribute('role','button');
    wrap.tabIndex = 0;

    const inner = document.createElement('div');
    inner.className = 'loot-inner';

    const front = document.createElement('div');
    front.className = 'loot-face loot-front';
    if (src){
      const img = document.createElement('img');
      img.src = src;
      img.alt = `–ü—Ä–µ–¥–º–µ—Ç ${idx+1}`;
      img.loading = "lazy";
      img.onerror = () => img.src = FALLBACK_IMG;
      front.appendChild(img);
    } else {
      front.textContent = '–ó–∞–≥–ª—É—à–∫–∞';
    }

    const back = document.createElement('div');
    back.className = 'loot-face loot-back';

    if (isCheap){
      const row = table[idx] || {};
      const s = (row.stars ?? "").trim() || DEF_STARS;
      const t = (row.ton   ?? "").trim() || DEF_TON;
      back.innerHTML = `
        <div class="lb-stats">
          <div class="lb-stars">${s}</div>
          <div class="lb-ton">${t}</div>
        </div>`;
    } else {
      back.innerHTML = `
        <div class="lb-stats">
          <div class="lb-stars">‚Äî</div>
          <div class="lb-ton">‚Äî</div>
        </div>`;
    }

    inner.appendChild(front);
    inner.appendChild(back);
    wrap.appendChild(inner);

    // —Ñ–ª–∏–ø (–æ–¥–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –∑–∞ —Ä–∞–∑)
    wrap.addEventListener('click', (e)=>{
      e.preventDefault();
      const isOpen = wrap.classList.contains('flipped');
      lootGrid.querySelectorAll('.loot.flipped').forEach(l=>l.classList.remove('flipped'));
      if (!isOpen) wrap.classList.add('flipped');
    }, {passive:false});

    wrap.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault();
        wrap.click();
      }
    });

    lootGrid.appendChild(wrap);
  });
}

// ===== DROP MODAL LOGIC =====
const dropModal = document.getElementById('dropModal');
const dropImg   = document.getElementById('dropImg');
const keepBtn   = document.getElementById('keepBtn');
const sellBtn   = document.getElementById('sellBtn');

let _lastFocus = null;
let _modalOpen = false;

function openDropModal(imgSrc){
  if (!dropModal) return;
  _lastFocus = document.activeElement;

  // –∫–∞—Ä—Ç–∏–Ω–∫–∞
  dropImg.src = imgSrc || FALLBACK_IMG;
window._lastDropImgSrc = dropImg.src;   // –ò–ù–í–ï–ù–¢–ê–†–¨: –∑–∞–ø–æ–º–Ω–∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É –¥—Ä–æ–ø–∞

  dropImg.onerror = () => { dropImg.src = FALLBACK_IMG; };

  // –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª–∫—É
  dropModal.classList.add('show');
  dropModal.setAttribute('aria-hidden','false');
  _modalOpen = true;

  // –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º —Ñ–æ–Ω–∞
  lockBody(true);

  // –∑–∞—Ö–≤–∞—Ç —Ñ–æ–∫—É—Å–∞
  setTimeout(()=> (keepBtn || dropModal).focus(), 0);

  // –±–ª–æ–∫–∏—Ä—É–µ–º —Ñ–æ–Ω, Esc –∏ –¥–µ—Ä–∂–∏–º —Ñ–æ–∫—É—Å
  dropModal.addEventListener('click', blockBackdropClick, true);
  document.addEventListener('keydown', blockEsc, true);
  document.addEventListener('keydown', trapTab, true);
} // ‚Üê –≠–¢–ê —Å–∫–æ–±–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç openDropModal

function closeDropModal(){
  if (!dropModal) return;
  dropModal.classList.remove('show');
  dropModal.setAttribute('aria-hidden','true');
  _modalOpen = false;

  // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω detail –∑–∞–∫—Ä—ã—Ç
  if (!detail.classList.contains('show')) {
    lockBody(false); 
}

  dropModal.removeEventListener('click', blockBackdropClick, true);
  document.removeEventListener('keydown', blockEsc, true);
  document.removeEventListener('keydown', trapTab, true);

  if (_lastFocus && _lastFocus.focus) _lastFocus.focus();
}

function blockBackdropClick(e){
  const card = dropModal.querySelector('.modal-card');
  if (!card.contains(e.target)){
    e.stopPropagation();
    e.preventDefault();
  }
}
function blockEsc(e){
  if (e.key === 'Escape'){
    e.stopPropagation();
    e.preventDefault();
    // –∑–∞–∫—Ä—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –ø–æ –∫–Ω–æ–ø–∫–∞–º
  }
}
function trapTab(e){
  if (e.key !== 'Tab' || !_modalOpen) return;
  const focusables = dropModal.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])');
  const list = Array.from(focusables).filter(el=>!el.disabled && el.offsetParent !== null);
  if (!list.length) return;
  const first = list[0], last = list[list.length-1];
  if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
  else if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
}

/* =========================================================
   –ò–ù–¢–ï–†–§–ï–ô–° –í–ö–õ–ê–î–ö–ò ¬´–ü–†–û–§–ò–õ–¨¬ª ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –º–æ–¥–∞–ª–∫–∏
   ========================================================= */
keepBtn?.addEventListener('click', () => {
  if (window._lastDropImgSrc) addToInventory(window._lastDropImgSrc);
  closeDropModal();
});

sellBtn?.addEventListener('click', () => {
  // TODO: –ø—Ä–æ–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç/–Ω–∞—á–∏—Å–ª–∏—Ç—å –≤–∞–ª—é—Ç—É
  closeDropModal();
});


function lockBody(locked){
  if (locked){
    const y = window.scrollY || 0;
    document.body.dataset.scrollY = String(y);
    document.documentElement.classList.add('scroll-locked');
  } else {
    const y = parseInt(document.body.dataset.scrollY || '0', 10);
    document.documentElement.classList.remove('scroll-locked');
    window.scrollTo(0, y);
  }
}


function openDetail({title, price, setId}) {
  // –∑–∞–ø–æ–º–∏–Ω–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–µ—Ç
  window.currentSetId = setId;

  // –∑–∞–≥–æ–ª–æ–≤–∫–∏/—Ü–µ–Ω–∞
  dTitle.textContent = title;
  dPrice.textContent = String(price || '‚Äî');

  // —á–∏—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞ —Å–≤–µ—Ä—Ö—É
  dThumb.textContent = '–ó–∞–≥–ª—É—à–∫–∞';

  // –ª—É—Ç —Å–Ω–∏–∑—É
  const images = LOOT_SETS[setId] || null;
  renderLoot(images, setId);

const key = `${setId}__0`;
const st  = ensureSpinState(key);
st.currentAngle = 0; // –∫–∞–∂–¥—ã–π –∑–∞—Ö–æ–¥ –Ω–∞—á–∏–Ω–∞–µ–º —Å –Ω—É–ª–µ–≤–æ–≥–æ —É–≥–ª–∞
// —Ä–∞–∑–º–µ—Ä—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ; –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –º–µ–Ω—è–ª–∏—Å—å ‚Äî –≤–µ—Ä–Ω—ë–º –∏—Ö
setReelSize({ sliceW: 210, sliceH: 128, minH: 360 });


  // –ù–ê–†–ò–°–û–í–ê–¢–¨ –ü–†–ï–í–¨–Æ –õ–ï–ù–¢ —Å—Ä–∞–∑—É –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  renderPreview(setId);

  // –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
  const spinStartBtn = document.getElementById('spinStartBtn');
  
  if (spinStartBtn) spinStartBtn.disabled = false;
  window.IS_SPINNING = false;

  // –∑–∞–ø—É—Å–∫ N —Å–ø–∏–Ω–æ–≤
  
  if (spinStartBtn) spinStartBtn.onclick  = () => beginSpin(setId);
  
 lockBody(true);
detail.classList.add('show');
detail.setAttribute('aria-hidden','false');
detail.scrollTop = 0;

  }

// ====== Telegram WebApp ======
(()=>{
  const tg = window.Telegram && window.Telegram.WebApp;
  const avatarImg = document.getElementById('userAvatar');
  const fallback  = document.getElementById('avatarFallback');
  const nameEl    = document.getElementById('userName');

  if(!tg) return;
  tg.ready(); tg.expand();

  const u = tg.initDataUnsafe && tg.initDataUnsafe.user;
  if(!u) return;

  const display = u.username ? '@' + u.username : [u.first_name||'', u.last_name||''].join(' ').trim() || 'GLITCH DROP';
  nameEl.textContent = display;
  nameEl.setAttribute('data-text', display.replaceAll(' ', '\u00A0'));

(async () => {
  const uid8 = await GD.ensureUid8(u.id);
  const idEl = document.getElementById('userId');
  if (idEl) idEl.textContent = `ID ${uid8}`;
})();

// === UID8 —Å —Å–µ—Ä–≤–µ—Ä–∞ (—É–Ω–∏–∫–∞–ª—å–Ω–æ –≤ –ø—Ä–æ–¥–µ) ===
const idEl = document.getElementById('userId');

// –ï—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç –∏ API –Ω–∞ –æ–¥–Ω–æ–º –¥–æ–º–µ–Ω–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ /api ‚Üí –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É.
// –ï—Å–ª–∏ –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ ‚Äî —É–∫–∞–∂–∏ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä:
// const API_BASE = 'https://api.yourdomain.com';

function fnv1a(str){
  let h = 0x811c9dc5;
  for (let i = 0; i < str.length; i++){
    h ^= str.charCodeAt(i);
    h = (h >>> 0) * 0x01000193;
  }
  return h >>> 0;
}
function to8(n){ return String(n % 100000000).padStart(8,'0'); }

// === –ï–î–ò–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö UID8 + –ö–≠–® –ü–†–û–ú–ò–°–ê ===
let _uid8Promise = null;

/**
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç UID8: —Å–Ω–∞—á–∞–ª–∞ localStorage, –∑–∞—Ç–µ–º –±—ç–∫–µ–Ω–¥, –∏–Ω–∞—á–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–ª–±—ç–∫.
 * @param {string|number} tgUserId
 * @returns {Promise<string>} 8-–∑–Ω–∞—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
 */

// === UID8 –∏–∑ –±—ç–∫–∞ —Å –∫—ç—à–µ–º –≤ localStorage ===
const UID8_LS_KEY = 'gd_uid8';

window.getOrFetchUid8 = async function(tgUserId){
  // 1) cache
  try{
    const cached = localStorage.getItem(UID8_LS_KEY);
    if (cached && /^\d{8}$/.test(cached)) return cached;
  }catch(_){}

  // 2) backend
  try{
    const resp = await fetch(`${window.API_BASE}/api/referrals/hit`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ telegram_id: String(tgUserId || '') })
    });
    if (!resp.ok) throw new Error('bad status');
    const { uid8 } = await resp.json();
    if (!/^\d{8}$/.test(uid8)) throw new Error('bad uid');
    try{ localStorage.setItem(UID8_LS_KEY, uid8); }catch(_){}
    return uid8;
  }catch(_){
    // 3) fallback (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
    const h = GD._fnv1a(`GLITCHDROP:${tgUserId || '0'}`);
    const fallback = GD._to8(h);
    try{ localStorage.setItem(UID8_LS_KEY, fallback); }catch(_){}
    return fallback;
  }
};

// –≠–∫—Å–ø–æ—Ä—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ GD
GD.getOrFetchUid8 = window.getOrFetchUid8;


// === –†–ï–§–ï–†–ê–õ–ö–ê: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥—Ä—É–≥–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ ref_<uid8> ===
(async () => {
  const tg = window.Telegram && window.Telegram.WebApp;
  if (!tg || !tg.initDataUnsafe) return;

  const u = tg.initDataUnsafe.user;
  const startParam = tg.initDataUnsafe.start_param; // –∂–¥—ë–º —Ñ–æ—Ä–º–∞—Ç ref_XXXXXXXX
  if (!startParam || !/^ref_\d{8}$/.test(startParam)) return;

  const refUid8 = startParam.slice(4);

  // —Ñ–ª–∞–≥, —á—Ç–æ–±—ã –Ω–µ —Å–ª–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
  const FLAG = `gd_ref_registered_${refUid8}`;
  try { if (localStorage.getItem(FLAG)) return; } catch(_) {}

  // –∏–º—è ¬´–∫–∞–∫ –≤ –∞–∫–∫–∞—É–Ω—Ç–µ¬ª (–ù–ï username)
  const displayName = [u?.first_name||'', u?.last_name||''].join(' ').trim() || '–ë–µ–∑ –∏–º–µ–Ω–∏';

  try{
    const resp = await fetch(`${window.API_BASE}/api/referrals/hit`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        ref_uid8: refUid8,
        initData: tg.initData || '',  // –í–ê–ñ–ù–û: —Å—Ç—Ä–æ–∫–∞ initData –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ –±—ç–∫–µ
        user: {
          id: String(u?.id||''),
          first_name: u?.first_name || '',
          last_name:  u?.last_name  || '',
          photo_url:  u?.photo_url  || ''
        }
      })
    });
    if (resp.ok){
      localStorage.setItem(FLAG,'1');
    }
  }catch(e){}
})();


  // üëá –î–û–ë–ê–í–¨ –≠–¢–û, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø–æ–¥–æ–≥–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä –Ω–∏–∫–∞
  if (typeof fitUserName === 'function') fitUserName();


  if (u.photo_url){
    avatarImg.src = u.photo_url;
    avatarImg.classList.remove('hidden');
    fallback.style.display = 'none';
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã—Å–æ—Ç—É topbar –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–º–µ–Ω–∏/–∞–≤–∞—Ç–∞—Ä–∞
  if (typeof syncTopbarOffset === 'function') syncTopbarOffset();
})();

// === –ê–≤—Ç–æ–ø–æ–¥–≥–æ–Ω –Ω–∏–∫–∞ –ø–æ–¥ –¥–æ—Å—Ç—É–ø–Ω—É—é —à–∏—Ä–∏–Ω—É –±—Ä–µ–Ω–¥–∞ ===
function fitUserName(){
  const brand = document.querySelector('.brand');
  const el = document.getElementById('userName');
  if(!brand || !el) return;

  el.style.transform = 'scale(1)';
  el.style.removeProperty('--name-scale');

  const maxW = Math.floor(brand.clientWidth);
  const needW = Math.ceil(el.scrollWidth);
  if (!maxW || !needW) return;

  if (needW <= maxW){
    el.removeAttribute('title');
    return;
  }

  const scale = Math.max(0.65, maxW / needW); // –Ω–µ –º–µ–Ω—å—à–µ 0.65
  el.style.transform = `scale(${scale})`;

// –ª—ë–≥–∫–æ–µ —É–ø–ª–æ—Ç–Ω–µ–Ω–∏–µ –º–µ–∂–±—É–∫–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Å–∫–µ–π–ª–µ
if (scale <= 0.70){
  el.style.letterSpacing = '-0.2px';
} else {
  el.style.removeProperty('letter-spacing');
}


  if (scale <= 0.70){
    el.setAttribute('title', el.textContent);
    el.style.maxWidth = maxW + 'px';
    el.style.textOverflow = 'ellipsis';
    el.style.overflow = 'hidden';
  } else {
    el.removeAttribute('title');
    el.style.removeProperty('max-width');
    el.style.removeProperty('text-overflow');
    el.style.removeProperty('overflow');
  }
}

// –≤—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤
fitUserName();
window.addEventListener('resize', fitUserName, {passive:true});
window.addEventListener('orientationchange', fitUserName);

// üëá –ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≤–µ—Ä—Å—Ç–∫–∞ –¥–æ—Ä–∏—Å—É–µ—Ç—Å—è –ø–æ–∑–∂–µ
document.addEventListener('DOMContentLoaded', () => {
  if (typeof fitUserName === 'function') fitUserName();
});

if (document.fonts && document.fonts.ready) {
  document.fonts.ready.then(() => fitUserName());
}

if ('ResizeObserver' in window){
  const ro = new ResizeObserver(fitUserName);
  const brandEl = document.querySelector('.brand');
  if (brandEl) ro.observe(brandEl);
}


// === –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã—Å–æ—Ç—ã —Ç–æ–ø–±–∞—Ä–∞ –≤ CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ===
function syncTopbarOffset(){
  const h = document.querySelector('.topbar')?.offsetHeight || 64;
  document.documentElement.style.setProperty('--topbar-h', h + 'px');
}

// 1) –í—ã–∑–≤–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
syncTopbarOffset();

// 2) –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ –∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–µ —ç–∫—Ä–∞–Ω–∞
window.addEventListener('resize', syncTopbarOffset, {passive:true});
window.addEventListener('orientationchange', syncTopbarOffset, {passive:true});

// 3) –ö–æ–≥–¥–∞ —à—Ä–∏—Ñ—Ç—ã –¥–æ—Ä–∏—Å–æ–≤–∞–ª–∏—Å—å (–µ—Å–ª–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã—Å–æ—Ç—É)
if (document.fonts && document.fonts.ready) {
  document.fonts.ready.then(syncTopbarOffset);
}

function syncTabbarOffset(){
  const h = document.querySelector('.tabbar')?.offsetHeight || 84;
  document.documentElement.style.setProperty('--tabbar-h', h + 'px');
}
syncTabbarOffset();
window.addEventListener('resize', syncTabbarOffset, {passive:true});
window.addEventListener('orientationchange', syncTabbarOffset, {passive:true});
if (document.fonts && document.fonts.ready) {
  document.fonts.ready.then(syncTabbarOffset);
}


// --- Support –¥–ª—è 3D –±–∞—Ä–∞–±–∞–Ω–∞: —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –≤–µ—Å–∞, –ª–µ–π–±–ª—ã ---

// –ü—É—Å—Ç–æ–π —Ä–µ–µ—Å—Ç—Ä –∫–∞—Ä—Ç–∏–Ω–æ–∫ (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ø—Ä–∞–π—Ç—ã –±–∞—Ä–∞–±–∞–Ω–∞)
window.SPIN_IMAGES = window.SPIN_IMAGES || {}; // { setId: [url,url,...] }

// –û–±—â–∏–π state –ø–æ –∫–ª—é—á—É (setId__index)
window.SPIN_STATE = window.SPIN_STATE || new Map();

// –ü—Ä–æ—Ü–µ–Ω—Ç—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –ø–æ –Ω–∞–±–æ—Ä–∞–º (11 –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ setId). –ü–æ–∫–∞ –Ω—É–ª–∏ ‚Äî —Ä–∞–≤–Ω–æ–≤–µ—Ä–æ—è—Ç–Ω–æ.
const SPIN_CONFIGS_PERCENT = {
 
cheap_1: [0, 0, 0, 0, 0, 0, 0.392, 0.294, 0.196, 0.098, 0.02], 
cheap_2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
cheap_3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
cheap_4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  
nft_1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  
nft_2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],   
nft_3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],   
nft_4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  
exclusive_1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
exclusive_2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
exclusive_3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
exclusive_4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  
standard_1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  
standard_2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  
standard_3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  
standard_4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  
gold_1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
gold_2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
gold_3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
gold_4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  
allornothing_1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
allornothing_2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
allornothing_3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
allornothing_4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
 
expensive_1: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
expensive_2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
expensive_3: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
expensive_4: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
};

// –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏/–∑–Ω–∞—á–µ–Ω–∏—è
const SPIN_LABELS = {
  cheap_1: {
    labels: ["CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1"],
    values: ["10 ‚≠ê","25 ‚≠ê","50 ‚≠ê","100 ‚≠ê","3 ‚≠ê","5 ‚≠ê","8 ‚≠ê","15 ‚≠ê","20 ‚≠ê","30 ‚≠ê","60 ‚≠ê"]
  }
};
const DEFAULT_LABELS = Array(11).fill("–ü–†–ò–ó");
const DEFAULT_VALUES = ["10 ‚≠ê","25 ‚≠ê","50 ‚≠ê","100 ‚≠ê","3 ‚≠ê","5 ‚≠ê","8 ‚≠ê","15 ‚≠ê","20 ‚≠ê","30 ‚≠ê","60 ‚≠ê"];

function ensureSpinState(key){
  if(!SPIN_STATE.has(key)){
    const setId = key.split('__')[0];
    const raw = (SPIN_CONFIGS_PERCENT[setId]?.slice(0,11)) || Array(11).fill(0);
    const sum = raw.reduce((a,b)=>a+b,0) || 1;
    const weights = raw.map(w => Math.max(0,w)/sum);

    const L = (SPIN_LABELS[setId]?.labels || DEFAULT_LABELS).slice(0,11);
    const V = (SPIN_LABELS[setId]?.values || DEFAULT_VALUES).slice(0,11);
    while(L.length<11) L.push("–ü–†–ò–ó");
    while(V.length<11) V.push("‚Äî");

    SPIN_STATE.set(key, {
      currentAngle: 0,
      rafId: 0,
      weights, labels: L, values: V
    });
  }
  return SPIN_STATE.get(key);
}


// –í—ã–±–æ—Ä –∏–Ω–¥–µ–∫—Å–∞ –ø–æ –≤–µ—Å–∞–º
function pickIndexByWeights(weights){
  let r = Math.random(), acc = 0;
  for(let i=0;i<weights.length;i++){ acc += weights[i]; if(r <= acc) return i; }
  return weights.length-1;
}

/* ===== 3D –±–∞—Ä–∞–±–∞–Ω –¥–ª—è detailThumb ===== */

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–∂–æ–∫ ¬´–∏–¥—ë—Ç –ø—Ä–æ–∫—Ä—É—Ç¬ª
if (typeof window.IS_SPINNING === 'undefined') window.IS_SPINNING = false;

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∞—Ä–∞–±–∞–Ω–∞
const DRUM_ITEM_COUNT = 11;          // —á–∏—Å–ª–æ –≥—Ä–∞–Ω–µ–π

/* –ì–µ–æ–º–µ—Ç—Ä–∏—è/—Ä–∞–∑–º–µ—Ä */
function getReelMetrics(){
  const cs = getComputedStyle(document.documentElement);
  const w = parseFloat(cs.getPropertyValue('--reel-slice-w')) || 210;
  const h = parseFloat(cs.getPropertyValue('--reel-slice-h')) || 128;
  const step = 360 / DRUM_ITEM_COUNT;
  const r = Math.round( (h / 2) / Math.tan(Math.PI / DRUM_ITEM_COUNT) );
  return { w, h, step, r };
}

/* –ü—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ */
function setReelSize({sliceW, sliceH, minH} = {}){
  const root = document.documentElement.style;
  if(sliceW) root.setProperty('--reel-slice-w', `${sliceW}px`);
  if(sliceH) root.setProperty('--reel-slice-h', `${sliceH}px`);
  if(minH)   root.setProperty('--reel-min-h',   `${minH}px`);
}

/* –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å —É–≥–ª–æ–º */
function ensureSpinStateWithAngle(key){
  const st = ensureSpinState(key);
  if(typeof st.currentAngle !== 'number') st.currentAngle = 0;
  return st;
}

/* –†–µ–Ω–¥–µ—Ä –±–∞—Ä–∞–±–∞–Ω–∞ –≤ d-thumb */
function render3DReel(setId){
  const parent = document.getElementById('detailThumb');
  if(!parent) return;
  const key = `${setId}__0`;
  const st  = ensureSpinStateWithAngle(key);
  const { step, r } = getReelMetrics();

  parent.innerHTML = `
    <div class="drum-wrap">
      <div class="drum-stage">
        <div class="drum-tilt">
          <div class="drum" id="drum_${key}" style="transform:translateZ(${-r}px) rotateX(${st.currentAngle}deg)"></div>
        </div>
        <div class="drum-pointer"></div>
      </div>
    </div>
  `;

  const drum = document.getElementById(`drum_${key}`);
  drum.innerHTML = "";

  const imgs = (SPIN_IMAGES[setId]?.length ? SPIN_IMAGES[setId] : LOOT_SETS[setId] || []).slice(0, DRUM_ITEM_COUNT);
  while(imgs.length < DRUM_ITEM_COUNT) imgs.push("");

  for(let i=0;i<DRUM_ITEM_COUNT;i++){
    const deg = -i * step; // —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ, –≤—Ä–∞—â–∞–µ–º –≤–Ω–∏–∑
    const url   = imgs[i] || "";
    const label = (SPIN_STATE.get(key)?.labels?.[i]) ?? "–ü–†–ò–ó";
    const value = (SPIN_STATE.get(key)?.values?.[i]) ?? "‚Äî";

    const el = document.createElement('div');
    el.className = 'slice';
    el.style.setProperty('--_deg', `${deg}deg`);
    el.style.setProperty('--_rz',  `${r}px`);
    el.style.transform = `rotateX(${deg}deg) translateZ(${r}px)`;
    
// —Å—Ç–∞–ª–æ:
el.innerHTML = `
  <div class="img">
    ${url ? `<img src="${url}" onerror="this.src='${FALLBACK_IMG}'" alt="">` : '‚Äî'}
  </div>
`;

    drum.appendChild(el);
  }
}

function start3DSpin(setId, onDone){
  const key  = `${setId}__0`;
  const drum = document.getElementById(`drum_${key}`);
  if (!drum){ onDone && onDone({ idx:-1, imgSrc: FALLBACK_IMG }); return; }


  const st = ensureSpinState(key);
  const { step, r } = getReelMetrics();

  drum.querySelectorAll('.slice').forEach(s=> s.classList.remove('win'));

  const idx = pickIndexByWeights(st.weights);
  const current  = Number.isFinite(st.currentAngle) ? st.currentAngle : 0;
  const curSteps = Math.round(current / step);
  const curMod   = ((curSteps % 11) + 11) % 11;

  const need = ((idx - curMod) + 11) % 11;
  const EXTRA_TURNS_INT = 3;
  const deltaSteps = EXTRA_TURNS_INT * 11 + need;
  const target = (curSteps + deltaSteps) * step;

  const SPIN_DURATION_MS = 3800;
  const t0 = performance.now();
  const easeOutCubic = t => 1 - Math.pow(1 - t, 3);

  function frame(now){
    const p = Math.min(1, (now - t0) / SPIN_DURATION_MS);
    const ang = current + (target - current) * easeOutCubic(p);
    drum.style.transform = `translateZ(${-r}px) rotateX(${ang}deg)`;

    if(p < 1){
      st.rafId = requestAnimationFrame(frame);
    } else {
            const snapped = Math.round(target / step) * step;
      drum.style.transform = `translateZ(${-r}px) rotateX(${snapped}deg)`;
      st.currentAngle = snapped;

      const slices = drum.querySelectorAll('.slice');
      const winEl = slices[idx];
      winEl?.classList.add('win');
      const winImg = winEl?.querySelector('img');
      const imgSrc = winImg ? winImg.src : FALLBACK_IMG;

      st.rafId = 0;
      onDone && onDone({ idx, imgSrc });
    }
  }

  cancelAnimationFrame(st.rafId);
  st.rafId = requestAnimationFrame(frame);
}

// –ø—Ä–µ–≤—å—é –±–∞—Ä–∞–±–∞–Ω–∞
function renderPreview(setId){
  render3DReel(setId);
}

// –∑–∞–ø—É—Å–∫ —Å–ø–∏–Ω–∞
function beginSpin(setId){
  if (window.IS_SPINNING) return;
  window.IS_SPINNING = true;

  render3DReel(setId);

  const btn = document.getElementById('spinStartBtn');
  if (btn) btn.disabled = true;

  start3DSpin(setId, ({ imgSrc })=>{
  if (btn) btn.disabled = false;
  window.IS_SPINNING = false;

  // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª–∫—É —Å –≤—ã–∏–≥—Ä—ã—à–µ–º
  openDropModal(imgSrc);
});
}

backBtn.addEventListener('click', ()=>{
  // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –±–∞—Ä–∞–±–∞–Ω–∞
  SPIN_STATE.forEach(st=>{
    if (st.rafId) cancelAnimationFrame(st.rafId);
    st.rafId = 0;
  });

  // –°–±—Ä–æ—Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞ –±–∞—Ä–∞–±–∞–Ω–∞
  const drum = document.querySelector('.d-thumb .drum');
  if (drum) drum.style.transform = '';

  window.IS_SPINNING = false;
  document.getElementById('spinStartBtn')?.removeAttribute('disabled');

  // –ó–∞–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∫—É –∏ –≤–µ—Ä–Ω—É—Ç—å —Å–∫—Ä–æ–ª–ª
  detail.classList.remove('show');
  detail.setAttribute('aria-hidden','true');
  lockBody(false);
});

/* =========================================================
   –ò–ù–í–ï–ù–¢–ê–†–¨ ‚Äî PERSISTENCE (localStorage)
   ========================================================= */
function loadInventory(){
  try{
    const raw = localStorage.getItem('gd_inventory');
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr : [];
  }catch(e){
    return [];
  }
}
function saveInventory(){
  try{
    localStorage.setItem('gd_inventory', JSON.stringify(window.INVENTORY));
  }catch(e){}
}

/* —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ) */
window.INVENTORY = loadInventory();   // [{id, img}, ...]

/* ===== FRIENDS / PROMO ‚Äî PERSISTENCE ===== */
const LS_PROMO_KEY = 'gd_promo_state'; // { draft:"", created:false, code:"" }

function loadPromoState(){
  try{
    const raw = localStorage.getItem(LS_PROMO_KEY);
    const s = raw ? JSON.parse(raw) : null;
    return s && typeof s==='object'
      ? { draft: s.draft || "", created: !!s.created, code: s.code || "" }
      : { draft:"", created:false, code:"" };
  }catch(e){
    return { draft:"", created:false, code:"" };
  }
}
function savePromoState(next){
  try{
    const cur = loadPromoState();
    const merged = { ...cur, ...next };
    localStorage.setItem(LS_PROMO_KEY, JSON.stringify(merged));
  }catch(e){}
}
function clearPromo(){
  try{ localStorage.removeItem(LS_PROMO_KEY); }catch(e){}
}

// –§–ª–∞–≥ "—Å–µ–π—á–∞—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –ø—Ä–æ–º–æ–∫–æ–¥"
const LS_PROMO_EDITING = 'gd_promo_editing';

function setPromoEditing(on){
  try{
    if(on) localStorage.setItem(LS_PROMO_EDITING, '1');
    else   localStorage.removeItem(LS_PROMO_EDITING);
  }catch(e){}
}
function isPromoEditing(){
  try{ return localStorage.getItem(LS_PROMO_EDITING) === '1'; }catch(e){ return false; }
}

// –°–±—Ä–æ—Å–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ –∏ –≤—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function cancelPromoEditing(){
  savePromoState({ draft: "" });
  setPromoEditing(false);
}


function addToInventory(imgSrc){
  if(!imgSrc) return;
  const id = `it_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;
  window.INVENTORY.push({ id, img: imgSrc });
  saveInventory();         // ‚Üê —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ –¥–∏—Å–∫
  renderInventory();
}

// ===== –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É "–ö–µ–π—Å—ã" –∏ "–ü—Ä–æ—Ñ–∏–ª—å" =====
const profileScreen = document.getElementById('profileScreen');
const friendsScreen  = document.getElementById('friendsScreen');
const contestsScreen = document.getElementById('contestsScreen');
const upgradesScreen = document.getElementById('upgradesScreen');


const tabsAll = Array.from(document.querySelectorAll('.tabbar .tab'));

const casesTab   = tabsAll.find(t => t.textContent.trim().includes('–ö–µ–π—Å—ã'));
const profileTab =
  document.querySelector('.tabbar .tab[data-tab="inventory"]')
  || tabsAll.find(t => /–ò–ù–í–ï–ù–¢–ê–†–¨|–ü—Ä–æ—Ñ–∏–ª—å/i.test(t.textContent.trim()));
const friendsTab = tabsAll.find(t => /–î—Ä—É–∑—å—è/i.test(t.textContent.trim()));
const contestsTab = tabsAll.find(t => /–ö–æ–Ω–∫—É—Ä—Å—ã/i.test(t.textContent.trim()));
const upgradesTab = tabsAll.find(t => /–ê–ø–≥—Ä–µ–π–¥/i.test(t.textContent.trim()));


// –î–µ–ª–∞–µ—Ç —Ç–∞–± –∞–∫—Ç–∏–≤–Ω—ã–º –≤–∏–∑—É–∞–ª—å–Ω–æ
function setActiveTab(tab){
  tabsAll.forEach(t => t.classList.remove('active'));
  tab?.classList.add('active');
}

function hardCloseDetailAndModal(){
  // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –¥—Ä–æ–ø–∞, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞
  if (typeof _modalOpen !== 'undefined' && _modalOpen) {
    try { closeDropModal(); } catch(e){}
  }
  // –ó–∞–∫—Ä—ã—Ç—å detail, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
  if (detail?.classList.contains('show')) {
    try {
      SPIN_STATE.forEach(st=>{ if (st.rafId) cancelAnimationFrame(st.rafId); st.rafId = 0; });
      detail.classList.remove('show');
      detail.setAttribute('aria-hidden','true');
    } catch(e){}
  }
  // –í–µ—Ä–Ω—É—Ç—å —Å–∫—Ä–æ–ª–ª, –µ—Å–ª–∏ –±—ã–ª –∑–∞–ª–æ—á–µ–Ω
  try { lockBody(false); } catch(e){}
}

// –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∫–µ–π—Å–æ–≤ (—Ç–µ–∫—É—â–∞—è –≥–ª–∞–≤–Ω–∞—è)
function showCases(){
  hardCloseDetailAndModal();
cancelPromoEditing(); // –µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–î—Ä—É–∑—å—è" ‚Äî –æ—Ç–∫–∞—Ç–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫

contestsScreen.classList.add('hide');
  contestsScreen.setAttribute('aria-hidden','true');

  chipbar.classList.remove('hide');
  content.classList.remove('hide');
  backTop.classList.remove('hide');

  profileScreen.classList.add('hide');
  profileScreen.setAttribute('aria-hidden','true');

  friendsScreen.classList.add('hide');
  friendsScreen.setAttribute('aria-hidden','true');
  upgradesScreen.classList.add('hide');
upgradesScreen.setAttribute('aria-hidden','true');


  setActiveTab(casesTab);
  restoreTopbarIfNeeded();
  document.body.classList.remove('friends-active');
  if (typeof syncTopbarOffset === 'function') syncTopbarOffset();

}

function showProfile(){
  hardCloseDetailAndModal();
cancelPromoEditing(); // –µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–î—Ä—É–∑—å—è" ‚Äî –æ—Ç–∫–∞—Ç–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫

contestsScreen.classList.add('hide');
  contestsScreen.setAttribute('aria-hidden','true');

  chipbar.classList.add('hide');
  content.classList.add('hide');
  backTop.classList.add('hide');

  friendsScreen.classList.add('hide');
  friendsScreen.setAttribute('aria-hidden','true');
  upgradesScreen.classList.add('hide');
upgradesScreen.setAttribute('aria-hidden','true');


  profileScreen.innerHTML = `
    <div class="inventory-surface">
      <div class="inventory-page">
        <div class="inventory-header">–ò–ù–í–ï–ù–¢–ê–†–¨</div>
        <div id="inventoryEmpty" class="inventory-empty">–ó–î–ï–°–¨ –ü–û–ö–ê –ù–ò–ß–ï–ì–û –ù–ï–¢</div>
        <div id="inventoryGrid" class="inventory-grid" style="display:none"></div>
      </div>
    </div>
  `;
  profileScreen.classList.remove('hide');
  profileScreen.setAttribute('aria-hidden','false');

  setActiveTab(profileTab);
  window.scrollTo({ top: 0, behavior: 'smooth' });

  renderInventory();
  restoreTopbarIfNeeded();                          // ‚Üê –≤–µ—Ä–Ω—ë–º –≤–µ—Ä—Ö–Ω–∏–π —Ç–æ–ø–±–∞—Ä

document.body.classList.remove('friends-active');
if (typeof syncTopbarOffset === 'function') syncTopbarOffset();

}


function renderInventory(){
  const grid  = document.getElementById('inventoryGrid');
  const empty = document.getElementById('inventoryEmpty');
  if(!grid || !empty) return;

  grid.innerHTML = '';

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Å–≤–µ—Ä—Ö—É
  const list = (window.INVENTORY || []).slice().reverse();

  if (!list.length){
    empty.style.display = 'grid';
    grid.style.display  = 'none';
    return;
  }

  empty.style.display = 'none';
  grid.style.display  = 'grid';

  list.forEach(item=>{
    const card = document.createElement('div');
    card.className = 'inventory-card';
    card.dataset.id = item.id;
    card.innerHTML = `
      <img src="${item.img}" alt="–ø—Ä–µ–¥–º–µ—Ç" loading="lazy" onerror="this.remove()">
      <button type="button" class="inv-sell">–ü–†–û–î–ê–¢–¨</button>
    `;
    grid.appendChild(card);
  });

  // –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –ü–†–û–î–ê–¢–¨
  grid.onclick = (e)=>{
    const btn  = e.target.closest('.inv-sell');
    if(!btn) return;
    const card = btn.closest('.inventory-card');
    const id   = card?.dataset.id;
    if(!id) return;

    openConfirmSell(() => sellFromInventory(id, card));
  };
}

/* ===================== FRIENDS v2 ===================== */
const topbarEl = document.querySelector('.topbar');

async function renderFriends(){
  if(!friendsScreen) return;

  const TOKEN_ICON = 'assets/images/20251005_0825_–Ø—Ä–∫–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ_remix_01k6sd902pf03ah1w3cpkr66jz.png';
  const invited = await fetchInvited();

  friendsScreen.innerHTML = `
    <div class="friends-header">–î–†–£–ó–¨–Ø</div>

    <div class="friends-wrap">
      <!-- –ü—Ä–æ–º–æ-–±–ª–æ–∫ –≤–æ –≤—Å—é —à–∏—Ä–∏–Ω—É, –±–µ–∑ ¬´–ø–∞–Ω–µ–ª–∏¬ª -->
      <div class="fr-title">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π ‚Äî –ü–æ–ª—É—á–∞–π –Ω–∞–≥—Ä–∞–¥—ã!</div>
      <div class="fr-sub">–ö–∞–∂–¥—ã–π –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π –¥—Ä—É–≥ = <strong>1</strong> <span class="bil">üéüÔ∏è</span> –±–∏–ª–µ—Ç</div>

      <div class="fr-cta-row">
        <button type="button" class="btn btn-primary" id="btnInvite">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê</button>
        <button type="button" class="btn btn-icon" id="btnCopy" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É">üìã</button>
        <button type="button" class="btn btn-ghost" id="btnPartner" style="display:none">–°–¢–ê–¢–¨ –ü–ê–†–¢–ù–Å–†–û–ú</button>
      </div>

      <div class="fr-block-title">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞</div>
      <div class="fr-promo">
        <input class="fr-input" id="promoInput2" type="text"
  placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ (–¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="16" />
        <div class="fr-actions">
          <button type="button" class="btn btn-primary" id="btnCreatePromo2">–°–û–ó–î–ê–¢–¨ –ü–†–û–ú–û–ö–û–î</button>
          <button type="button" class="btn btn-ghost" id="btnEnterPromo2">–í–í–ï–°–¢–ò –ü–†–û–ú–û–ö–û–î</button>
        </div>
      </div>

      <div class="fr-list-wrap">
        <div class="fr-list-head">
          <span>–ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –¥—Ä—É–∑—å—è</span>
          <span>(${invited.length})</span>
        </div>
        <div class="fr-list" id="frList">
          ${
  invited.length
    ? invited.map((u,i)=>`
      <div class="fr-item" role="listitem">
        <div class="n">${i+1}.</div>
        <div class="nm">
          <span class="nm-txt">${esc(u.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å')}</span>
        </div>
        <div class="gain">
          +1 <img src="${u.photo_url || 'assets/images/20251005_0825_–Ø—Ä–∫–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ_remix_01k6sd902pf03ah1w3cpkr66jz.png'}" alt="" onerror="this.src='assets/images/20251005_0825_–Ø—Ä–∫–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ_remix_01k6sd902pf03ah1w3cpkr66jz.png'">
        </div>
      </div>
    `).join('')
    : `<div class="fr-item" aria-hidden="true">
         <div class="n">‚Äî</div>
         <div class="nm" style="opacity:.8">–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤–∞—à–∏ –¥—Ä—É–∑—å—è</div>
         <div class="gain">+1 <img src="assets/images/20251005_0825_–Ø—Ä–∫–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ_remix_01k6sd902pf03ah1w3cpkr66jz.png" alt=""></div>
       </div>`
}
        </div>
      </div>
    </div>
  `;

// === –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –ü–†–û–ú–û ===
const promoWrap   = document.querySelector('.fr-promo');
let   promoInput  = document.getElementById('promoInput2');
const createBtn   = document.getElementById('btnCreatePromo2');
const enterBtn    = document.getElementById('btnEnterPromo2');
const RE_PROMO    = /^[A-Za-z0-9_-]{4,16}$/;

const state = loadPromoState();

if (state.created && state.code){
  const editing = isPromoEditing();
  const current = (state.code || "").trim();
  const draft   = (state.draft || current);

  // –û–±—â–∞—è –≤—ë—Ä—Å—Ç–∫–∞: —Å—Ç—Ä–æ–∫–∞ + –¥–≤–µ –∫–Ω–æ–ø–∫–∏ (‚úèÔ∏è —Å–ª–µ–≤–∞, ‚úÖ —Å–ø—Ä–∞–≤–∞)
  if (!editing){
    // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –±–µ–π–¥–∂ + –∫–Ω–æ–ø–∫–∏
    promoWrap.innerHTML = `
      <div class="promo-result">
        <div class="promo-badge">–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥: <strong>${current}</strong></div>
        <div style="display:flex; gap:8px">
          <button type="button" class="btn btn-ghost" id="promoEditBtn"  aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
          <button type="button" class="btn btn-primary" id="promoOkBtn" aria-label="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å">‚úÖ</button>
        </div>
      </div>
    `;

    // ‚úèÔ∏è ‚Üí –≤–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    document.getElementById('promoEditBtn')?.addEventListener('click', ()=>{
      savePromoState({ draft: current }); // —á–µ—Ä–Ω–æ–≤–∏–∫ = —Ç–µ–∫—É—â–∏–π –∫–æ–¥
      setPromoEditing(true);
      renderFriends();                    // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –≤ —Ä–µ–∂–∏–º –≤–≤–æ–¥–∞
    });

    // ‚úÖ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Üí –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º –∏–∑ "—Ä–µ–∂–∏–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è" (–ø–æ —Å—É—Ç–∏ no-op)
    document.getElementById('promoOkBtn')?.addEventListener('click', ()=>{
      // –ù–∏–∫–∞–∫–∏—Ö –≤—Å–ø–ª—ã–≤–∞—à–µ–∫, –ø—Ä–æ—Å—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç
      cancelPromoEditing();
      renderFriends();
    });

  } else {
    // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: input —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º + –∫–Ω–æ–ø–∫–∏ ‚úèÔ∏è/‚úÖ
    promoWrap.innerHTML = `
      <div class="promo-result">
        <input class="fr-input" id="promoEditInput" type="text"
               placeholder="–ü—Ä–æ–º–æ–∫–æ–¥ (4‚Äì16 —Å–∏–º–≤–æ–ª–æ–≤)"
               maxlength="16" value="${draft}">
        <div style="display:flex; gap:8px">
          <button type="button" class="btn btn-ghost"  id="promoEditFocus" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
          <button type="button" class="btn btn-primary" id="promoEditSave"  aria-label="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å">‚úÖ</button>
        </div>
      </div>
    `;

    const RE_PROMO = /^[A-Za-z0-9_-]{4,16}$/;
    const input    = document.getElementById('promoEditInput');
    const btnSave  = document.getElementById('promoEditSave');

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫ –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
    function sync(){
      const val = (input.value || '').trim();
      savePromoState({ draft: val });
      btnSave.disabled = !RE_PROMO.test(val);
    }
    input.addEventListener('input', sync);
    input.addEventListener('blur',  sync);
    sync();
    input.focus();

    // ‚úèÔ∏è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –ø—Ä–æ—Å—Ç–æ —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è)
    document.getElementById('promoEditFocus')?.addEventListener('click', ()=>{
      input?.focus();
      input?.setSelectionRange(input.value.length, input.value.length);
    });

    // ‚úÖ ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (–¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å)
    btnSave.addEventListener('click', ()=>{
      const val = (input.value || '').trim();
      if (!RE_PROMO.test(val)) return;    // –∑–∞—â–∏—Ç–∞

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π, —á–∏—Å—Ç–∏–º —á–µ—Ä–Ω–æ–≤–∏–∫ –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      savePromoState({ code: val, created: true, draft: "" });
      setPromoEditing(false);
      renderFriends(); // –ø–æ–∫–∞–∂–µ–º —Å–Ω–æ–≤–∞ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –±–µ–π–¥–∂ + –∫–Ω–æ–ø–∫–∏
    });
  }
}


  // –ö–Ω–æ–ø–∫–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω–∞, –µ—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ
  if (createBtn) createBtn.disabled = !RE_PROMO.test(promoInput?.value?.trim() || "");

  // –°–ª–µ–¥–∏–º –∑–∞ –≤–≤–æ–¥–æ–º: –≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º draft
  function syncPromoState(){
    // –∞–≤—Ç–æ-UPPERCASE –ø–æ –∂–µ–ª–∞–Ω–∏—é:
    // if (promoInput) promoInput.value = promoInput.value.toUpperCase();
    const val = (promoInput?.value || '').trim();
    savePromoState({ draft: val });
    createBtn.disabled = !RE_PROMO.test(val);
  }
  promoInput?.addEventListener('input', syncPromoState);
  promoInput?.addEventListener('blur',  syncPromoState);
  syncPromoState();

  // –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
createBtn?.addEventListener('click', () => {
  const val = (promoInput?.value || '').trim();
  const RE_PROMO = /^[A-Za-z0-9_-]{4,16}$/;
  if (!RE_PROMO.test(val)){
    alert('–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥');
    return;
  }
  // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π –∫–æ–¥ –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  savePromoState({ created: true, code: val, draft: "" });
  setPromoEditing(false);

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–¥–∏–Ω—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –±–µ–π–¥–∂ —Å ‚úèÔ∏è/‚úÖ
  renderFriends();
});

  // ¬´–í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥¬ª ‚Äî –∑–∞–≥–ª—É—à–∫–∞ (–∫–∞–∫ –±—ã–ª–æ)
  enterBtn?.addEventListener('click', () => alert('–í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥ (–∑–∞–≥–ª—É—à–∫–∞)'));

// ===== –î–ï–ô–°–¢–í–ò–Ø –ö–ù–û–ü–û–ö –ü–†–ò–ì–õ–ê–®–ï–ù–ò–Ø/–ö–û–ü–ò–†–û–í–ê–ù–ò–Ø ‚Äî –ñ–ï–õ–ï–ó–û–ë–ï–¢–û–ù–ù–´–ô –í–ê–†–ò–ê–ù–¢ =====
const tg = window.Telegram && window.Telegram.WebApp;

function showToast(msg){
  if (tg?.showAlert) tg.showAlert(msg);
  else alert(msg);
}

document.getElementById('btnInvite')?.addEventListener('click', async () => {
  await GD.ensureUid8();
  const link = GD.buildInviteLink();
  const text = '–ó–∞–ª–µ—Ç–∞–π –≤ GLITCH DROP ‚Äî –ª–æ–≤–∏–º –¥—Ä–æ–ø—ã –≤–º–µ—Å—Ç–µ!';
  const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`;
  safeOpen(shareUrl); // –±–µ–∑ –ª—é–±—ã—Ö setTimeout/alert/toast
});

document.getElementById('btnCopy')?.addEventListener('click', async () => {
  await GD.ensureUid8();
  const link = GD.buildInviteLink();
  // –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

  // 1) –í–Ω—É—Ç—Ä–∏ Telegram
  if (tg?.setClipboardText) {
    tg.setClipboardText(link);
    try { tg.HapticFeedback?.notificationOccurred('success'); } catch(_) {}
    tg.showAlert?.('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
    return;
  }

  // 2) –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Clipboard API
  try {
    await navigator.clipboard.writeText(link);
    showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
    return;
  } catch(_) {}

  // 3) –§–æ–ª–±—ç–∫ —á–µ—Ä–µ–∑ textarea
  try {
    const ta = document.createElement('textarea');
    ta.value = link;
    ta.setAttribute('readonly','');
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select();
    const ok = document.execCommand('copy');
    document.body.removeChild(ta);
    if (ok) { showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞'); return; }
  } catch(_) {}

  // 4) –ê–±—Å–æ–ª—é—Ç–Ω—ã–π —Ñ–æ–ª–±—ç–∫ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫—É
  showToast(`–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é:\n${link}`);
});


// –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –∫–Ω–æ–ø–∫–∞ ‚Äî –æ—Å—Ç–∞–≤–∏–º –∑–∞–≥–ª—É—à–∫–æ–π (–∫–∞–∫ –∏ –±—ã–ª–æ)
const partnerBtn = document.getElementById('btnPartner');
if (window.matchMedia('(min-width:680px)').matches && partnerBtn){
  partnerBtn.style.display = 'inline-block';
  partnerBtn.addEventListener('click', ()=> alert('–°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º (–∑–∞–≥–ª—É—à–∫–∞)'));
}

}


function showFriends(){
  hardCloseDetailAndModal();

contestsScreen.classList.add('hide');
  contestsScreen.setAttribute('aria-hidden','true');

  chipbar.classList.add('hide');
  content.classList.add('hide');
  backTop.classList.add('hide');
  profileScreen.classList.add('hide');
  profileScreen.setAttribute('aria-hidden','true');
  upgradesScreen.classList.add('hide');
upgradesScreen.setAttribute('aria-hidden','true');


  // –ø–æ–∫–∞–∑–∞—Ç—å friends
  friendsScreen.classList.remove('hide');
  friendsScreen.setAttribute('aria-hidden','false');

  // –ø—Ä—è—á–µ–º —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω–∏–π —Ç–æ–ø–±–∞—Ä
  topbarEl?.classList.add('hide');

  // –Ω–∏–∂–Ω–∏–π —Ç–∞–±–±–∞—Ä –û–°–¢–ê–Å–¢–°–Ø –≤–∏–¥–∏–º—ã–º ‚Äî –Ω–∏–∫–∞–∫–∏—Ö body-–∫–ª–∞—Å—Å–æ–≤
  document.body.classList.remove('friends-active');

  setActiveTab(friendsTab);
  window.scrollTo({ top: 0, behavior: 'smooth' });

  // –∑–∞–≥–æ–ª–æ–≤–æ–∫ ¬´–î—Ä—É–∑—å—è¬ª –ø—Ä–∏–∂–∞—Ç –∫ —Å–∞–º–æ–º—É –≤–µ—Ä—Ö—É
  document.documentElement.style.setProperty('--topbar-h', '0px');

  renderFriends();
}


// –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–ø–±–∞—Ä –ø—Ä–∏ —É—Ö–æ–¥–µ —Å ¬´–î—Ä—É–∑–µ–π¬ª
function restoreTopbarIfNeeded(){
  if (friendsScreen?.classList.contains('hide')){
    topbarEl?.classList.remove('hide');
  }
}

function showUpgrades(){
  hardCloseDetailAndModal();

  // –≤–µ—Ä–Ω—É—Ç—å –≤–µ—Ä—Ö–Ω–∏–π —Ç–æ–ø–±–∞—Ä –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
  topbarEl?.classList.remove('hide');
  restoreTopbarIfNeeded?.();
  if (typeof syncTopbarOffset === 'function') syncTopbarOffset();
  if (typeof syncTabbarOffset === 'function') syncTabbarOffset();

  // —Å–ø—Ä—è—Ç–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã
  chipbar.classList.add('hide');
  content.classList.add('hide');
  backTop.classList.add('hide');

  profileScreen.classList.add('hide');  profileScreen.setAttribute('aria-hidden','true');
  friendsScreen.classList.add('hide');  friendsScreen.setAttribute('aria-hidden','true');
  contestsScreen.classList.add('hide'); contestsScreen.setAttribute('aria-hidden','true');

  // –ø–æ–∫–∞–∑–∞—Ç—å –∞–ø–≥—Ä–µ–π–¥—ã
  upgradesScreen.classList.remove('hide');
  upgradesScreen.setAttribute('aria-hidden','false');

  // –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –∫–æ–ª–µ—Å–æ
  renderUpgrades();

  setActiveTab(upgradesTab);
  document.body.classList.remove('friends-active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// === –ü–£–°–¢–û–ô –†–ï–ñ–ò–ú –î–õ–Ø ¬´–ö–û–ù–ö–£–†–°–û–í¬ª ===

// true ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É ¬´–ó–¥–µ—Å—å –ø–æ–∫–∞ —á—Ç–æ –ø—É—Å—Ç–æ¬ª; false ‚Äî –æ–±—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
GD.contestsEmpty = true;

/** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø—É—Å—Ç–æ–π —Ä–µ–∂–∏–º –∫–æ–Ω–∫—É—Ä—Å–æ–≤.
 * –ü—Ä–∏–º–µ—Ä—ã:
 *   GD.setContestsEmpty(false) // –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
 *   GD.setContestsEmpty(true)  // —Å–Ω–æ–≤–∞ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É
 */
GD.setContestsEmpty = function(on){
  GD.contestsEmpty = !!on;
  // –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞ ‚Äî –ø–µ—Ä–µ—Ä–∏—Å—É–µ–º
  const scr = document.getElementById('contestsScreen');
  if (scr && !scr.classList.contains('hide')) {
    renderContests();
  }
};

function renderContests(){
  const contestsScreen = document.getElementById('contestsScreen');
  if (!contestsScreen) return;

  // ‚Äî‚Äî‚Äî –ü–£–°–¢–û–ô –†–ï–ñ–ò–ú ‚Äî‚Äî‚Äî
  if (GD.contestsEmpty){
    // ‚Äî‚Äî‚Äî –ü–£–°–¢–û–ô –†–ï–ñ–ò–ú ‚Äî‚Äî‚Äî
contestsScreen.innerHTML = `
  <div class="contests-fixed">
    <div class="contests-header">–ö–û–ù–ö–£–†–°–´</div>
    <div class="contests-center">
      <div style="
        text-align:center;
        font-weight:900; letter-spacing:.6px;
        font-size:clamp(22px, 6vw, 32px);
        color:#e8efff;
        text-shadow:0 0 16px rgba(22,241,255,.18);
        opacity:.95;
      ">
        –ó–¥–µ—Å—å –ø–æ–∫–∞ —á—Ç–æ –ø—É—Å—Ç–æ
      </div>
    </div>
  </div>
`;
return;
  }

  // ‚Äî‚Äî‚Äî –ü–û–õ–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° ‚Äî‚Äî‚Äî
contestsScreen.innerHTML = `
  <div class="contests-fixed">
    <div class="contests-header">–ö–û–ù–ö–£–†–°–´</div>
    <div class="contests-list" id="contList"></div>
  </div>
`;


  const list = document.getElementById('contList');

  const buildLink = (username, link) => {
    const u = String(username || "").trim();
    if (link) return link;
    if (u.startsWith("@")) return `https://t.me/${u.slice(1)}`;
    return "";
  };

  (window.CONTESTS_DATA || []).forEach((item, i) => {
    if (i > 0){
      const sep = document.createElement('div');
      sep.className = 'cont-sep';
      list.appendChild(sep);
    }

    const card = document.createElement('div');
    card.className = 'cont-card';
    const imgUrl = item.img || window.FALLBACK_IMG || 'https://via.placeholder.com/512?text=%F0%9F%8E%81';
    const uname  = item.username || "@username";
    const href   = buildLink(uname, item.link);

    card.innerHTML = `
      <div class="cont-img">
        <img src="${imgUrl}" alt="${esc(uname)}"
             onerror="this.src='${window.FALLBACK_IMG || 'https://via.placeholder.com/512?text=%F0%9F%8E%81'}'">
      </div>
      <div class="cont-right">
        ${href
          ? `<a class="cont-username" href="${href}" target="_blank" rel="noopener" title="${esc(uname)}">${esc(uname)}</a>`
          : `<span class="cont-username" title="${esc(uname)}">${esc(uname)}</span>`}
        ${href ? `<button type="button" class="cont-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>` : ``}
      </div>
    `;
    list.appendChild(card);
  });

  list.addEventListener('click', (e) => {
    const userLink = e.target.closest('.cont-username');
    if (userLink && userLink.href){
      e.preventDefault();
      safeOpen(userLink.href);
      return;
    }
    const btn = e.target.closest('.cont-btn');
    if (btn){
      e.preventDefault();
      const card = btn.closest('.cont-card');
      const link = card?.querySelector('.cont-username')?.href;
      if (link) safeOpen(link);
    }
  }, { passive:false });
}



function showContests(){
  hardCloseDetailAndModal();
// –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤–∏–¥–∏–º—ã–π –≤–µ—Ä—Ö–Ω–∏–π —Ç–æ–ø–±–∞—Ä –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
topbarEl?.classList.remove('hide');
restoreTopbarIfNeeded?.();
if (typeof syncTopbarOffset === 'function') syncTopbarOffset();
if (typeof syncTabbarOffset === 'function') syncTabbarOffset();
  cancelPromoEditing?.();

  // –ø—Ä—è—á–µ–º ¬´–ö–µ–π—Å—ã¬ª, ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª –∏ ¬´–î—Ä—É–∑—å—è¬ª
  chipbar.classList.add('hide');
  content.classList.add('hide');
  backTop.classList.add('hide');

  profileScreen.classList.add('hide');
  profileScreen.setAttribute('aria-hidden','true');

  friendsScreen.classList.add('hide');
  friendsScreen.setAttribute('aria-hidden','true');
  upgradesScreen.classList.add('hide');
upgradesScreen.setAttribute('aria-hidden','true');


  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∫–æ–Ω–∫—É—Ä—Å–æ–≤
  contestsScreen.classList.remove('hide');
  contestsScreen.setAttribute('aria-hidden','false');

  // –ø–æ–¥–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –Ω–∞—à –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω–∫—É—Ä—Å–æ–≤
  renderContests();

  // –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–± –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
  setActiveTab(contestsTab);
  restoreTopbarIfNeeded();
  document.body.classList.remove('friends-active');
  if (typeof syncTopbarOffset === 'function') syncTopbarOffset();
  if (typeof syncTabbarOffset === 'function') syncTabbarOffset();

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function renderUpgrades(){
  if (!upgradesScreen) return;

  const TOKEN_URL = "assets/images/20251005_0825_–Ø—Ä–∫–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ_remix_01k6sd902pf03ah1w3cpkr66jz.png"; // –≥–ª–∏—Ç—á-—Ç–æ–∫–µ–Ω
  const STAR_URL  = "assets/images/–∑–≤–µ–∑–¥–∞.png";                                                                // –∑–≤–µ–∑–¥–∞
  const ART_URL   = "assets/images/20251028_1051_–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –Ω–µ–æ–Ω–æ–≤—ã–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫_simple_compose_01k8mwr9qzev3sczxr1rzxfm50.png";

  upgradesScreen.innerHTML = `
    <div class="upg-surface">
      <div class="upg-wrap">

        <!-- –ö—Ä—É–ø–Ω—ã–π —Å—á—ë—Ç -->
        <div class="upg-score">
          <span id="upgCount">0</span>
          <img class="upg-art" src="${ART_URL}" alt="">
        </div>

        <!-- –ü–æ–ª–æ—Å–∞ —Å –∫—É–±–∏–∫–æ–º -->
        <div class="upg-bar">
          <div class="upg-track" id="upgTrack">
            <div class="upg-start-bg"></div>
            <div class="upg-thumb" id="upgThumb" aria-label="–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–π –∫—É–±–∏–∫"></div>
          </div>
        </div>

        <!-- –°—Ç—Ä–æ–∫–∏ —Å –∫—É—Ä—Å–∞–º–∏ -->
        <div class="upg-rows">
          <div class="upg-row">
            <img class="xart" src="${ART_URL}" alt="">
            <img class="ico" src="${TOKEN_URL}" alt="">
            <span>500 = 1</span>
            <img class="ico" src="${TOKEN_URL}" alt="" style="width:1em;height:1em;">
          </div>

          <div class="upg-row">
            <img class="xart" src="${ART_URL}" alt="">
            <img class="ico" src="${TOKEN_URL}" alt="">
            <span>5000 = 10</span>
            <img class="ico" src="${STAR_URL}" alt="" style="width:1em;height:1em;">
          </div>
        </div>

        <div class="upg-note">–°—á—ë—Ç –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –∫—Ä—É–≥–µ: L‚ÜíR (+1), –∑–∞—Ç–µ–º –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è R‚ÜíL –∏ —Å–Ω–æ–≤–∞ –Ω–∞ R, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π +1.</div>
      </div>
    </div>
  `;

  // === –õ–û–ì–ò–ö–ê –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–Ø –ò –°–ß–Å–¢–ê ===
  const tg = window.Telegram?.WebApp;
  const track = document.getElementById('upgTrack');
  const thumb = document.getElementById('upgThumb');
  const cntEl = document.getElementById('upgCount');

  const state = {
    dragging: false,
    startX: 0,
    left: 0,
    min: 0,
    max: 0,
    count: Number(cntEl?.textContent || 0) || 0,
    armedRight: true,   // –º–æ–∂–Ω–æ –∑–∞—Å—á–∏—Ç–∞—Ç—å –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π? (–ø–µ—Ä–≤—ã–π –∫—Ä—É–≥ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –¥–∞)
    needLeft: false     // –Ω—É–∂–Ω–æ –ª–∏ —Å–Ω–∞—á–∞–ª–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–ª–µ–≤–æ?
  };

  const setLeft = (x) => {
    state.left = Math.min(state.max, Math.max(state.min, x));
    thumb.style.left = `${state.left}px`;
  };

  const layout = () => {
    const tr = track.getBoundingClientRect();
    const th = thumb.getBoundingClientRect();
    // thumb –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –≤—ã—Å–æ—Ç—É, —Å—á–∏—Ç–∞–µ–º —à–∏—Ä–∏–Ω—É —Å CSS, –Ω–æ –±–µ—Ä—ë–º –∏–∑ getComputed
    const thumbW = parseFloat(getComputedStyle(thumb).width) || th.width || 24;
    state.min = 0;
    state.max = Math.max(0, tr.width - thumbW);
    setLeft(state.min);               // —Å—Ç–∞–≤–∏–º –≤ —Å–∞–º—ã–π –ª–µ–≤—ã–π –∫—Ä–∞–π
  };

  const vibrate = () => {
    try { tg?.HapticFeedback?.impactOccurred('heavy'); } catch(_) {}
    if (navigator.vibrate) try{ navigator.vibrate(25); }catch(_){}
  };

  const onDown = (clientX) => {
    state.dragging = true;
    state.startX = clientX - state.left;
    thumb.style.cursor = 'grabbing';
  };
  const onMove = (clientX) => {
    if (!state.dragging) return;
    setLeft(clientX - state.startX);

    // –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å–∞–Ω–∏–π –∫—Ä–∞—ë–≤
    const atLeft  = state.left <= state.min + 0.5;
    const atRight = state.left >= state.max - 0.5;

    // –í–µ—Ä–Ω—É–ª—Å—è –≤–ª–µ–≤–æ ‚Üí ¬´–∑–∞—Ä—è–¥–∏—Ç—å¬ª —Å–ª–µ–¥—É—é—â–∏–π right
    if (atLeft){
      state.armedRight = true;
      state.needLeft   = false;
    }

    // –î–æ—Å—Ç–∏–≥ –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è
    if (atRight){
      if (state.armedRight && !state.needLeft){
        state.count += 1;
        if (cntEl) cntEl.textContent = String(state.count);
        vibrate();
        // –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–≥–æ –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–ª–µ–≤–æ
        state.armedRight = false;
        state.needLeft   = true;
      }
    }
  };
  const onUp = () => {
    state.dragging = false;
    thumb.style.cursor = 'grab';
  };

  // Mouse
  thumb.addEventListener('mousedown', e => { e.preventDefault(); onDown(e.clientX); });
  window.addEventListener('mousemove', e => { onMove(e.clientX); });
  window.addEventListener('mouseup',   onUp);

  // Touch
  thumb.addEventListener('touchstart', e => {
    const t = e.touches[0]; if (!t) return;
    onDown(t.clientX);
  }, {passive:true});
  window.addEventListener('touchmove', e => {
    const t = e.touches[0]; if (!t) return;
    onMove(t.clientX);
  }, {passive:true});
  window.addEventListener('touchend',   onUp);
  window.addEventListener('touchcancel',onUp);

  // –ü–µ—Ä–µ—Å—á—ë—Ç –≥–µ–æ–º–µ—Ç—Ä–∏–∏
  layout();
  window.addEventListener('resize', layout, {passive:true});
  window.addEventListener('orientationchange', layout, {passive:true});
}

// ===== CONFIRM SELL MODAL =====
const confirmModal = document.getElementById('confirmModal');
const confirmYes   = document.getElementById('confirmYes');
const confirmNo    = document.getElementById('confirmNo');
const confirmText  = document.getElementById('confirmText');

let _confirmOpen = false;
let _confirmOnYes = null;
let _confirmLastFocus = null;

function openConfirmSell(onYesCb, text){
  if (!confirmModal) return;

  _confirmOnYes = typeof onYesCb === 'function' ? onYesCb : null;
  if (text && confirmText) confirmText.textContent = text;

  _confirmLastFocus = document.activeElement;

  confirmModal.classList.add('show');
  confirmModal.setAttribute('aria-hidden','false');
  _confirmOpen = true;
  lockBody(true);

  setTimeout(()=> (confirmNo || confirmModal).focus(), 0);

  // –∫–æ–ª–±—ç–∫ –≤—ã–∑—ã–≤–∞–µ–º –î–û –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏
  if (confirmYes) {
    confirmYes.onclick = ()=>{
      const cb = _confirmOnYes;
      if (cb) cb();
      closeConfirmModal();
    };
  }
  if (confirmNo) {
    confirmNo.onclick = ()=> closeConfirmModal();
  }

  document.addEventListener('keydown', _confirmEsc, true);
  confirmModal.addEventListener('click', _confirmBackdrop, true);
  document.addEventListener('keydown', _confirmTrapTab, true);
}


function closeConfirmModal(){
  if (!confirmModal) return;
  confirmModal.classList.remove('show');
  confirmModal.setAttribute('aria-hidden','true');
  _confirmOpen = false;

  // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–æ–ª–ª, –µ—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤/–º–æ–¥–∞–ª–æ–∫
  const dropIsOpen = typeof _modalOpen !== 'undefined' && _modalOpen;
  if (!detail.classList.contains('show') && !dropIsOpen){
    lockBody(false);
  }

  document.removeEventListener('keydown', _confirmEsc, true);
  confirmModal.removeEventListener('click', _confirmBackdrop, true);
  document.removeEventListener('keydown', _confirmTrapTab, true);

  if (_confirmLastFocus && _confirmLastFocus.focus) _confirmLastFocus.focus();
  _confirmOnYes = null;
}

function _confirmEsc(e){
  if (e.key === 'Escape'){
    e.stopPropagation();
    e.preventDefault();
    closeConfirmModal();
  }
}
function _confirmBackdrop(e){
  const card = confirmModal.querySelector('.modal-card');
  if (!card.contains(e.target)){
    e.stopPropagation();
    e.preventDefault();
    // –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∫–ª–∏–∫–æ–º –ø–æ —Ñ–æ–Ω—É
  }
}
function _confirmTrapTab(e){
  if (e.key !== 'Tab' || !_confirmOpen) return;
  const focusables = confirmModal.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])');
  const list = Array.from(focusables).filter(el=>!el.disabled && el.offsetParent !== null);
  if (!list.length) return;
  const first = list[0], last = list[list.length-1];
  if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
  else if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
}

function sellFromInventory(id, cardEl){
  // –Ω–µ–±–æ–ª—å—à–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
  if (cardEl){
    cardEl.style.transition = 'transform 160ms ease, opacity 160ms ease';
    cardEl.style.opacity = '0';
    cardEl.style.transform = 'scale(.96)';
  }

  // —É–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞
  const arr = window.INVENTORY || [];
  const idx = arr.findIndex(it => it.id === id);
  if (idx !== -1){
    arr.splice(idx, 1);
    saveInventory();
  }

  // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É —á—É—Ç—å –ø–æ–∑–∂–µ, —á—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ–ª–∞ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å—Å—è
  setTimeout(() => {
    renderInventory();
  }, 170);
}


// –ù–∞–≤–µ—à–∏–≤–∞–µ–º –∫–ª–∏–∫–∏
if (casesTab){
  casesTab.style.cursor = 'pointer';
  casesTab.addEventListener('click', showCases);
}
if (profileTab){
  profileTab.style.cursor = 'pointer';
  profileTab.addEventListener('click', showProfile);
}
if (friendsTab){
  friendsTab.style.cursor = 'pointer';
  friendsTab.addEventListener('click', showFriends);
}
if (contestsTab){
  contestsTab.style.cursor = 'pointer';
  contestsTab.addEventListener('click', showContests);
}
if (upgradesTab){
  upgradesTab.style.cursor = 'pointer';
  upgradesTab.addEventListener('click', showUpgrades);
}


// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –º—ã –≤ "–ö–µ–π—Å–∞—Ö"
showCases();


</script>

</body>
</html>
