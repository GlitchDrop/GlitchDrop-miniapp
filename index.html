<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>GLITCH DROP ‚Äî Mini App</title>

  <style>
    :root{
      --bg-top:#0c1822; --bg-bot:#0e2230; --grid:rgba(255,255,255,.035); --grid-gap:34px;
      --panel:#0a0f1e; --panel2:#0a0d19; --card:#0e1330; --card2:#0b0f26;
      --neon-cyan:#16f1ff; --neon-pink:#ff3ed0; --neon-yellow:#ffe47a;
      --text:#e8efff; --muted:#9fb2d9; --border:rgba(120,180,255,.25);
      --shadow-strong:0 20px 60px rgba(10,20,60,.55), 0 0 60px rgba(22,241,255,.08);
      --shadow-soft:0 10px 30px rgba(10,20,60,.35);
      --radius:18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',system-ui,Segoe UI,Roboto,Arial,sans-serif}
    html{scroll-behavior:smooth}
    body{ color:var(--text); overflow-x:hidden; background:#0e1b25; }
    .cyber-bg{
      position:fixed; inset:0; z-index:0; pointer-events:none;
      background:
        linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bot) 100%),
        repeating-linear-gradient(0deg,  var(--grid) 0 1px,  transparent 1px var(--grid-gap)),
        repeating-linear-gradient(90deg, var(--grid) 0 1px,  transparent 1px var(--grid-gap));
      background-blend-mode: normal, overlay, overlay;
    }

    .app{min-height:100%;display:flex;flex-direction:column;position:relative;z-index:1}

    .topbar{
      position:sticky; top:0; z-index:30;
      display:flex; align-items:center; gap:12px;
      padding:12px 14px;
      background:linear-gradient(180deg,rgba(8,14,36,.72),rgba(6,10,26,.62));
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(10px);
      box-shadow:var(--shadow-soft);
    }
    .avatar{ width:42px; height:42px; border-radius:50%; border:2px solid rgba(22,241,255,.55); box-shadow:0 0 18px rgba(22,241,255,.28), 0 0 28px rgba(255,62,208,.18); object-fit:cover; background:linear-gradient(135deg, rgba(22,241,255,.15), rgba(255,62,208,.15)); }
    .avatar.hidden{ display:none; }
    .avatar-fallback{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center; background:linear-gradient(135deg, rgba(22,241,255,.18), rgba(255,62,208,.18)); border:1px solid var(--border); font-weight:900; letter-spacing:.5px; color:#081121; text-shadow:0 0 12px rgba(22,241,255,.7); }
    .brand{position:relative; font-weight:900; line-height:1; letter-spacing:1px}
    .brand .glitch{ font-size:22px; color:#cfe6ff; position:relative; display:inline-block; text-shadow:0 0 24px rgba(22,241,255,.55), 0 0 24px rgba(255,62,208,.35); }
    .brand .glitch::before,.brand .glitch::after{ content:attr(data-text); position:absolute; left:0; top:0; width:100%; overflow:hidden; }
    .brand .glitch::before{ transform:translateX(1px); color:var(--neon-cyan); opacity:.9; text-shadow:0 0 10px rgba(22,241,255,.8); animation:glitch 3s infinite ease-in-out;}
    .brand .glitch::after { transform:translateX(-1px); color:var(--neon-pink); opacity:.8; text-shadow:0 0 10px rgba(255,62,208,.8); animation:glitch 2.6s infinite ease-in-out reverse;}
    @keyframes glitch{ 0%,100%{clip-path:inset(0 0 0 0)} 10%{clip-path:inset(0 0 65% 0)} 20%{clip-path:inset(0 0 0 0)} 30%{clip-path:inset(40% 0 0 0)} 45%{clip-path:inset(0 0 0 0)} 60%{clip-path:inset(0 0 75% 0)} 80%{clip-path:inset(20% 0 10% 0)} }
    .grow{flex:1}

    .pill{
      display:flex; align-items:center; gap:10px; padding:8px 12px;
      border-radius:999px; border:1px solid var(--border);
      background:linear-gradient(135deg, rgba(22,241,255,.1), rgba(138,92,255,.12));
      box-shadow:0 0 18px rgba(22,241,255,.12) inset;
      font-weight:900; color:#cfe6ff;
    }
    /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∏–∫–æ–Ω–æ–∫ */
    .pill img{width:18px; height:18px; display:block; object-fit:cover; border-radius:4px}
    /* –µ–¥–∏–Ω—ã–π —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –æ–±–µ–∏—Ö –ø–∏–ª—é–ª—å */
    .pill--lg{ padding:10px 14px; }
    .pill--lg img{ width:24px; height:24px; }

    .chipbar{
      position:sticky; top:64px; z-index:25;
      display:flex; gap:10px; padding:10px 14px; overflow-x:auto;
      background:linear-gradient(180deg,rgba(8,14,36,.72),rgba(6,10,26,.62));
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(10px);
    }
    .chipbar::-webkit-scrollbar{display:none}
    .chip{
      padding:10px 14px; border-radius:999px; white-space:nowrap; cursor:pointer;
      border:1px solid var(--border); color:#9fb2d9; font-weight:800; user-select:none;
      background:linear-gradient(135deg, rgba(15,20,48,.7), rgba(12,16,38,.7));
      transition:transform .15s, box-shadow .15s, color .15s, background .2s, border-color .2s;
    }
    .chip:hover{ transform:translateY(-1px); box-shadow:0 8px 22px rgba(22,241,255,.12)}
    .chip.active{ color:#081121 !important; background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink)) !important; border-color:transparent !important; box-shadow:0 6px 28px rgba(22,241,255,.35), 0 0 44px rgba(255,62,208,.25) !important; }

    .content{flex:1; padding:16px; max-width:1100px; margin:0 auto; width:100%}
    h2.section{ margin:20px 0 12px; text-align:center; font-size:13px; letter-spacing:2px; opacity:.95; color:#d7e6ff; text-shadow:0 0 16px rgba(22,241,255,.25); scroll-margin-top:130px; }
    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:14px}

    /* ====== CARD –∫–µ–π—Å–∞ (–±–µ–∑ —Ñ–ª–∏–ø–∞) ====== */
    .card{ position:relative; background:linear-gradient(180deg, rgba(20,26,62,.55), rgba(14,18,40,.6)); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow-strong); padding:12px; display:flex; flex-direction:column; gap:10px; overflow:hidden; cursor:pointer; }
    .card::before{ content:""; position:absolute; inset:-2px; background:conic-gradient(from 200deg, transparent, rgba(22,241,255,.18), transparent 30%, rgba(255,62,208,.18), transparent 55%); filter:blur(14px); opacity:.35; z-index:0; }
    .inner{position:relative; z-index:1}
    .thumb{
      height:160px; border-radius:14px; border:1px dashed rgba(180,210,255,.35);
      background: radial-gradient(120px 80px at 20% 20%, rgba(22,241,255,.12), transparent 60%), radial-gradient(120px 80px at 80% 80%, rgba(255,62,208,.10), transparent 60%), linear-gradient(180deg,#0c1230,#0a1028);
      display:grid; place-items:center; color:#a9c2ff; font-size:12px; text-transform:uppercase; letter-spacing:1px;
      overflow:hidden;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .name{font-weight:900; letter-spacing:.3px}
    .desc{font-size:12px; color:#9fb2d9}
    .price{font-weight:900; color:var(--neon-yellow); text-shadow:0 0 12px rgba(255,228,122,.25)}

    .tabbar{ position:sticky; bottom:0; z-index:24; background:linear-gradient(180deg,rgba(8,14,36,.72),rgba(6,10,26,.62)); border-top:1px solid var(--border); backdrop-filter:blur(10px); display:grid; grid-template-columns:repeat(5,1fr); padding:8px 6px }
    .tab{display:flex; flex-direction:column; align-items:center; gap:4px; padding:6px 2px; color:#9fb2d9; font-size:12px; font-weight:800}
    .tab.active{color:#e8efff}
    .ico{font-size:18px; text-shadow:0 0 10px rgba(22,241,255,.3)}

    .backtop{ position:fixed; right:14px; bottom:90px; z-index:50; padding:9px 12px; border-radius:12px; font-weight:900; font-size:12px; letter-spacing:.3px; border:1px solid rgba(22,241,255,.45); color:#081121; background:linear-gradient(135deg, var(--neon-cyan), var(--neon-pink)); box-shadow:0 10px 28px rgba(22,241,255,.35), 0 0 36px rgba(255,62,208,.25); opacity:0; pointer-events:none; transform:translateY(8px); transition:opacity .2s, transform .2s; }
    .backtop.show{opacity:1; pointer-events:auto; transform:translateY(0)}

    /* ===== DETAIL VIEW ===== */
    .detail{
      position:fixed; inset:0; z-index:60; display:none; flex-direction:column;
      background:
        linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bot) 100%),
        repeating-linear-gradient(0deg,  var(--grid) 0 1px,  transparent 1px var(--grid-gap)),
        repeating-linear-gradient(90deg, var(--grid) 0 1px,  transparent 1px var(--grid-gap));
      background-blend-mode: normal, overlay, overlay;
      overflow:auto;
    }
    .detail.show{ display:flex; }
    .d-topbar{ position:sticky; top:0; z-index:61; display:flex; align-items:center; gap:10px; padding:10px 14px; background:linear-gradient(180deg,rgba(8,14,36,.82),rgba(6,10,26,.7)); border-bottom:1px solid var(--border); backdrop-filter:blur(10px); }
    .btn-back{ appearance:none; border:1px solid var(--border); background:transparent; color:var(--text); padding:8px 12px; border-radius:12px; font-weight:900; cursor:pointer; }
    .d-title{font-weight:900}
    .d-body{padding:16px; max-width:1100px; margin:0 auto; width:100%}
    .d-hero{display:grid; grid-template-columns:1fr; gap:14px; margin-bottom:10px;}
    .d-thumb{ height:200px; border-radius:16px; border:1px dashed rgba(180,210,255,.35);
      background: radial-gradient(160px 110px at 20% 20%, rgba(22,241,255,.12), transparent 60%), radial-gradient(160px 110px at 80% 80%, rgba(255,62,208,.10), transparent 60%), linear-gradient(180deg,#0c1230,#0a1028);
      display:grid; place-items:center; color:#a9c2ff; text-transform:uppercase; letter-spacing:1px; }
    .d-actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn-spin{ appearance:none; border:none; cursor:pointer; padding:12px 18px; border-radius:14px; font-weight:900; color:#081121; background:linear-gradient(135deg,#ffe28a,#ffc13a); box-shadow:0 10px 28px rgba(255,209,102,.35), 0 0 30px rgba(255,209,102,.25); }

    .panel{ margin-top:14px; padding:12px; border:1px solid var(--border); border-radius:16px; background:linear-gradient(180deg, rgba(20,26,62,.55), rgba(14,18,40,.6)); }
    .panel h3{margin:0 0 10px; text-align:center}
    .switch{display:flex; align-items:center; gap:10px; font-weight:800}
    .toggle{ width:46px; height:26px; border-radius:999px; position:relative; background:#2a314a; border:1px solid var(--border); cursor:pointer; }
    .toggle::after{ content:""; position:absolute; top:2px; left:2px; width:22px; height:22px; border-radius:50%; background:#fff; transition:transform .18s; }
    .toggle.active{ background:#19e6ff; } .toggle.active::after{ transform:translateX(20px); }
    .qty{display:flex; gap:10px; justify-content:center}
    .qty .q{ min-width:44px; height:40px; border-radius:12px; display:grid; place-items:center; cursor:pointer; border:1px solid var(--border); background:rgba(15,20,48,.6); font-weight:900; }
    .qty .q.active{ outline:2px solid var(--neon-cyan); color:#081121; background:linear-gradient(135deg,var(--neon-cyan),var(--neon-pink)); border-color:transparent }

    .subhead{margin:18px 0 10px; text-align:center; font-weight:900; letter-spacing:1.2px}

    /* ====== LOOT GRID —Å —Ñ–ª–∏–ø–æ–º ====== */
    .loot-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}

    .loot{
      position:relative; width:100%; aspect-ratio:1/1;
      perspective:900px;
      border-radius:14px;
    }
    .loot-inner{
      position:relative; width:100%; height:100%;
      transform-style:preserve-3d;
      transition:transform .45s cubic-bezier(.2,.7,.2,1);
      border-radius:14px;
    }
    .loot.flipped .loot-inner{ transform:rotateY(180deg); }

    .loot-face{
      position:absolute; inset:0;
      border-radius:14px;
      border:1px dashed rgba(180,210,255,.35);
      overflow:hidden;
      backface-visibility:hidden; -webkit-backface-visibility:hidden;
      display:grid; place-items:center;
      background: linear-gradient(180deg,#0c1230,#0a1028);
      color:#a9c2ff; font-size:12px; letter-spacing:1px; text-transform:uppercase;
    }
    .loot-front img{ width:100%; height:100%; object-fit:cover; display:block; }
    .loot-back{
      transform:rotateY(180deg);
      background:
        linear-gradient(180deg, rgba(12,18,48,.88), rgba(8,14,36,.9)),
        radial-gradient(600px 200px at 50% 110%, rgba(22,241,255,.12), transparent 60%),
        radial-gradient(600px 200px at 50% -10%, rgba(255,62,208,.10), transparent 60%);
      padding:12px;
      gap:8px;
    }

    /* ¬´–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ¬ª */
    .lb-stats{ width:100%; }
    .lb-stars, .lb-ton{
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      line-height:1.05;
      letter-spacing:.2px;
    }
    .lb-stars{
      font-size:20px;
      color:var(--neon-yellow);
      margin-bottom:4px;
      text-shadow:0 0 12px rgba(255,228,122,.25);
    }
    .lb-ton{
      font-size:18px;
      color:#79c6ff;
      text-shadow:0 0 12px rgba(22,241,255,.22);
    }
  </style>

<style>

/* ===== –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤ d-thumb ===== */
.spin-embed{ width:100%; height:100%; display:flex; }
.spin-viewport{
  height:100%; width:100%;
  border-radius:16px; border:1px solid var(--border);
  background:linear-gradient(180deg,#0c1230,#0a1028);
  overflow:hidden; box-shadow:inset 0 0 24px rgba(22,241,255,.12);
  position:relative;
}
/* –í–ê–ñ–ù–û: —Ç—Ä–µ–∫ –≤–æ –≤—Å—é –≤—ã—Å–æ—Ç—É viewport */
.spin-track{
  position:absolute; top:0; left:0; height:100%;
  display:flex; align-items:stretch; gap:12px;
  will-change:transform;
  transform:translateX(0);
}
.spin-pointer{
  position:absolute; top:0; bottom:0; left:50%; width:2px; transform:translateX(-50%);
  background:linear-gradient(180deg, var(--neon-cyan), var(--neon-pink));
  box-shadow:0 0 14px rgba(22,241,255,.55), 0 0 22px rgba(255,62,208,.35);
  pointer-events:none;
}

/* –ø–ª–∏—Ç–∫–∞ —Ä–æ–≤–Ω–æ –ø–æ –≤—ã—Å–æ—Ç–µ viewport */
.slot{
  width:110px; height:100%;
  border-radius:14px; border:1px dashed rgba(180,210,255,.35);
  background:
    radial-gradient(120px 80px at 20% 20%, rgba(22,241,255,.12), transparent 60%),
    radial-gradient(120px 80px at 80% 80%, rgba(255,62,208,.10), transparent 60%),
    linear-gradient(180deg,#0c1230,#0a1028);
  display:grid; grid-template-rows: 1fr auto auto; align-items:center; justify-items:center; padding:8px;
  box-shadow:0 10px 30px rgba(10,20,60,.35);
}
.slot-img{
  height:70%; aspect-ratio:1/1; border-radius:12px; overflow:hidden; border:1px solid var(--border);
  background: radial-gradient(80px 60px at 50% 50%, rgba(22,241,255,.10), transparent 60%);
  display:grid; place-items:center;
}
.slot-img img{ width:100%; height:100%; object-fit:cover; display:block; }
.slot-label{ margin-top:6px; font-size:12px; font-weight:800; color:#a9c2ff; text-transform:uppercase; letter-spacing:.4px; text-align:center; }
.slot-value{ font-size:14px; font-weight:900; color:var(--neon-yellow); text-shadow:0 0 12px rgba(255,228,122,.25); }

.slot.hot{ outline:2px solid var(--neon-cyan); box-shadow:0 0 24px rgba(22,241,255,.25), inset 0 0 12px rgba(22,241,255,.12); }

/* CTA */
.spin-cta{
  appearance:none; cursor:pointer; border:none;
  padding:12px 16px; border-radius:14px; font-weight:900; color:#081121;
  background:linear-gradient(135deg,#ffe28a,#ffc13a);
  box-shadow:0 10px 28px rgba(255,209,102,.35), 0 0 30px rgba(255,209,102,.25);
}
.spin-cta.secondary{
  background:transparent; color:#e8efff;
  border:1px solid var(--border);
  box-shadow:none;
}
.hide{ display:none !important; }

/* ===== –ú–∞—Ç—Ä–∏—Ü–∞ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∏–¥–∂–µ—Ç–æ–≤ –ø—Ä–æ–∫—Ä—É—Ç–∞ ===== */
.spin-matrix{
  display:grid;
  gap:10px;
  grid-template-columns: repeat(var(--cols,1), 1fr);
}
.spin-matrix .spin-viewport{
  height: var(--cell-h, 200px); /* –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–º–µ–Ω—å—à–∞–µ–º –∏–∑ JS */
}

/* –ö–Ω–æ–ø–∫–∞ ¬´–ö–†–£–¢–ò–¢–¨¬ª –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–∫—Ä—É—Ç–∞ */
.btn-spin:disabled{
  opacity:.6;
  cursor:not-allowed;
  filter:grayscale(0.5);
  background:linear-gradient(135deg,#8c8c8c,#b0b0b0);
  box-shadow:none;
}

</style>

</head>
<body>
  <div class="cyber-bg"></div>

  <div class="app" id="top">
    <div class="topbar">
      <img id="userAvatar" class="avatar hidden" alt="avatar">
      <div id="avatarFallback" class="avatar-fallback">GD</div>
      <div class="brand"><span id="userName" class="glitch" data-text="GLITCH&nbsp;DROP">GLITCH&nbsp;DROP</span></div>
      <div class="grow"></div>

      <!-- –ü–∏–ª—é–ª—è –ì–õ–ò–¢–ß-–¢–û–ö–ï–ù —Å–ª–µ–≤–∞ -->
      <div class="pill pill--lg" title="–ì–ª–∏—Ç—á-—Ç–æ–∫–µ–Ω">
        <img src="assets/images/20251005_0825_–Ø—Ä–∫–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ_remix_01k6sd902pf03ah1w3cpkr66jz.png" alt="–≥–ª–∏—Ç—á-—Ç–æ–∫–µ–Ω">
        <span class="num" id="bonus">50</span>
      </div>

      <!-- –ü–∏–ª—é–ª—è —Å–æ –ó–í–ï–ó–î–û–ô —Å–ø—Ä–∞–≤–∞ (—Ç–∞–∫–æ–π –∂–µ —Ä–∞–∑–º–µ—Ä) -->
      <div class="pill pill--lg">
        <img src="assets/images/–∑–≤–µ–∑–¥–∞.png" alt="–∑–≤–µ–∑–¥–∞">
        <span class="num" id="stars">120</span>
      </div>
    </div>

    <div class="chipbar" id="chipbar"><div class="chip active" data-target="#top">–í—Å–µ</div></div>
    <div class="content" id="content"></div>

    <nav class="tabbar">
      <div class="tab"><div class="ico">üèÜ</div>–ö–æ–Ω–∫—É—Ä—Å—ã</div>
      <div class="tab"><div class="ico">‚ö°</div>–ê–ø–≥—Ä–µ–π–¥</div>
      <div class="tab active"><div class="ico">üéÅ</div>–ö–µ–π—Å—ã</div>
      <div class="tab"><div class="ico">üë•</div>–î—Ä—É–∑—å—è</div>
      <div class="tab"><div class="ico">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </nav>
  </div>

  <!-- DETAIL VIEW -->
  <div id="detail" class="detail" aria-hidden="true">
    <div class="d-topbar">
      <button id="backBtn" class="btn-back">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="d-title" id="detailTitle">–ö–µ–π—Å</div>
      <div class="grow"></div>
    </div>
    <div class="d-body">
      <div class="d-hero">
        <div id="detailThumb" class="d-thumb">–ó–∞–≥–ª—É—à–∫–∞</div>
        <div class="d-actions">
  <button class="btn-spin" id="spinStartBtn">–ö–†–£–¢–ò–¢–¨</button>
  <button class="spin-cta hide" id="spinOkBtn">–ó–∞–±—Ä–∞—Ç—å</button>
  <button class="spin-cta secondary hide" id="spinAgainBtn">–ï—â—ë —Ä–∞–∑</button>
  <div class="pill"><span>–¶–µ–Ω–∞:</span><span class="num" id="detailPrice">‚Äî</span></div>
</div>

</div> <!-- –∑–∞–∫—Ä—ã–≤–∞–µ—Ç .d-hero -->

      <div class="panel">
        <div class="switch" style="justify-content:space-between;margin-bottom:10px;">
          <span>–î–µ–º–æ —Ä–µ–∂–∏–º</span>
          <div id="demoToggle" class="toggle" role="switch" aria-checked="false"></div>
        </div>

        <h3>–°–∫–æ–ª—å–∫–æ –∫–µ–π—Å–æ–≤ –æ—Ç–∫—Ä—ã—Ç—å?</h3>
        <div class="qty" id="qtyWrap">
          <div class="q active" data-v="1">1</div><div class="q" data-v="2">2</div>
          <div class="q" data-v="3">3</div><div class="q" data-v="4">4</div>
          <div class="q" data-v="5">5</div>
        </div>
      </div>

      <div class="subhead">–°–û–î–ï–†–ñ–ò–ú–û–ï –ö–ï–ô–°–ê</div>
      <div id="lootGrid" class="loot-grid"></div>
      <div style="height:40px"></div>
    </div>
  </div>

  <button id="backTop" class="backtop" aria-label="–í–≤–µ—Ä—Ö">–í–í–ï–†–• ‚Üë</button>



  <script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
// ====== –î–ê–ù–ù–´–ï ======
const LOOT_SETS = { /* <-- —Ç–≤–æ–∏ –º–∞—Å—Å–∏–≤—ã, –æ—Å—Ç–∞–≤–ª—è—é –∫–∞–∫ –µ—Å—Ç—å */ 
  cheap_1:[ "assets/images/20251003_1635_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n4frmwe74ry17r7gszk6ef.png",
    "assets/images/20251003_1629_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n43z74eq3ve8a9rcx44f02.png",
    "assets/images/20251003_1627_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n416bkeassbn7rx8a17bdt.png",
    "assets/images/20251003_1626_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n3y428frhrwqy0rqfwq9n5.png",
    "assets/images/20251003_1624_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3v1nbffkrc39mm720d2gm.png",
    "assets/images/20251003_1622_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3re47eearqtkwjkzktpma.png",
    "assets/images/20251003_1632_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n49ebnfssrvwq0605g9bkx.png",
    "assets/images/20251003_1621_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3p2hwf4fbk1r0rqbvdc5d.png",
    "assets/images/20251003_1620_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3k7yrey7864fgc944j33p.png",
    "assets/images/20251003_1618_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3fv8bej7813hnthjyags5.png",
    "assets/images/20251003_1616_–°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º_remix_01k6n3czjze6paj61x9g5r7ab3.png"
  ],
  cheap_2:["assets/images/—Å–Ω—É–ø–ø –¥–æ–≥.png","assets/images/20251003_1635_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n4frmwe74ry17r7gszk6ef.png","assets/images/20251003_1627_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n416bkeassbn7rx8a17bdt.png","assets/images/20251003_1629_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n43z74eq3ve8a9rcx44f02.png","assets/images/20251003_1626_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n3y428frhrwqy0rqfwq9n5.png","assets/images/20251003_1632_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n49ebnfssrvwq0605g9bkx.png","assets/images/20251003_1624_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3v1nbffkrc39mm720d2gm.png","assets/images/20251003_1622_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3re47eearqtkwjkzktpma.png","assets/images/20251003_1620_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3k7yrey7864fgc944j33p.png","assets/images/20251003_1616_–°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º_remix_01k6n3czjze6paj61x9g5r7ab3.png","assets/images/20251003_1618_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3fv8bej7813hnthjyags5.png"],
  cheap_3:["assets/images/kniga.png","assets/images/klever.png","assets/images/20251003_1635_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n4frmwe74ry17r7gszk6ef.png","assets/images/20251003_1627_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –§–æ–Ω_remix_01k6n416bkeassbn7rx8a17bdt.png","assets/images/20251003_1629_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n43z74eq3ve8a9rcx44f02.png","assets/images/20251003_1624_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3v1nbffkrc39mm720d2gm.png","assets/images/20251003_1622_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3re47eearqtkwjkzktpma.png","assets/images/20251003_1621_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3p2hwf4fbk1r0rqbvdc5d.png","assets/images/20251003_1620_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3k7yrey7864fgc944j33p.png","assets/images/20251003_1618_–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω_remix_01k6n3fv8bej7813hnthjyags5.png","assets/images/20251003_1616_–°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º_remix_01k6n3czjze6paj61x9g5r7ab3.png"],
  cheap_4:["","","","","","","","","","",""],
  nft_1:["","","","","","","","","","",""],
  nft_2:["","","","","","","","","","",""],
  nft_3:["","","","","","","","","","",""],
  nft_4:["","","","","","","","","","",""],
  exclusive_1:["","","","","","","","","","",""],
  exclusive_2:["","","","","","","","","","",""],
  exclusive_3:["","","","","","","","","","",""],
  exclusive_4:["","","","","","","","","","",""],
  standard_1:["","","","","","","","","","",""],
  standard_2:["","","","","","","","","","",""],
  standard_3:["","","","","","","","","","",""],
  standard_4:["","","","","","","","","","",""],
  gold_1:["","","","","","","","","","",""],
  gold_2:["","","","","","","","","","",""],
  gold_3:["","","","","","","","","","",""],
  gold_4:["","","","","","","","","","",""],
  allornothing_1:["","","","","","","","","","",""],
  allornothing_2:["","","","","","","","","","",""],
  allornothing_3:["","","","","","","","","","",""],
  allornothing_4:["","","","","","","","","","",""],
  expensive_1:["","","","","","","","","","",""],
  expensive_2:["","","","","","","","","","",""],
  expensive_3:["","","","","","","","","","",""],
  expensive_4:["","","","","","","","","","",""],
};

const CHEAP_BACK_TEXT = {
  cheap_1: Array(11).fill({stars:"174000/", ton:"870"}),
  cheap_2: Array(11).fill({stars:"174000/", ton:"870"}),
  cheap_3: Array(11).fill({stars:"174000/", ton:"870"}),
  cheap_4: Array(11).fill({stars:"174000/", ton:"870"}),
};

const CASE_THUMBS = {
  free:["assets/images/20251006_1323_–ò–∑—É–º—Ä—É–¥–Ω—ã–π –∫–µ–π—Å_remix_01k6wgnp9kfc7t5tsc54yag55g.png","assets/images/20251006_1250_–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π –ì–ª–∏—Ç—á –ö–µ–π—Å_remix_01k6wes6ykf1rtbax6cajjgpae.png","assets/images/20251006_1340_–ñ—ë–ª—Ç—ã–π –ì–ª–∏—Ç—á –î—Ä–æ–ø_remix_01k6whmtz7e3d8ejjj7vz9dt6z.png","assets/images/case 10 000.png"],
  cheap:["","","",""],
  nft:["assets/images/ChatGPT Image 5 –æ–∫—Ç. 2025 –≥., 10_33_06.png","assets/images/ChatGPT Image 5 –æ–∫—Ç. 2025 –≥., 11_26_19.png","assets/images/NFT 3.png","assets/images/20251005_1527_–ó–µ–ª—ë–Ω–∞—è –ø—Ä–∏–∑—Ä–∞—á–Ω–∞—è —Ç—ã–∫–≤–∞_remix_01k6t5bwrrfxet6r4vzrkgra3k.png"],
  exclusive:["assets/images/20251005_1639_–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∑–º–µ—è_remix_01k6t9fz7mevwt1beaq5bxehc4.png","assets/images/20251005_1703_–§–µ–Ω —Å —Ä–æ–∑–æ–≤–æ–π –ª–µ–Ω—Ç–æ–π_remix_01k6tavjk3fq8brq0e5fr8hycw.png","assets/images/20251005_1718_–°—Ç–∏–ª—å–Ω—ã–π —à–∫–æ–ª—å–Ω—ã–π —Ä—é–∫–∑–∞–∫_simple_compose_01k6tbpyfyedkb0r4qcr8r6p8m.png","assets/images/20251005_1752_–†–∞–¥—É–∂–Ω—ã–µ –ì—É–±—ã –∏ –ü—É–∑—ã—Ä–∏_remix_01k6tdn1ebem893yskvv82bpgz.png"],
  standard:["","","",""],
  gold:["","","",""],
  allornothing:["","","",""],
  expensive:["","","",""],
};

const sections = [
  { id:'free',        title:'–ë–ï–°–ü–õ–ê–¢–ù–´–ï –ö–ï–ô–°–´',  items:4, price:'–ë–ï–°–ü–õ–ê–¢–ù–û',
    descs:['–ë–æ–Ω—É—Å –∑–∞ –ø—Ä–æ–º–æ–∫–æ–¥','–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å','–ó–∞ –ø–æ–¥–ø–∏—Å–∫—É','–ó–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ'] },
  { id:'cheap',       title:'–î–ï–®–Å–í–´–ï –ö–ï–ô–°–´',     items:4, price:['50 ‚≠ê','250 ‚≠ê','500 ‚≠ê','1500 ‚≠ê'] },
  { id:'nft',         title:'–¢–û–õ–¨–ö–û NFT-–ö–ï–ô–°–´',  items:4, price:['25 ‚≠ê','30 ‚≠ê','35 ‚≠ê','40 ‚≠ê'] },
  { id:'exclusive',   title:'–≠–ö–°–ö–õ–Æ–ó–ò–í–ù–´–ï –ö–ï–ô–°–´',items:4, price:['2000 ‚≠ê','3500 ‚≠ê','5800 ‚≠ê','8500 ‚≠ê'] },
  { id:'standard',    title:'–°–¢–ê–ù–î–ê–†–¢–ù–´–ï –ö–ï–ô–°–´', items:4, price:['20 ‚≠ê','25 ‚≠ê','28 ‚≠ê','35 ‚≠ê'] },
  { id:'gold',        title:'–ö–ï–ô–°–´ –ó–ê –ó–û–õ–û–¢–û',   items:4, price:['–ó–û–õ–û–¢–û','–ó–û–õ–û–¢–û','–ó–û–õ–û–¢–û','–ó–û–õ–û–¢–û'] },
  { id:'allornothing',title:'–í–°–Å –ò–õ–ò –ù–ò–ß–ï–ì–û –ö–ï–ô–°–´',items:4,price:['50 ‚≠ê','75 ‚≠ê','100 ‚≠ê','150 ‚≠ê'] },
  { id:'expensive',   title:'–î–û–†–û–ì–ò–ï –ö–ï–ô–°–´',     items:4, price:['200 ‚≠ê','250 ‚≠ê','300 ‚≠ê','400 ‚≠ê'] },
];

const FALLBACK_IMG = "https://via.placeholder.com/512?text=%F0%9F%8E%81";

// ====== DOM-—Å—Å—ã–ª–∫–∏ ======
const chipbar  = document.getElementById('chipbar');
const content  = document.getElementById('content');
const detail   = document.getElementById('detail');
const backBtn  = document.getElementById('backBtn');
const dTitle   = document.getElementById('detailTitle');
const dPrice   = document.getElementById('detailPrice');
const dThumb   = document.getElementById('detailThumb');
const lootGrid = document.getElementById('lootGrid');
const demoToggle = document.getElementById('demoToggle');
const qtyWrap  = document.getElementById('qtyWrap');

// ====== –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ ======
sections.forEach(sec=>{
  // —á–∏–ø
  const chip = document.createElement('div');
  chip.className = 'chip';
  chip.dataset.target = `#sec-${sec.id}`;
  chip.textContent = sec.title.replace(' –ö–ï–ô–°–´','');
  chipbar.appendChild(chip);

  // –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
  const h2 = document.createElement('h2');
  h2.className = 'section';
  h2.id = `sec-${sec.id}`;
  h2.textContent = sec.title;
  content.appendChild(h2);

  // –≥—Ä–∏–¥
  const grid = document.createElement('div');
  grid.className = 'grid';

  for(let i=0;i<sec.items;i++){
    const thumbUrl  = (CASE_THUMBS[sec.id] && CASE_THUMBS[sec.id][i]) || "";
    const thumbHTML = thumbUrl ? `<img src="${thumbUrl}" alt="–û–±–ª–æ–∂–∫–∞ –∫–µ–π—Å–∞ #${i+1}" onerror="this.src='${FALLBACK_IMG}'">` : `–ó–∞–≥–ª—É—à–∫–∞`;

    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <div class="inner">
        <div class="thumb">${thumbHTML}</div>
        <div class="name">${sec.title.split(' ')[0]} –ö–µ–π—Å #${i+1}</div>
        <div class="desc">${(sec.descs && sec.descs[i]) || '–ù–µ–æ–Ω–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è'}</div>
        <div class="price">${Array.isArray(sec.price)? sec.price[i] : sec.price}</div>
      </div>`;

    if (sec.id !== 'free') {
      const setId = `${sec.id}_${i+1}`;
      card.addEventListener('click', ()=> openDetail({
        title: `${sec.title} ‚Äî –ö–µ–π—Å #${i+1}`,
        price: Array.isArray(sec.price)? sec.price[i] : sec.price,
        setId
      }));
    }
    grid.appendChild(card);
  }

  content.appendChild(grid);
});

// ====== –ß–∏–ø—ã (—Å–∫—Ä–æ–ª–ª –ø–æ —Å–µ–∫—Ü–∏—è–º) ======
const chips = Array.from(chipbar.querySelectorAll('.chip'));
chipbar.addEventListener('click', e=>{
  const chip = e.target.closest('.chip'); if(!chip) return;
  setActiveChip(chip);
  const sel = chip.dataset.target;
  if(!sel || sel==="#top"){ window.scrollTo({top:0,behavior:'smooth'}); return; }
  document.querySelector(sel)?.scrollIntoView({behavior:'smooth', block:'start'});
});
function setActiveChip(ch){ chips.forEach(c=>c.classList.remove('active')); ch.classList.add('active'); }
const mapTargetToChip = new Map([['#top', chipbar.querySelector('.chip.active')], ...chips.map(c=>[c.dataset.target,c])]);
const sectionEls = sections.map(s=>document.getElementById(`sec-${s.id}`));
const io = new IntersectionObserver((entries)=>{
  let best=null,ratio=0;
  for(const e of entries){ if(e.isIntersecting && e.intersectionRatio>ratio){best=e.target;ratio=e.intersectionRatio;} }
  if(best){ const ch = mapTargetToChip.get('#'+best.id); ch && setActiveChip(ch); }
  if(window.scrollY<10){ setActiveChip(mapTargetToChip.get('#top')); }
}, {root:null, rootMargin:'-130px 0px -60% 0px', threshold:[0.2,0.4,0.6,0.8]});
sectionEls.forEach(s=>io.observe(s));

// ====== –ö–Ω–æ–ø–∫–∞ ¬´–≤–≤–µ—Ä—Ö¬ª ======
const backTop = document.getElementById('backTop');
const toggleBackTop = ()=> backTop.classList.toggle('show', window.scrollY>2);
window.addEventListener('scroll', toggleBackTop, {passive:true});
backTop.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));
toggleBackTop();

// ====== –†–µ–Ω–¥–µ—Ä –ª—É—Ç–∞ (—Ñ–ª–∏–ø-–∫–∞—Ä—Ç–æ—á–∫–∏) ======
function renderLoot(images, setId){
  lootGrid.innerHTML = "";
  const list = (images && images.length) ? images.slice(0,11) : Array.from({length:11}, ()=>null);
  const isCheap = typeof setId === 'string' && setId.startsWith('cheap');
  const table = isCheap ? (CHEAP_BACK_TEXT[setId] || []) : [];

  const DEF_STARS = "174000/";
  const DEF_TON   = "870";

  list.forEach((src, idx)=>{
    const wrap = document.createElement('div');
    wrap.className = 'loot';
    wrap.setAttribute('aria-label', `–ü—Ä–µ–¥–º–µ—Ç ${idx+1}`);
    wrap.setAttribute('role','button');
    wrap.tabIndex = 0;

    const inner = document.createElement('div');
    inner.className = 'loot-inner';

    const front = document.createElement('div');
    front.className = 'loot-face loot-front';
    if (src){
      const img = document.createElement('img');
      img.src = src;
      img.alt = `–ü—Ä–µ–¥–º–µ—Ç ${idx+1}`;
      img.loading = "lazy";
      img.onerror = () => img.src = FALLBACK_IMG;
      front.appendChild(img);
    } else {
      front.textContent = '–ó–∞–≥–ª—É—à–∫–∞';
    }

    const back = document.createElement('div');
    back.className = 'loot-face loot-back';

    if (isCheap){
      const row = table[idx] || {};
      const s = (row.stars ?? "").trim() || DEF_STARS;
      const t = (row.ton   ?? "").trim() || DEF_TON;
      back.innerHTML = `
        <div class="lb-stats">
          <div class="lb-stars">${s}</div>
          <div class="lb-ton">${t}</div>
        </div>`;
    } else {
      back.innerHTML = `
        <div class="lb-stats">
          <div class="lb-stars">‚Äî</div>
          <div class="lb-ton">‚Äî</div>
        </div>`;
    }

    inner.appendChild(front);
    inner.appendChild(back);
    wrap.appendChild(inner);

    // —Ñ–ª–∏–ø (–æ–¥–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –∑–∞ —Ä–∞–∑)
    wrap.addEventListener('click', (e)=>{
      e.preventDefault();
      const isOpen = wrap.classList.contains('flipped');
      lootGrid.querySelectorAll('.loot.flipped').forEach(l=>l.classList.remove('flipped'));
      if (!isOpen) wrap.classList.add('flipped');
    }, {passive:false});

    wrap.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault();
        wrap.click();
      }
    });

    lootGrid.appendChild(wrap);
  });
}

function openDetail({title, price, setId}) {
  dTitle.textContent = title;
  dPrice.textContent = String(price || '‚Äî');

  // !!! –≤–æ—Ç —ç—Ç—É —Å—Ç—Ä–æ–∫—É –Ω—É–∂–Ω–æ –£–ë–†–ê–¢–¨, —á—Ç–æ–±—ã –¥–æ –∫–ª–∏–∫–∞ –ª–µ–Ω—Ç—ã –Ω–µ –±—ã–ª–æ:
  // mountSpinInThumb();

  // –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ ‚Äì –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∏—Å—Ç—É—é –∑–∞–≥–ª—É—à–∫—É:
  dThumb.textContent = '–ó–∞–≥–ª—É—à–∫–∞';

  const images = LOOT_SETS[setId] || null;
  renderLoot(images, setId);
hideSpinActions();

 const spinStartBtn = document.getElementById('spinStartBtn');
const spinOkBtn    = document.getElementById('spinOkBtn');
const spinAgainBtn = document.getElementById('spinAgainBtn');
if (spinStartBtn) spinStartBtn.disabled = false; // –≤–¥—Ä—É–≥ –æ—Å—Ç–∞–ª–∞—Å—å –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–π
IS_SPINNING = false;                              // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Å–Ω–∏–º–∞–µ–º –±–ª–æ–∫


// –ì–†–£–ü–ü–û–í–û–ô —Å–ø–∏–Ω –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É (1‚Äì5)
spinStartBtn.onclick  = () => beginGroupSpin(setId);
spinOkBtn.onclick     = () => { hideSpinActions(); /* TODO: –Ω–∞—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏–∑ */ };
spinAgainBtn.onclick  = () => { beginGroupSpin(setId); }; // –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –≥—Ä—É–ø–ø—É
if (spinAgainBtn) spinAgainBtn.textContent = '–ï—â—ë —Ä–∞–∑';

  detail.classList.add('show');
  detail.scrollTop = 0;

  // –æ—Å—Ç–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å
}


// ====== –ö–Ω–æ–ø–∫–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –≤ –¥–µ—Ç–∞–ª–∫–µ ======
backBtn.addEventListener('click', ()=>{
  // –°—Ç–æ–ø–∞–µ–º –ª—é–±—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ö–æ–¥–∏—Ç
  SPIN_STATE.forEach(st=>{
    if (st.rafId) cancelAnimationFrame(st.rafId);
    st.rafId = 0;
  });
  IS_SPINNING = false;
  document.getElementById('spinStartBtn')?.removeAttribute('disabled');
  detail.classList.remove('show');
});

demoToggle.addEventListener('click', ()=>{
  demoToggle.classList.toggle('active');
  demoToggle.setAttribute('aria-checked', demoToggle.classList.contains('active') ? 'true' : 'false');
});

qtyWrap.addEventListener('click', e=>{
  // –ù–µ –¥–∞—ë–º –º–µ–Ω—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–∫—Ä—É—Ç–∞
  if (IS_SPINNING) return;

  const q = e.target.closest('.q'); 
  if (!q) return;

  qtyWrap.querySelectorAll('.q').forEach(el => el.classList.remove('active'));
  q.classList.add('active');
});


// ====== Telegram WebApp ======
(()=>{
  const tg = window.Telegram && window.Telegram.WebApp;
  const avatarImg = document.getElementById('userAvatar');
  const fallback  = document.getElementById('avatarFallback');
  const nameEl    = document.getElementById('userName');

  if(!tg) return;
  tg.ready(); tg.expand();

  const u = tg.initDataUnsafe && tg.initDataUnsafe.user;
  if(!u) return;

  const display = u.username ? '@' + u.username : [u.first_name||'', u.last_name||''].join(' ').trim() || 'GLITCH DROP';
  nameEl.textContent = display;
  nameEl.setAttribute('data-text', display.replaceAll(' ', '\u00A0'));

  if (u.photo_url){
    avatarImg.src = u.photo_url;
    avatarImg.classList.remove('hidden');
    fallback.style.display = 'none';
  }
})();

</script>


<script>

/* ===== –ö–ê–†–¢–ò–ù–ö–ò –î–õ–Ø –ü–†–û–ö–†–£–¢–ê (11 —Å–ª–æ—Ç–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π setId) ===== */

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–∂–æ–∫ ¬´–∏–¥—ë—Ç –ø—Ä–æ–∫—Ä—É—Ç¬ª
let IS_SPINNING = false;

const SPIN_IMAGES = {
  cheap_1:        ["","","","","","","","","","",""],
  cheap_2:        ["","","","","","","","","","",""],
  cheap_3:        ["","","","","","","","","","",""],
  cheap_4:        ["","","","","","","","","","",""],

  nft_1:          ["","","","","","","","","","",""],
  nft_2:          ["","","","","","","","","","",""],
  nft_3:          ["","","","","","","","","","",""],
  nft_4:          ["","","","","","","","","","",""],

  exclusive_1:    ["","","","","","","","","","",""],
  exclusive_2:    ["","","","","","","","","","",""],
  exclusive_3:    ["","","","","","","","","","",""],
  exclusive_4:    ["","","","","","","","","","",""],

  standard_1:     ["","","","","","","","","","",""],
  standard_2:     ["","","","","","","","","","",""],
  standard_3:     ["","","","","","","","","","",""],
  standard_4:     ["","","","","","","","","","",""],

  gold_1:         ["","","","","","","","","","",""],
  gold_2:         ["","","","","","","","","","",""],
  gold_3:         ["","","","","","","","","","",""],
  gold_4:         ["","","","","","","","","","",""],

  allornothing_1: ["","","","","","","","","","",""],
  allornothing_2: ["","","","","","","","","","",""],
  allornothing_3: ["","","","","","","","","","",""],
  allornothing_4: ["","","","","","","","","","",""],

  expensive_1:    ["","","","","","","","","","",""],
  expensive_2:    ["","","","","","","","","","",""],
  expensive_3:    ["","","","","","","","","","",""],
  expensive_4:    ["","","","","","","","","","",""],
};

/* ========= ‚Äú–ñ–ò–í–ê–Ø‚Äù –õ–ï–ù–¢–ê –°–ü–ò–ù–ê –° –ü–†–û–¶–ï–ù–¢–ê–ú–ò –ü–û –ö–ê–ñ–î–û–ú–£ –¢–ê–ô–õ–£ =========
   –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:
   1) –ö–∞—Ä—Ç–∏–Ω–∫–∏ —Ç–∞–π–ª–æ–≤: —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –≤ –æ–±—ä–µ–∫—Ç–µ SPIN_IMAGES (—É —Ç–µ–±—è –≤—ã—à–µ).
      –ù–∞ –∫–∞–∂–¥—ã–π setId ‚Äî 11 —Å—Ç—Ä–æ–∫-URL.
   2) –ü—Ä–æ—Ü–µ–Ω—Ç—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è: —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –Ω–∏–∂–µ –≤ SPIN_CONFIGS_PERCENT.
      –ù–∞ –∫–∞–∂–¥—ã–π setId ‚Äî 11 —á–∏—Å–µ–ª (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö). –°—É–º–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–π ‚Äî
      –º—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
   3) –ü–æ–¥–ø–∏—Å–∏/–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Ç–∞–π–ª–∞—Ö: –≤ SPIN_LABELS (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
====================================================================== */

/* === 1) –ü–†–û–¶–ï–ù–¢–´ –ü–û –í–ö–õ–ê–î–ö–ê–ú (11 —à—Ç—É–∫ –Ω–∞ –∫–∞–∂–¥—ã–π setId) ============== */
/* –ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–ª—è cheap_1 –∏ nft_2, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî —à–∞–±–ª–æ–Ω –∏–∑ –Ω—É–ª–µ–π.
   –ú–µ–Ω—è–π –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∫–∞–∫ —Ç–µ–±–µ –Ω—É–∂–Ω–æ. */
const SPIN_CONFIGS_PERCENT = {
  cheap_1:        [0,0,0,0,0,0,0,0,0,0,0],
  cheap_2:        [0,0,0,0,0,0,0,0,0,0,0],
  cheap_3:        [0,0,0,0,0,0,0,0,0,0,0],
  cheap_4:        [0,0,0,0,0,0,0,0,0,0,0],

  nft_1:          [0,0,0,0,0,0,0,0,0,0,0],
  nft_2:          [0,0,0,0,0,0,0,0,0,0,0],
  nft_3:          [0,0,0,0,0,0,0,0,0,0,0],
  nft_4:          [0,0,0,0,0,0,0,0,0,0,0],

  exclusive_1:    [0,0,0,0,0,0,0,0,0,0,0],
  exclusive_2:    [0,0,0,0,0,0,0,0,0,0,0],
  exclusive_3:    [0,0,0,0,0,0,0,0,0,0,0],
  exclusive_4:    [0,0,0,0,0,0,0,0,0,0,0],

  standard_1:     [0,0,0,0,0,0,0,0,0,0,0],
  standard_2:     [0,0,0,0,0,0,0,0,0,0,0],
  standard_3:     [0,0,0,0,0,0,0,0,0,0,0],
  standard_4:     [0,0,0,0,0,0,0,0,0,0,0],

  gold_1:         [0,0,0,0,0,0,0,0,0,0,0],
  gold_2:         [0,0,0,0,0,0,0,0,0,0,0],
  gold_3:         [0,0,0,0,0,0,0,0,0,0,0],
  gold_4:         [0,0,0,0,0,0,0,0,0,0,0],

  allornothing_1: [0,0,0,0,0,0,0,0,0,0,0],
  allornothing_2: [0,0,0,0,0,0,0,0,0,0,0],
  allornothing_3: [0,0,0,0,0,0,0,0,0,0,0],
  allornothing_4: [0,0,0,0,0,0,0,0,0,0,0],

  expensive_1:    [0,0,0,0,0,0,0,0,0,0,0],
  expensive_2:    [0,0,0,0,0,0,0,0,0,0,0],
  expensive_3:    [0,0,0,0,0,0,0,0,0,0,0],
  expensive_4:    [0,0,0,0,0,0,0,0,0,0,0],
};

/* === 2) –¢–ï–ö–°–¢–´ –ù–ê –¢–ê–ô–õ–ê–• (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ; 11 —à—Ç—É–∫ –Ω–∞ setId) ========== */
/* –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∂–µ—à—å ‚Äî –ø–æ–¥—Å—Ç–∞–≤—è—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ label/value. */
const SPIN_LABELS = {
  // –ø—Ä–∏–º–µ—Ä: CHEAP #1
  cheap_1: {
    labels: ["CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1","CHEAP#1"],
    values: ["10 ‚≠ê","25 ‚≠ê","50 ‚≠ê","100 ‚≠ê","3 ‚≠ê","5 ‚≠ê","8 ‚≠ê","15 ‚≠ê","20 ‚≠ê","30 ‚≠ê","60 ‚≠ê"]
  },
  // –ø—Ä–∏–º–µ—Ä: NFT #2
  nft_2: {
    labels: ["NFT#2","NFT#2","NFT#2","NFT#2","NFT#2","NFT#2","NFT#2","NFT#2","NFT#2","NFT#2","NFT#2"],
    values: ["üî∑ 1","üî∑ 2","üî∑ 3","üî∑ 5","üî∑ 8","üî∑ 13","üî∑ 21","üî∑ 34","üî∑ 55","üî∑ 89","üî∑ 144"]
  },
  // –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–∂–µ—à—å –Ω–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å ‚Äî –≤–æ–∑—å–º—É—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç—ã
};

/* === 3) –î–ï–§–û–õ–¢–ù–´–ï –ü–û–î–ü–ò–°–ò/–ó–ù–ê–ß–ï–ù–ò–Ø, –ï–°–õ–ò –ù–ï–¢ –í SPIN_LABELS ========= */
const DEFAULT_LABELS = ["–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó","–ü–†–ò–ó"];
const DEFAULT_VALUES = ["10 ‚≠ê","25 ‚≠ê","50 ‚≠ê","100 ‚≠ê","3 ‚≠ê","5 ‚≠ê","8 ‚≠ê","15 ‚≠ê","20 ‚≠ê","30 ‚≠ê","60 ‚≠ê"];

/* === 4) –ü–ê–†–ê–ú–ï–¢–†–´ –ê–ù–ò–ú–ê–¶–ò–ò ========================================= */
const TILE_W = 110;           // —à–∏—Ä–∏–Ω–∞ —Ç–∞–π–ª–∞ (–∫–∞–∫ –≤ CSS)
const TILE_GAP = 12;          // –∑–∞–∑–æ—Ä –º–µ–∂–¥—É —Ç–∞–π–ª–∞–º–∏ (–∫–∞–∫ –≤ CSS)
const TILE_FULL = TILE_W + TILE_GAP;
const SPIN_TIME_MS = 4000;    // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
const PRE_BUFFER_TILES = 16;  // —Å–ª—É—á–∞–π–Ω—ã—Ö —Ç–∞–π–ª–æ–≤ –î–û –≤—ã–∏–≥—Ä—ã—à–∞
const POST_BUFFER_TILES = 6;  // ¬´—Ö–≤–æ—Å—Ç¬ª –ü–û–°–õ–ï –≤—ã–∏–≥—Ä—ã—à–∞

/* === 5) –°–û–°–¢–û–Ø–ù–ò–ï –ü–û –ö–ï–ô–°–ê–ú ========================================= */
const SPIN_STATE = new Map();
/* state:
{
  currentX: number,
  rafId: number|0,
  lastWinEl: HTMLElement|null,
  weights: number[11],      // –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Å–∞ 0..1
  labels: string[11],
  values: string[11]
}
*/
function ensureSpinState(key){
  if(!SPIN_STATE.has(key)){
    // key –∏–º–µ–µ—Ç –≤–∏–¥: setId__index
    const setId = key.split('__')[0];
    const weightsRaw = (SPIN_CONFIGS_PERCENT[setId] && SPIN_CONFIGS_PERCENT[setId].slice(0,11)) || Array(11).fill(0);
    const sum = weightsRaw.reduce((a,b)=>a+b,0) || 1;
    const weights = weightsRaw.map(w=> Math.max(0,w) / sum);

    const L = (SPIN_LABELS[setId]?.labels || DEFAULT_LABELS).slice(0,11);
    const V = (SPIN_LABELS[setId]?.values || DEFAULT_VALUES).slice(0,11);
    while(L.length<11) L.push("–ü–†–ò–ó");
    while(V.length<11) V.push("‚Äî");

    SPIN_STATE.set(key, {
      currentX: 0,
      rafId: 0,
      lastWinEl: null,
      weights,
      labels: L,
      values: V
    });
  }
  return SPIN_STATE.get(key);
}

/* === 6) UI-—Ö–µ–ª–ø–µ—Ä—ã ================================================== */
function hideSpinActions(){
  document.getElementById('spinOkBtn')?.classList.add('hide');
  document.getElementById('spinAgainBtn')?.classList.add('hide');
}
function showSpinActions(){
  document.getElementById('spinOkBtn')?.classList.remove('hide');
  document.getElementById('spinAgainBtn')?.classList.remove('hide');
}



/* === 8) –í—ã–±–æ—Ä –∏–Ω–¥–µ–∫—Å–∞ –ø–æ –≤–µ—Å–∞–º (–∏–∑ 11) ============================== */
function pickIndexByWeights(weights){
  let r = Math.random();
  let acc = 0;
  for(let i=0;i<weights.length;i++){
    acc += weights[i];
    if(r <= acc) return i;
  }
  return weights.length-1;
}

/* === 9) –°–æ–∑–¥–∞—ë–º –æ–¥–∏–Ω —Ç–∞–π–ª –ø–æ –∏–Ω–¥–µ–∫—Å—É (–±–µ—Ä—ë–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∑ SPIN_IMAGES) == */
function createTileEl(key, baseIndex){
  const setId = key.split('__')[0];
  const FALLBACK = "https://via.placeholder.com/512?text=%F0%9F%8E%81";
  const state = ensureSpinState(key);
  const imgUrl = (SPIN_IMAGES[setId] && SPIN_IMAGES[setId][baseIndex]) || "";

  const el = document.createElement('div');
  el.className = 'slot';
  el.dataset.baseIndex = String(baseIndex);
  el.innerHTML = `
    <div class="slot-img">
      ${imgUrl ? `<img src="${imgUrl}" alt="" onerror="this.src='${FALLBACK}'">` : '‚Äî'}
    </div>
    <div class="slot-label">‚Ññ${baseIndex+1} ${state.labels[baseIndex] || ''}</div>
    <div class="slot-value">${state.values[baseIndex] || ''}</div>
  `;
  return el;
}

/* === 10) –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–∞–π–ª–∞ –ø–æ–¥ —É–∫–∞–∑–∞—Ç–µ–ª–µ–º ============================== */
function highlightTileUnderPointer(key){
  const track = document.getElementById(trackIdByKey(key));
  const embed = embedByKey(key);
  const viewport = embed && embed.querySelector('.spin-viewport');
  if(!viewport || !track) return;

  const state = ensureSpinState(key);
  const tiles = Array.from(track.querySelectorAll('.slot'));
  const viewportCenter = viewport.getBoundingClientRect().width / 2;
  const pointerInTrack = (viewportCenter - state.currentX);
  const idx = Math.round((pointerInTrack - TILE_W/2) / TILE_FULL);
  const clamped = Math.max(0, Math.min(tiles.length-1, idx));

  tiles.forEach(t=>t.classList.remove('hot'));
  tiles[clamped]?.classList.add('hot');
}

/* === 11) –°–ë–û–†–ö–ê –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ô –õ–ï–ù–¢–´ –ü–ï–†–ï–î –°–¢–ê–†–¢–û–ú ===================== */
/* –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º:
   - PRE_BUFFER_TILES —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ –≤–µ—Å–∞–º
   - 1 ¬´–≤—ã–∏–≥—Ä—ã—à–Ω—ã–π¬ª –ø–æ –≤–µ—Å–∞–º (winnerIndex)
   - POST_BUFFER_TILES —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ –≤–µ—Å–∞–º
   –ü–æ–±–µ–¥–Ω—ã–π ‚Äî —Ç–æ—á–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞ –ø–µ—Ä–µ–¥ —Ö–≤–æ—Å—Ç–æ–º,
   –∞–Ω–∏–º–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–æ–≤–Ω–æ –Ω–∞ –Ω—ë–º.                       */
function buildDynamicTrack(key){
  const track = document.getElementById(trackIdByKey(key));
  if(!track) return { winnerEl:null };

  const state = ensureSpinState(key);
  track.innerHTML = '';

  for(let i=0;i<PRE_BUFFER_TILES;i++){
    const idx = pickIndexByWeights(state.weights);
    track.appendChild(createTileEl(key, idx));
  }
  const winnerIndex = pickIndexByWeights(state.weights);
  const winnerEl = createTileEl(key, winnerIndex);
  track.appendChild(winnerEl);

  for(let i=0;i<POST_BUFFER_TILES;i++){
    const idx = pickIndexByWeights(state.weights);
    track.appendChild(createTileEl(key, idx));
  }

  state.currentX = 0;
  track.style.transform = `translateX(${state.currentX}px)`;

  return { winnerEl };
}

/* === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ –ª–µ–π–∞—É—Ç–∞ === */
function getSelectedQty(){
  const q = qtyWrap.querySelector('.q.active');
  const n = parseInt(q?.dataset.v || '1', 10);
  return Math.max(1, Math.min(5, n));
}

function layoutForQty(qty){
  if(qty===1) return {cols:1, rows:1, cellH:'200px'};
  if(qty===2) return {cols:2, rows:1, cellH:'170px'};
  if(qty===3) return {cols:3, rows:1, cellH:'150px'};
  if(qty===4) return {cols:2, rows:2, cellH:'140px'};
  return          {cols:3, rows:2, cellH:'130px'}; // qty=5
}

function renderSpinMatrix(setId, qty){
  const {cols, cellH} = layoutForQty(qty);
  const parent = document.getElementById('detailThumb');
  if(!parent) return;

  parent.innerHTML = `<div class="spin-matrix" id="spinMatrix"></div>`;
  const matrix = document.getElementById('spinMatrix');
  matrix.style.setProperty('--cols', String(cols));
  matrix.style.setProperty('--cell-h', cellH);

  for(let i=0;i<qty;i++){
    const key = `${setId}__${i}`;
    const embedId = `spinEmbed_${key}`;
    const trackId = `spinTrack_${key}`;
    const widget = document.createElement('div');
    widget.className = 'spin-embed';
    widget.id = embedId;
    widget.innerHTML = `
      <div class="spin-viewport">
        <div class="spin-track" id="${trackId}"></div>
        <div class="spin-pointer"></div>
      </div>
    `;
    matrix.appendChild(widget);
  }
}

/* === ID-—Ö–µ–ª–ø–µ—Ä—ã –ø–æ–¥ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã === */
function trackIdByKey(key){ return `spinTrack_${key}`; }
function embedByKey(key){ return document.getElementById(`spinEmbed_${key}`); }

/* === –ì—Ä—É–ø–ø–æ–≤–æ–π –∑–∞–ø—É—Å–∫ N —Å–ø–∏–Ω–æ–≤ + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ ¬´–ö–†–£–¢–ò–¢–¨¬ª === */
function beginGroupSpin(setId){
  if (IS_SPINNING) return;   // –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–∞–±–ª-–∫–ª–∏–∫–∞
  IS_SPINNING = true;

  hideSpinActions();

  const qty = getSelectedQty();
  renderSpinMatrix(setId, qty);

  const spinStartBtn = document.getElementById('spinStartBtn');
  if (spinStartBtn) spinStartBtn.disabled = true;

  let finished = 0;

  for (let i = 0; i < qty; i++) {
    const key = `${setId}__${i}`;
    startSpinSingle(key, () => {
      finished++;
      if (finished === qty) {
        if (spinStartBtn) spinStartBtn.disabled = false; // –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–æ–ø–∫—É
        showSpinActions();                                // –ø–æ–∫–∞–∑–∞—Ç—å ¬´–ó–∞–±—Ä–∞—Ç—å¬ª –∏ ¬´–ï—â—ë —Ä–∞–∑¬ª
        IS_SPINNING = false;                              // —Å–Ω—è—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
      }
    });
  }
}

/* === 12) –°–¢–ê–†–¢ –°–ü–ò–ù–ê ‚Äî –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò –ì–ï–ù–ï–†–ò–ú –ò –ö–†–£–¢–ò–ú ================== */

function startSpinSingle(key, onDone){
  ensureSpinState(key);
  const state = SPIN_STATE.get(key);

  const track = document.getElementById(trackIdByKey(key));
  const embed = embedByKey(key);
  const viewport = embed && embed.querySelector('.spin-viewport');
  if(!viewport || !track){ onDone && onDone(); return; }

  if(state.lastWinEl){
    state.lastWinEl.classList.remove('hot');
    state.lastWinEl.style.transform = '';
    state.lastWinEl = null;
  }
  cancelAnimationFrame(state.rafId);

  const { winnerEl } = buildDynamicTrack(key);
  if(!winnerEl){ onDone && onDone(); return; }

  const tiles = Array.from(track.querySelectorAll('.slot'));
  const viewportCenter = viewport.getBoundingClientRect().width / 2;
  const indexInTrack = tiles.indexOf(winnerEl);
  const targetLeftInTrack = indexInTrack * TILE_FULL;
  const targetCenterInTrack = targetLeftInTrack + TILE_W/2;
  const targetX = viewportCenter - targetCenterInTrack;

  const from = state.currentX;
  const to = targetX;
  const t0 = performance.now();
  const dur = SPIN_TIME_MS;

  function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

  function frame(now){
    const p = Math.min(1, (now - t0) / dur);
    const e = easeOutCubic(p);
    state.currentX = from + (to - from) * e;
    track.style.transform = `translateX(${state.currentX}px)`;
    highlightTileUnderPointer(key);

    if(p < 1){
      state.rafId = requestAnimationFrame(frame);
    } else {
      state.lastWinEl = winnerEl;
      state.lastWinEl.classList.add('hot');
      state.lastWinEl.style.transform = 'scale(1.03)';
      state.rafId = 0;
      onDone && onDone();
    }
  }
  state.rafId = requestAnimationFrame(frame);
}

</script>

</body>
</html>
